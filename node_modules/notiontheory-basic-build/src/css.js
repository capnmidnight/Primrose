var cssmin = require("gulp-cssmin"),
  makeWatch = require("./makeWatch"),
  rename = require("gulp-rename"),
  stylus = require("gulp-stylus"),
  defaultBase = {
    base: "./"
  },
  defaultRename = {
    suffix: ".min"
  };

function css(gulp, pkg, name, files) {
  var pre = name + ":css:";
  gulp.task(pre + "build:debug", function(){
    return gulp.src(files, defaultBase)
      .pipe(stylus())
      .pipe(gulp.dest("./"));
  });

  gulp.task(pre + "build:release", function(){
    return gulp.src(files, defaultBase)
      .pipe(stylus())
      .pipe(gulp.dest("./"))
      .pipe(rename(defaultRename))
      .pipe(cssmin())
      .pipe(gulp.dest("./"));
  });

  return {
    default: makeWatch(gulp, pre + "build:debug", files),
    debug: pre + "build:debug",
    release: pre + "build:release"
  };
}

module.exports = css;