var concat = require("gulp-concat"),
  rename = require("gulp-rename"),
  minify = require("gulp-uglify"),
  work = require("./work"),
  defaultBase = {
    base: "./"
  },
  defaultRename = {
    suffix: ".min"
  };

function cat(gulp, pkg, name, files, dependencies, post) {
  return work(gulp, "cat", null, function(debug) {
    var stream = gulp.src(files, defaultBase)
      .pipe(concat(name + ".js"));
    if(!debug){
      stream = stream.pipe(gulp.dest("./"))
        .pipe(minify()
          .on("error", console.error.bind(console, "uglify error")))
        .pipe(rename(defaultRename));
    }
    return stream.pipe(gulp.dest("./"));
  }, name, files, dependencies, post);
}

module.exports = cat;