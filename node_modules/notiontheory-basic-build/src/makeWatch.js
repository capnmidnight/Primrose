var cached = require("gulp-cached"),
  path = require("path"),
  remember = require("gulp-remember");

function makeWatch(gulp, name, files, dependencies, cacheName) {
  dependencies = dependencies || [name];
  var taskName = "watch:" + name;
  gulp.task(taskName, dependencies, function(){
    console.log(name, "watching", files);
    return gulp.watch(files, [name])
      .on("change", function(event) {
        console.log("[%s] File %s was %s, running task %s...",
          taskName,
          path.relative(process.cwd(), event.path),
          event.type,
          name);
        if (cacheName && event.type === "deleted") {
          delete cached.caches[cacheName][event.path];
          remember.forget(cacheName, event.path);
        }
      });
  });
  return taskName;
}

module.exports = makeWatch;