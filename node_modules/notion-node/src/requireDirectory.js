"use strict";

var fs = require("fs"),
    path = require("path"),
    fileTest = /^[^.].+\.js(on)?$/;

module.exports = function requireDirectory(directoryPath) {
  var output = [],
      directories = [directoryPath];

  var _loop = function _loop() {
    var dir = directories.shift(),
        files = fs.readdirSync(path.resolve(dir));
    files.forEach(function (file) {
      var subpath = dir + "/" + file,
          subfile = path.resolve(subpath),
          stat = fs.lstatSync(subfile);
      if (stat.isDirectory()) {
        directories.push(subfile);
      } else if (fileTest.test(file)) {
        output.push(require(subfile));
      }
    });
  };

  while (directories.length > 0) {
    _loop();
  }
  return output;
};