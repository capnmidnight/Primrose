"use strict";

var sendFile = require("../handlers/file"),
  sendDirector = require("../handlers/directory"),
  fs = require("fs"),
  url = require("url"),
  options = require("../options").parse(process.argv),
  isDev = options.mode === "dev" || process.env.NODE_ENV === "dev";

module.exports = {
  description: "Final, default GET handler.",
  URLPattern: /.*/,
  GET: {
    "*/*": function (state) {
      var parts = url.parse(state.url),
          file = state.root + parts.pathname;
      if (file[file.length - 1] === "/") {
        if (!fs.existsSync(file + "index.html") && isDev) {
          return sendDirectory(file, root);
        }
        file += "index.html";
      }
      return sendFile(file, state);
    }
  }
}