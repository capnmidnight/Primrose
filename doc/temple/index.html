<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="web-app-capable" content="yes"><meta name="theme-color" content="black"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="description" content="A WebVR application framework."><meta name="keywords" content="WebGL, WebVR, HTML5, JavaScript, text editor, source code editor, virtual reality, Primrose"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@Primrose_VR"><meta property="og:site_name" content="Primrose VR"><meta property="og:description" content="Primrose: Framework for WebVR Applications"><meta name="twitter:description" content="Primrose: Framework for WebVR Applications"><meta property="og:url" content="http://www.primrosevr.com/doc/temple/index.html"><!-- start main.jade meta block --><!-- end main.jade meta block -->
<!-- start main.jade title block --><meta property="og:title" content="Primrose VR: WebVR Application Framework"><meta name="twitter:title" content="Primrose VR: WebVR Application Framework"><title>Primrose VR: WebVR Application Framework</title><!-- end main.jade title block --><style>*{box-sizing:border-box}#frontBuffer,#fullScreenButtonContainer,body,html,progress{position:absolute;border:0;left:0;top:0}#frontBuffer,body,html{padding:0;margin:0;height:100%;width:100%}#fullScreenButtonContainer,progress{margin:1em;width:calc(100% - 2em)}#frontBuffer{background-repeat:no-repeat;background-color:#eee;background-size:cover;cursor:wait}body>h1{display:none}button{padding:1em} #frontBuffer { background-image:url(screenshot.jpg); }</style><script type="text/javascript">"use strict";function AbstractDeviceMotionDisplayPolyfill(e,t){function n(e){e.alpha&&(window.removeEventListener("deviceorientation",n),r(e),window.addEventListener("deviceorientation",r,!1))}function r(e){var t=performance.now();t>M.timestamp&&(i=e.beta*Math.PI/180,o=e.alpha*Math.PI/180,a=-e.gamma*Math.PI/180,P=Math.PI*-window.orientation/360,s=Math.cos(i/2),l=Math.cos(o/2),c=Math.cos(a/2),E=Math.cos(P),u=Math.sin(i/2),m=Math.sin(o/2),d=Math.sin(a/2),D=Math.sin(P),f=u*l*c+s*m*d,h=s*m*c-u*l*d,g=s*l*d-u*m*c,p=s*l*c+u*m*d,k[0]=f+x*g,k[1]=x*p+h,k[2]=g-x*f,k[3]=p-x*h,v=k[0]*E-k[2]*D,w=k[1]*E+k[3]*D,y=k[2]*E+k[0]*D,b=k[3]*E-k[1]*D,k[0]=v*V-b*V,k[1]=w*V-y*V,k[2]=y*V+w*V,k[3]=b*V+v*V,M={timestamp:t,frameID:++F,orientation:k,position:R})}AbstractVRDisplayPolyfill.call(this,!0,isMobile,!1,e,t,function(e){return FullScreen.request(e[0].source)});var i,o,a,s,l,c,u,m,d,f,h,g,p,v,w,y,b,P,D,E,F=0,k=new Float32Array([0,0,0,1]),R=new Float32Array([0,0,0]),M={timestamp:0,frameID:0,orientation:k,position:R},V=Math.sqrt(.5),x=0;window.addEventListener("deviceorientation",n,!1),this.getImmediatePose=function(){return M},this.getPose=function(){return M},this.resetPose=function(){x=o}}function AbstractVRDisplayPolyfill(e,t,n,r,i,o){var a=this;this.capabilities={canPresent:e,hasExternalDisplay:!1,hasOrientation:t,hasPosition:n},this.displayID=r,this.displayName=i,this.isConnected=!0,this.isPresenting=!1,this.stageParameters=null;var s=null,l=function c(){FullScreen.removeChangeListener(c),a.exitPresent(),window.dispatchEvent(new Event("vrdisplaypresentchange"))};this.requestPresent=function(e){return a.capabilities.canPresent?e?e instanceof Array?1!==e.length?Promise.reject(new Error("Only one layer at a time is supported right now.")):e[0].source?o(e).then(function(t){return s=e[0],a.isPresenting=t===s.source,FullScreen.addChangeListener(l,!1),window.dispatchEvent(new Event("vrdisplaypresentchange")),t}):Promise.reject(new Error("No source on layer parameter.")):Promise.reject(new Error("Layers parameters must be an array")):Promise.reject(new Error("No layers provided to requestPresent")):Promrise.reject(new Error("This device cannot be used as a presentation display. DisplayID: "+a.displayId+". Name: "+a.displayName))},this.getLayers=function(){return s?[s]:[]},this.exitPresent=function(){var e=function(e){return a.isPresenting=!1,s=null,e};return FullScreen.exit().then(e)["catch"](function(t){console.error(t.message||t),e()})},this.requestAnimationFrame=function(e){window.requestAnimationFrame(e)},this.cancelAnimationFrame=function(e){window.cancelAnimationFrame(e)},this.submitFrame=function(){}}function CardboardVRDisplayPolyfill(){AbstractDeviceMotionDisplayPolyfill.call(this,"B4CEAE28-1A89-4314-872E-9C223DDABD02","Device Motion API"),this.getEyeParameters=function(e){if("left"===e||"right"===e){var t="left"===e?-1:1;return{renderWidth:Math.floor(screen.width*devicePixelRatio/2),renderHeight:screen.height*devicePixelRatio,offset:new Float32Array([.03*t,0,0]),fieldOfView:{upDegrees:40,downDegrees:40,leftDegrees:40,rightDegrees:40}}}}}function LegacyVRDisplayPolyfill(e,t){function n(e,t){for(var n="",r=e.deviceName,i=t.deviceName,o=0;o<r.length&&o<i.length&&r[o]===i[o];++o)n+=r[o];for(;n.length>0&&!/\w/.test(n[n.length-1]);)n=n.substring(0,n.length-1);return n}function r(e){var t={timestamp:e.timestamp,frameID:++i,position:null,linearVelocity:null,linearAcceleration:null,orientation:null,angularVelocity:null,angularAcceleration:null};return o.forEach(function(n){if(e[n]){var r=[e[n].x,e[n].y,e[n].z];"orientation"===n&&r.push(e[n].w),t[n]=new Float32Array(r)}}),t}var i=0,o=["position","linearVelocity","linearAcceleration","orientation","angularVelocity","angularAcceleration"];AbstractVRDisplayPolyfill.call(this,!!e,!!t,!!t,e.hardwareUnitId,n(e,t),function(t){return FullScreen.request(t[0].source,{vrDisplay:e,vrDistortion:!0})}),this.getEyeParameters=function(t){var n=null;n=e.getEyeParameters?e.getEyeParameters(t):{renderRect:e.getRecommendedEyeRenderRect(t),eyeTranslation:e.getEyeTranslation(t),recommendedFieldOfView:e.getRecommendedEyeFieldOfView(t)};var r={renderWidth:n.renderRect.width,renderHeight:n.renderRect.height,offset:new Float32Array([n.eyeTranslation.x,n.eyeTranslation.y,n.eyeTranslation.z]),fieldOfView:n.recommendedFieldOfView};return r},this.getImmediatePose=function(){return r(t.getImmediateState())},this.getPose=function(){return r(t.getState())},this.resetPose=t.resetSensor.bind(t)}function StandardMonitorPolyfill(){AbstractDeviceMotionDisplayPolyfill.call(this,"39025D3C-3B12-4F92-9FF5-85DC887CB545","Standard Monitor"),this.getEyeParameters=function(e){return"left"===e?{renderWidth:screen.width*devicePixelRatio,renderHeight:screen.height*devicePixelRatio,offset:new Float32Array([0,0,0]),fieldOfView:{upDegrees:25,downDegrees:25,leftDegrees:25,rightDegrees:25}}:void 0}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}window.isMobile=function(e){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substring(0,4))}(navigator.userAgent||navigator.vendor||window.opera);var FullScreen=function(){function e(e,t,n,r){for(var i=0;i<t.length;++i){var o=n+t[i]+r;if(void 0!==e[o])return o}}var t=e(document,["fulls","mozFullS","webkitFulls","msFulls"],"","creenElement"),n=e(document,["","moz","webkit","ms"],"on","fullscreenchange"),r=e(document,["","moz","webkit","ms"],"on","fullscreenerror"),i=e(document.documentElement,["requestFulls","mozRequestFullS","webkitRequestFulls","webkitRequestFullS","msRequestFulls"],"","creen"),o=e(document,["exitFulls","mozExitFullS","webkitExitFulls","webkitExitFullS","msExitFulls"],"","creen");n=n&&n.substring(2),r=r&&r.substring(2);var a={addChangeListener:function(e,t){return document.addEventListener(n,e,t)},removeChangeListener:function(e){return document.removeEventListener(n,e)},addErrorListener:function(e,t){return document.addEventListener(r,e,t)},removeErrorListener:function(e){return document.removeEventListener(r,e)},withChange:function(e){return new Promise(function(t,n){var r,i,o,a=function(){o&&clearTimeout(o),FullScreen.removeChangeListener(r),FullScreen.removeErrorListener(i)};r=function(){setTimeout(a),t(FullScreen.element)},i=function(e){setTimeout(a),n(e)},FullScreen.addChangeListener(r,!1),FullScreen.addErrorListener(i,!1),e()?(a(),t(FullScreen.element)):o=setTimeout(function(){a(),n("Fullscreen state did not change in allotted time")},1e3)})},request:function(e,t){return FullScreen.withChange(function(){if(!i)throw new Error("No Fullscreen API support.");return FullScreen.isActive?!0:void(t?e[i](t):isChrome?e[i](window.Element.ALLOW_KEYBOARD_INPUT):e[i]())})},exit:function(){return FullScreen.withChange(function(){if(!o)throw new Error("No Fullscreen API support.");return FullScreen.isActive?void document[o]():!0})}};return Object.defineProperties(a,{element:{get:function(){return document[t]}},isActive:{get:function(){return!!FullScreen.element}}}),a}(),loadFiles=function(){function e(e,t,n){var r=new XMLHttpRequest;r.onload=function(){r.status<400&&t(r.response)},r.open("GET",e),r.onprogress=n,r.send()}function t(n,r,i,o,a,s){if(o<n.length){var l=n[o][0],c=(n[o][1],l.match(/\.\w+$/)[0]||"none"),u=s;e(l,function(e){if(".js"===c){var l=document.createElement("script");l.type="text/javascript",l.appendChild(document.createTextNode(e)),document.head.appendChild(l)}t(n,r,i,o+1,a,s)},function(e){return i(s=u+e.loaded,a)})}else r()}return function(n,r,i){function o(e){for(var n=0,o=0;o<e.length;++o)n+=e[o][1];r=r||console.log.bind(console,"File load progress"),t(e,i,r,0,n,0)}n instanceof String||"string"==typeof n?e(n,function(e){o(JSON.parse(e))}):n instanceof Array&&o(n)}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ViewCameraTransform=function(){function e(t){_classCallCheck(this,e),this._params=[t.getEyeParameters("left"),t.getEyeParameters("right")]}return _createClass(e,null,[{key:"makeTransform",value:function(t,n,r){var i=t.offset;return{translation:(new THREE.Matrix4).makeTranslation(i[0],i[1],i[2]),projection:e.fieldOfViewToProjectionMatrix(t.fieldOfView,n,r),viewport:{left:0,right:0,width:t.renderWidth,height:t.renderHeight}}}},{key:"fieldOfViewToProjectionMatrix",value:function(e,t,n){var r=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),s=2/(o+a),l=2/(r+i),c=new THREE.Matrix4;return c.elements[0]=s,c.elements[1]=0,c.elements[2]=0,c.elements[3]=0,c.elements[4]=0,c.elements[5]=l,c.elements[6]=0,c.elements[7]=0,c.elements[8]=-((o-a)*s*.5),c.elements[9]=(r-i)*l*.5,c.elements[10]=-(t+n)/(n-t),c.elements[11]=-1,c.elements[12]=0,c.elements[13]=0,c.elements[14]=-(2*n*t)/(n-t),c.elements[15]=0,c}}]),_createClass(e,[{key:"getTransforms",value:function(t,n){for(var r=this._params.filter(function(e){return e}).map(function(r){return e.makeTransform(r,t,n)}),i=1;i<r.length;++i)r[i].viewport.left=r[i-1].viewport.left+r[i-1].viewport.width;return r}}]),e}(),WebVRBootstrapper=function(){function e(e,n){function r(){if("complete"===document.readyState){if(1===t){if(isMobile){var i=VRDisplay.prototype.requestPresent;VRDisplay.prototype.requestPresent=function(e){return i.call(this,e[0])}}}else.5===t?navigator.getVRDisplays=function(){return navigator.getVRDevices().then(function(e){for(var t={},n=null,r=0;r<e.length;++r){var i=e[r];n=i.hardwareUnitId,t[n]||(t[n]={});var o=t[n];i instanceof HMDVRDevice?o.display=i:e[r]instanceof PositionSensorVRDevice&&(o.sensor=i)}var a=[];for(n in t)a.push(new LegacyVRDisplayPolyfill(t[n].display,t[n].sensor));return a})}:.4===t?navigator.getVRDisplays=Promise.reject.bind(Promise,"You're using an extremely old version of Firefox Nightly. Please update your browser. https://webvr.info/get-chrome/"):.1===t?navigator.getVRDisplays=Promise.resolve.bind(Promise,[new CardboardVRDisplayPolyfill]):navigator.getVRDisplays=Promise.resolve.bind(Promise,[]);var o=navigator.getVRDisplays;return navigator.getVRDisplays=function(){return o.call(navigator).then(function(e){return 0!==e.length&&e[0]instanceof StandardMonitorPolyfill||e.unshift(new StandardMonitorPolyfill),e})},document.removeEventListener("readystatechange",r),n(function(t,n){loadFiles(e,t,function(){navigator.getVRDisplays().then(n)})}),!0}}r()||document.addEventListener("readystatechange",r)}var t=function(){return navigator.getVRDisplays?1:navigator.getVRDevices?.5:navigator.mozGetVRDevices?.4:isMobile?.1:0}();e.Version=t;var n=!1;return e.dispalyPresentChangeCheck=function(){1===t&&isMobile&&n!==FullScreen.isActive&&(window.dispatchEvent(new Event("vrdisplaypresentchange")),n=FullScreen.isActive)},e}();</script><script type="text/javascript">WebVRBootstrapper([["../../PrimroseDependencies.min.js",683813],["../../Primrose.min.js",213710],["../../doc/temple/app.js",2604]], function (startDownload) {
  function addButton(text, thunk) {
    var btn = document.createElement("button");
    btn.type = "button";
    btn.appendChild(document.createTextNode(text));
    btn.addEventListener("click", thunk);
    document.getElementById("fullScreenButtonContainer").appendChild(btn);
  }
  var b = document.querySelector("progress");
  startDownload(function (n, m) {
    b.max = m;
    b.value = n;
  }, function () {
    b.style.display = "none";
    function vrButton(display, i) {
      addButton(display.displayName, env.goFullScreen.bind(env, i));
    }
    env.addEventListener("ready", function () {
      env.displays.forEach(vrButton);
    }, false);
  });
});</script></head><body><!-- start main.jade main block --><h1>Example: Procedurally generated room</h1><canvas id="frontBuffer"></canvas><progress></progress><div id="fullScreenButtonContainer"></div><!-- end main.jade main block --></body></html>