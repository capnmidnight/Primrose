<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
        <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
        <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

        <link type="text/css" href="public_html/css/main.css" rel="stylesheet">

        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <script type="text/javascript" src="public_html/js/core.js"></script>
        <script type="text/javascript" src="public_html/js/testing.js"></script>
        <script type="text/javascript" src="public_html/js/Rope.js"></script>
        <script type="text/javascript" src="public_html/js/Grammar.js"></script>
        <script type="text/javascript" src="public_html/js/TextBuffer.js"></script>
        <script type="text/javascript" src="public_html/js/Keys.js"></script>
        <script type="text/javascript" src="public_html/js/code_pages/EN_US.js"></script>
        <script type="text/javascript" src="public_html/js/code_pages/EN_UK.js"></script>
        <script type="text/javascript" src="public_html/js/code_pages/EN_IN.js"></script>
        <script type="text/javascript" src="public_html/js/code_pages/EN_CMS.js"></script>
        <script type="text/javascript" src="public_html/js/code_pages/DEU.js"></script>
        <script type="text/javascript" src="public_html/js/code_pages/FRA.js"></script>
        <script type="text/javascript" src="public_html/js/Cursor.js"></script>
        <script type="text/javascript" src="public_html/js/Themes.js"></script>
        <script type="text/javascript" src="public_html/js/Primrose.js"></script>
        <script type="text/javascript" src="public_html/js/Commands.js"></script>
        <script type="text/javascript" src="public_html/js/tests.js"></script>

        <title>Primrose: a cross-browser, syntax-highlighting code editor control for WebGL and other uses</title>
    </head>

    <body>
        <header>
            <div class="inner">
                <h1>Primrose</h1>
                <h2>A cross-browser, syntax-highlighting code editor control for WebGL and other uses</h2>
                <a href="https://github.com/capnmidnight/Primrose" class="button"><small>View project on</small> GitHub</a>
            </div>
        </header>

        <div id="content-wrapper">
            <div class="inner clearfix">
                <section id="main-content">
                    <h1>
                        <a id="primrose-a-text-editor-that-draws-to-canvas" class="anchor" href="#primrose-a-text-editor-that-draws-to-canvas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Primrose: a cross-browser, syntax-highlighting code editor control for WebGL and other uses</h1>

                    <p>Primrose[0] is a lightweight[1] text editor control for Web browsers[2]. It can be used as a texture on a WebGL mesh. It includes basic syntax highlighting and keyboard shortcuts.</p>

                    <h2><a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>

                    <p>Go ahead, try some tippity-typing in the box below.</p>
                    <canvas id="output" width="690" height="300"></canvas>
                    <script type="text/javascript">
                        var prim = new Primrose(document.getElementById("output"), {
                            file: "(function (){\n" +
                                    "    var i, output;\n" +
                                    "    for (i = 1; i < 101; i++) {\n" +
                                    "        output = \"\";\n" +
                                    "        if (!(i % 3)) output += \"Fizz\";\n" +
                                    "        if (!(i % 5)) output += \"Buzz\";\n" +
                                    "        console.log(output || i);\n" +
                                    "    }    \n" +
                                    "});\n"
                        });
                        prim.drawText();
                    </script>

                    <p>[NOTE: this is an extremely early proof-of-concept. There are still some bugs of the known and unknown variety. In particular, I have no way of testing whether or not the international keyboard support is correct. Consider contributing!]</p>

                    <h2><a id="a-problem" class="anchor" href="#a-problem" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Problem</h2>

                    <p>You and I have a problem. We are writing HTML5 Single-Page Applications, primarily based around the Canvas tag (in my case, WebVR demos) and 
                        we want to provide an editable text control <em>within</em> the Canvas context. We also want that text control to provide the basic features 
                        we've come to expect from most modern text editors, e.g. the standard range of keyboard shortcuts and basic syntax highlighting.</p>

                    <p>At first, I was tempted to implement syntax highlighting with a Content-Editable Div or IFrame element, layered on top of the Canvas element.
                        At face value it seems like a good idea: leverage the awesome text formatting power of the browser. Unfortunately, I quickly learned that 
                        Content-Editable is built with WYSIWYG editing of emails in mind, where the formatting is directly controlled by the user, not by heuristics 
                        defined by the programmer.</p>

                    <p>But it is possible, and a number of third party controls do it [3]. However, I personally haven't yet found such a third party control that was 
                        the right mix of features and ease-of-use for my needs. They usually involve project configurations that don't mesh well with my own projects, 
                        or they are tightly integrated into a larger framework of a full WYSIWYG editor.</p>

                    <p>I had also considered skipping the syntax highlighting altogether, going with a regular, ol' TextArea element instead. Or even if I were to 
                        acquire a working Content-Editable solution[4], there was a second problem. All solutions involving overlaying an HTML element do not 
                        composite well with the graphics context. This works fine in 2D, where elements are built in layers, but in 3D with WebGL, the HTML Element 
                        is not be a part the scene and does not work with the depth buffering. The text will always be a 2D element masquerading in a 3D world, 
                        never overlapping properly with other objects in the scene.</p>

                    <p>There is also an annoying procedural problem of having to duplicate all of the world and camera transformations from the WebGL context to 
                        CSS3 3D transforms[5]. With the stereo rendering I'm doing for WebVR demos, keeping a secondary HTML element in sync with the edits made 
                        in a primary element turns into a lot of work.</p>

                    <h2><a id="a-solution" class="anchor" href="#a-solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Solution</h2>

                    <p>Primrose emulates common features found in text editor controls, drawing directly to a Canvas element. It can be configured to source events 
                        from other elements--useful when Canvas is being used as a texture and thus is not a part of the DOM to be able to receive input events. And
                        it is fully programmable, allowing the implementer to customize its operation quickly and easily. It is designed to be a simple, 
                        syntax-highlighting source code editor, not an everything-to-everyone WYSIWYG editor.</p>

                    <h2><a id="licensing" class="anchor" href="#licensing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Licensing</h2>

                    <p>Primrose is free, open source software (<a href="https://github.com/capnmidnight/Primrose/blob/master/LICENSE.md">GPLv3</a>) and may be readily used with other FOSS.</p>

                    <p>If you would like to use Primrose in proprietary projects, please contact me directly for licensing options.</p>

                    <h2>
                        <a id="contributions" class="anchor" href="#contributions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributions</h2>

                    <p>To simplify licensing issues, contributions to Primrose require a copyright assignment to me, Sean T. McBeth. Please include your name and email
                        address in the <a href="https://github.com/capnmidnight/Primrose/blob/master/CONTRIBUTORS.md">CONTRIBUTORS.md</a> file with your pull request. This will serve as your copyright assignment.</p>

                    <h2>
                        <a id="notes" class="anchor" href="#notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Notes</h2>

                    <ol>
                        <li>The name is arbitrary.</li>

                        <li>"Lightweight" in the context of GUI controls means "rendered in software", as opposed to "using the native GUI controls provided by 
                            the operating system". In this context, we're considering the browser to be a part of the "operating system", as from the perspective of 
                            a SPA, it is.</li>

                        <li>It requires only that your browser implement Canvas and the Graphics2D context in their most common, basic forms. I am not aware of
                            any commonly-used browsers that have not had this feature for several years now.</li>

                        <li>And thankfully have solved a plethora of browser compatability issues along the way. Luckily, rendering from scratch side-steps a 
                            lot of those problems.</li>

                        <li>Or another, obscure solution involving rendering HTML elements in SVG that has a bevy of its own issues involving cross-browser 
                            compatibility and security issues.</li>

                        <li>Violating the DRY principle, and fraught with cross-browser peril.</li>
                    </ol>
                </section>

                <aside id="sidebar">
                    <a href="https://github.com/capnmidnight/Primrose/zipball/master" class="button">
                        <small>Download</small>
                        .zip file
                    </a>
                    <a href="https://github.com/capnmidnight/Primrose/tarball/master" class="button">
                        <small>Download</small>
                        .tar.gz file
                    </a>

                    <p class="repo-owner"><a href="https://github.com/capnmidnight/Primrose"></a> is maintained by <a href="https://github.com/capnmidnight">capnmidnight</a>.</p>

                    <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
                </aside>
            </div>
        </div>
    </body>
</html>
