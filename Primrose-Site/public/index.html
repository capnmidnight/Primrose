<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
        <title>Primrose: code editor control in WebGL</title>
        <link type="text/css" rel="stylesheet" href="/stylesheets/style.css" />
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r69/three.min.js"></script>
        <script type="text/javascript" src="dist/Primrose.latest.min.js"></script>
    </head>

    <body>
        <header>
            <div class="inner">
                <h1>Primrose</h1>
                <h2>A cross-browser, syntax-highlighting code editor control for WebGL and other uses</h2>
                <a href="https://github.com/capnmidnight/Primrose" class="button"><small>View project on</small> GitHub</a>
            </div>
        </header>

        <div id="content-wrapper">
            <div class="inner clearfix">
                <section id="main-content">
                    <h1>
                        <a id="primrose-a-text-editor-that-draws-to-canvas" class="anchor" href="#primrose-a-text-editor-that-draws-to-canvas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Primrose: text editing in a texture</h1>

                    <p>Primrose is a lightweight text editor control for Web browsers. It can be used as a texture on a WebGL mesh. It includes basic syntax highlighting and keyboard shortcuts.</p>

                    <h1>Demonstration</h1>
                    <p>Click on the cube below and try editing the text with keyboard controls.</p>
                    <p>Alternately, you may try <a href="editor.html">Primrose in a 2D environment.</a></p>

                    <div id="controls"></div>
                    <canvas id="output" style="width:100%;height:500px;border:dashed 2px red"></canvas>
                    <script type="text/javascript">
                        var prim, cube;
                        function setup() {
                            var ctrls = findEverything();
                            prim = new Primrose("editor", {
                                width: "750px",
                                height: "375px",
                                mouseEventSource: ctrls.output,
                                file: setup.toString()
                            });
                            var scene = new THREE.Scene(),
                                    camera = new THREE.PerspectiveCamera(75, ctrls.output.width / ctrls.output.height, 0.1, 1000),
                                    renderer = new THREE.WebGLRenderer({
                                        canvas: ctrls.output,
                                        alpha: true,
                                        antialias: true
                                    }),
                                    geometry = new THREE.BoxGeometry(3, 1.5, 3),
                                    texture = new THREE.Texture(prim.getCanvas()),
                                    material = new THREE.MeshBasicMaterial({
                                        map: texture,
                                        transparent: false,
                                        useScreenCoordinates: false,
                                        color: 0xffffff,
                                        shading: THREE.FlatShading}),
                                    rotAxis = new THREE.Vector3(0.25, 1, 0.125);

                            cube = new THREE.Mesh(geometry, material);

                            renderer.setSize(ctrls.output.clientWidth, ctrls.output.clientHeight);
                            texture.anisotropy = renderer.getMaxAnisotropy();

                            ctrls.controls.appendChild(prim.operatingSystemSelect);
                            ctrls.controls.appendChild(prim.keyboardSelect);
                            ctrls.controls.appendChild(prim.themeSelect);


                            // the following will be necessary for Three.js r70
                            //renderer.setPixelRatio(window.devicePixelRatio);

                            scene.add(cube);
                            camera.position.z = 3;
                            prim.focus();
                            function render(t) {
                                requestAnimationFrame(render);
                                texture.needsUpdate = true;
                                cube.quaternion.setFromAxisAngle(rotAxis, t / 10000);
                                renderer.render(scene, camera);
                            }
                            requestAnimationFrame(render);
                        }
                        setup();
                    </script>  

                    <p>[NOTE: This is still an early alpha release, with bugs of both the known and unknown variety. In particular, I have no way of testing whether 
                        or not the international keyboard support is correct. But the results so far are promising. Consider contributing!]</p>

                    <h2><a id="a-problem" class="anchor" href="#a-problem" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Problem</h2>

                    <p>I want a syntax highlighting text editor control for use in the Web browser, specifically one that I can easily use in a WebGL context
                        as a texture on a mesh. Blah blah blah WebVR blah blah blah the virtual desktop blah blah blah. Whatever. I want one.</p>

                    <p>From past experience with Content-Editable elements, I knew there were a lot of cross-browser compatability issues to work out. For those
                        past projects, I had often opted to use a plain TextArea element, just to avoid the problem. And while a number of third party controls do 
                        the Content-Editable thing, I hadn't found one that was the right mix of features and ease-of-use for my needs. They usually involve project
                        configurations that don't mesh well with my own projects, or they are tightly integrated into a larger framework of a full WYSIWYG editor.</p>

                    <p>Additionally, all solutions involving overlaying an HTML element do not composite well with the graphics context. This works fine in 2D, where 
                        elements are built in layers, but in 3D with WebGL, the HTML Element is not a part the scene and does not work with the depth buffering. 
                        The text will always be a 2D element masquerading in a 3D world, never overlapping properly with other objects in the scene.</p>

                    <p>So, I started 2015 with the goal of fixing it.</p>

                    <h2><a id="a-solution" class="anchor" href="#a-solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Solution</h2>

                    <p>Primrose emulates common features found in text editor controls, drawing directly to a Canvas element. It can be configured to source events 
                        from other elements--useful when Canvas is being used as a texture and thus is not a part of the DOM to be able to receive input events. And
                        it is fully programmable, allowing the implementer to customize its operation quickly and easily. It is designed to be a simple, 
                        syntax-highlighting source code editor, not an everything-to-everyone WYSIWYG editor.</p>

                    <h2>Screenshot</h2>

                    <p><a href="images/screenshot1.jpg" target="_blank"><img alt="screenshot" src="images/screenshot1.jpg"></a></p>

                    <h2><a id="licensing" class="anchor" href="#licensing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Licensing</h2>

                    <p>Primrose is free, open source software (<a href="https://github.com/capnmidnight/Primrose/blob/master/LICENSE.md">GPLv3</a>) and may be readily used with other FOSS.</p>

                    <p>If you would like to use Primrose in proprietary projects, please contact me directly for licensing options.</p>

                    <h2>
                        <a id="contributions" class="anchor" href="#contributions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributions</h2>

                    <p>To simplify licensing issues, contributions to Primrose require a copyright assignment to me, Sean T. McBeth. Please include your name and email
                        address in the <a href="https://github.com/capnmidnight/Primrose/blob/master/CONTRIBUTORS.md">CONTRIBUTORS.md</a> file with your pull request. This will serve as your copyright assignment.</p>

                </section>

                <aside id="sidebar">
                    <a href="https://github.com/capnmidnight/Primrose/zipball/master" class="button">
                        <small>Download</small>
                        .zip file
                    </a>
                    <a href="https://github.com/capnmidnight/Primrose/tarball/master" class="button">
                        <small>Download</small>
                        .tar.gz file
                    </a>

                    <p class="repo-owner"><a href="https://github.com/capnmidnight/Primrose"></a> is maintained by <a href="https://github.com/capnmidnight">capnmidnight</a>.</p>

                    <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
                </aside>
            </div>
        </div>
    </body>
</html>
