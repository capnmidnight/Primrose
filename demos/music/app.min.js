function text(e,t){return e=e||1,text3D(e*textSize,t).center()}function Board(e){this.object=hub(),this.title=text3D(.15,e).center().colored(colorPlay).addTo(this.object).named("text"+e).at(0,.7,-1.3),this.btns=[],this.btnState=[],this.type=e,range(numButtons,function(e){var t=Math.floor(e/height),i=e%height,o=10*(midWidth-t),n=10*(i-midHeight),r=box(padSize,padSize,padDepth).colored(colorOff).named("btn"+e).latLon(n,o);box(1.1*padSize,1.1*padSize,.9*padDepth).colored(colorPlay).named("bevel"+e).addTo(r),r.addEventListener("select",this.select.bind(this,e)),r.addEventListener("enter",this.play.bind(this,e,0)),this.object.add(r),this.btns.push(r)}.bind(this))}var height=8,width=4,numButtons=width*height,midWidth=(width-1)/2,midHeight=(height-1)/2,colorOn=16777215,colorOff=16711680,colorPlay=16776960,boards=[],t=0,measure=0,lastMeasure=null,padSize=.22,padDepth=.02,textSize=.05,skipOne=!1,perMeasure=2/height,DIST=v3(),env=new Primrose.BrowserEnvironment({groundTexture:"../images/deck.png",font:"../fonts/helvetiker_regular.typeface.json",backgroundColor:0,useFog:!0,useGaze:!0,drawDistance:10,fullScreenButtonContainer:"#fullScreenButtonContainer",progress:Preloader.thunk});Board.prototype.play=function(e,t){this.highlight(e,colorPlay),this.object.getWorldDirection(DIST);var i=.85*perMeasure;env.music.play(this.type,25-numButtons+3*e,.25,i,t).at(this.object.x,this.object.y,this.object.z,DIST.x,DIST.y,DIST.z),setTimeout(this.highlight.bind(this,e),1e3*i)},Board.prototype.update=function(){if(measure!==lastMeasure)for(var e=env.audio.context.currentTime,t=perMeasure*Math.ceil(e/perMeasure),i=t-e,o=0;o<width;++o){var n=o*height+measure;this.btnState[n]&&this.play(n,i)}DIST.set(this.object.position.x,env.input.head.position.y,this.object.position.z),this.object.position.lerp(DIST,.01)},Board.prototype.highlight=function(e,t){t=t||this.btnState[e]&&colorOn||colorOff;var i=this.btns[e];i.colored(t).named(i.name)},Board.prototype.select=function(e,t){env.input.hasMouse&&"MousePointer"!==t.pointer.name||(this.btnState[e]=!this.btnState[e],this.highlight(e))},env.addEventListener("ready",function(){var e=Primrose.Audio.Music.TYPES,t=e.length;e.forEach(function(e,i){var o=new Board(e);boards.push(o),env.scene.add(o.object),o.object.latLon(0,100*(i-(t-1)/2)/t)}),Preloader.hide()}),env.addEventListener("update",function(){skipOne||(t+=env.deltaTime,t>perMeasure&&(t-=perMeasure,measure=(measure+1)%height),boards.forEach(function(e){e.update()}),lastMeasure=measure),skipOne=!1}),window.addEventListener("focus",function(){skipOne=!0});