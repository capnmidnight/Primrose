function sigfig(a,b){var c=Math.pow(10,b),d=(Math.round(a*c)/c).toString();if(b>0){var e=d.indexOf(".");for(-1===e&&(d+=".",e=d.length-1);d.length-e-1<b;)d+="0"}return d}function getSetting(a,b){if(window.localStorage){var c=window.localStorage.getItem(a);if(c)try{return JSON.parse(c)}catch(d){console.error("getSetting",a,c,typeof c,d)}}return b}function setSetting(a,b){if(window.localStorage&&b)try{window.localStorage.setItem(a,JSON.stringify(b))}catch(c){console.error("setSetting",a,b,typeof b,c)}}function deleteSetting(a){window.localStorage&&window.localStorage.removeItem(a)}function readForm(a){var b={};if(a)for(var c in a){var d=a[c];"INPUT"!==d.tagName&&"SELECT"!==d.tagName||d.dataset&&d.dataset.skipcache||("text"===d.type||"password"===d.type||"SELECT"===d.tagName?b[c]=d.value:("checkbox"===d.type||"radio"===d.type)&&(b[c]=d.checked))}return b}function writeForm(a,b){if(b)for(var c in a){var d=a[c];null===b[c]||void 0===b[c]||"INPUT"!==d.tagName&&"SELECT"!==d.tagName||d.dataset&&d.dataset.skipcache||("text"===d.type||"password"===d.type||"SELECT"===d.tagName?d.value=b[c]:("checkbox"===d.type||"radio"===d.type)&&(d.checked=b[c]))}}function InsideSphereGeometry(a,b,c,d,e,f,g){"use strict";THREE.Geometry.call(this),this.type="InsideSphereGeometry",this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g},a=a||50,b=Math.max(3,Math.floor(b)||8),c=Math.max(2,Math.floor(c)||6),d=void 0!==d?d:0,e=void 0!==e?e:2*Math.PI,f=void 0!==f?f:0,g=void 0!==g?g:Math.PI;var h,i,j=[],k=[];for(i=0;c>=i;i++){var l=[],m=[];for(h=b;h>=0;h--){var n=h/b,o=i/c,p=new THREE.Vector3;p.x=-a*Math.cos(d+n*e)*Math.sin(f+o*g),p.y=a*Math.cos(f+o*g),p.z=a*Math.sin(d+n*e)*Math.sin(f+o*g),this.vertices.push(p),l.push(this.vertices.length-1),m.push(new THREE.Vector2(1-n,1-o))}j.push(l),k.push(m)}for(i=0;c>i;i++)for(h=0;b>h;h++){var q=j[i][h+1],r=j[i][h],s=j[i+1][h],t=j[i+1][h+1],u=this.vertices[q].clone().normalize(),v=this.vertices[r].clone().normalize(),w=this.vertices[s].clone().normalize(),x=this.vertices[t].clone().normalize(),y=k[i][h+1].clone(),z=k[i][h].clone(),A=k[i+1][h].clone(),B=k[i+1][h+1].clone();Math.abs(this.vertices[q].y)===a?(y.x=(y.x+z.x)/2,this.faces.push(new THREE.Face3(q,s,t,[u,w,x])),this.faceVertexUvs[0].push([y,A,B])):Math.abs(this.vertices[s].y)===a?(A.x=(A.x+B.x)/2,this.faces.push(new THREE.Face3(q,r,s,[u,v,w])),this.faceVertexUvs[0].push([y,z,A])):(this.faces.push(new THREE.Face3(q,r,t,[u,v,x])),this.faceVertexUvs[0].push([y,z,B]),this.faces.push(new THREE.Face3(r,s,t,[v.clone(),w,x.clone()])),this.faceVertexUvs[0].push([z.clone(),A,B.clone()]))}this.computeFaceNormals();for(var C=0;C<this.faces.length;++C){var D=this.faces[C];D.normal.multiplyScalar(-1);for(var E=0;E<D.vertexNormals.length;++E)D.vertexNormals[E].multiplyScalar(-1)}this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)}function shell(a,b,c,d,e){var f=.45;void 0===d&&(d=Math.PI*f),void 0===e&&(e=Math.PI*f);var g=1.5*Math.PI-.5*d,h=.5*(Math.PI-e),i=new InsideSphereGeometry(a,b,c,g,d,h,e,!0);return i}function axis(a,b){var c=hub();return put(brick(16711680,a,b,b)).on(c),put(brick(65280,b,a,b)).on(c),put(brick(255,b,b,a)).on(c),c}function box(a,b,c){return void 0===b&&(b=a,c=a),new THREE.BoxGeometry(a,b,c)}function light(a,b,c,d){return new THREE.PointLight(a,b,c,d)}function v3(a,b,c){return new THREE.Vector3(a,b,c)}function quad(a,b,c,d){return void 0===b&&(b=a),new THREE.PlaneBufferGeometry(a,b,c,d)}function hub(){return new THREE.Object3D}function brick(a,b,c,d){return textured(box(b||1,c||1,d||1),a,!1,1,b,d)}function put(a){return{on:function(b){return b.add(a),{at:function(b,c,d){return a.position.set(b,c,d),a}}}}}function textured(a,b,c,d,e,f){var g;if(void 0===d&&(d=1),"number"==typeof b)g=c?new THREE.MeshBasicMaterial({transparent:!0,color:b,opacity:d,shading:THREE.FlatShading}):new THREE.MeshLambertMaterial({transparent:!0,color:b,opacity:d});else{var h;h="string"==typeof b?THREE.ImageUtils.loadTexture(b):b instanceof Primrose.Text.Controls.TextBox?b.renderer.texture:b,g=c?new THREE.MeshBasicMaterial({color:16777215,map:h,transparent:!0,shading:THREE.FlatShading,side:THREE.DoubleSide,opacity:d}):new THREE.MeshLambertMaterial({color:16777215,map:h,transparent:!0,side:THREE.DoubleSide,opacity:d}),e*f>1&&(h.wrapS=h.wrapT=THREE.RepeatWrapping,h.repeat.set(e,f))}var i=null;return a.type.indexOf("Geometry")>-1?i=new THREE.Mesh(a,g):a instanceof THREE.Object3D&&(a.material=g,i=a),i}function sphere(a,b,c){return new THREE.SphereBufferGeometry(a,b,c)}function cylinder(a,b,c,d,e,f,g,h){return new THREE.CylinderGeometry(a,b,c,d,e,f,g,h)}function cloud(a,b,c){for(var d=new THREE.Geometry,e=0;e<a.length;++e)d.vertices.push(a[e]);var f=new THREE.PointCloudMaterial({color:b,size:c});return new THREE.PointCloud(d,f)}function copyObject(a,b){for(var c=[{dest:a,source:b}];c.length>0;){var d=c.pop();b=d.source,a=d.dest;for(var e in b)b.hasOwnProperty(e)&&("object"!=typeof b[e]?a[e]=b[e]:(a[e]||(a[e]={}),c.push({dest:a[e],source:b[e]})))}}function inherit(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a}function range(a,b,c,d){for(var e=c&&a||0,f=c&&b||a,g=d&&c||1,h=d||c||b,i=e;f>i;i+=g)h(i)}function emit(a,b){for(var c=this.listeners[a],d=0;d<c.length;++d)c[d](b)}function clearKeyOption(a){this.value="",this.dataset.keycode=""}function setKeyOption(a,b,c){this.dataset.keycode=c.keyCode,this.value=this.value||Primrose.Keys[c.keyCode],this.value=this.value.toLocaleLowerCase().replace("arrow",""),this.blur();var d=b.map(function(a){return a.value.toLocaleUpperCase()}).join(", ");10===d.length&&(d=d.replace(/, /g,"")),a.innerHTML=d}function setupKeyOption(a,b,c,d,e){var f=b[c];f.value=d.toLocaleLowerCase(),f.dataset.keycode=e,f.addEventListener("keydown",clearKeyOption),f.addEventListener("keyup",setKeyOption.bind(f,a,b))}function combineDefaults(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d.hasOwnProperty(c)||(d[c]=b[c]);return d}!function(a,b){function c(a){for(var b=1,c=0,d=a.split("").map(function(a){return a.charCodeAt(0)}),e=0;e<d.length;++e)b=(b+d[e])%32771,c=(c+b)%32771;return c<<8|b}function d(a,b){for(var c=b.split("."),d=0;d<c.length&&a;++d)a=a[c[d]];return a}function e(a,b){return"string"==typeof b||b instanceof String?d(a,b):b}function f(a){var b=p;if("undefined"!=typeof a&&a.length>0)for(var c=a.split("."),d="",e="",f=0;f<c.length;++f)"undefined"==typeof b[c[f]]&&(b[c[f]]={}),d+=e+c[f],e=".",b=b[c[f]],d.length>0&&!b.name&&(b.name=d);return b}function g(a,b,c){if(c){if("string"==typeof c||c instanceof String){var d=null;if("page"===a)d=b,b="";else{var e=b.split(".");d=e.pop(),b=e.join(".")}c={name:d,description:c}}"undefined"==typeof c.fieldType&&(c.fieldType=a),!c.parent&&b.length>0&&(c.parent=b);var g=f(b),i=a+"s";i=i.replace(/ys$/,"ies").replace(/ss$/,"ses"),g[i]||(g[i]=[]);for(var j=g[i],k=!1,l=0;l<j.length;++l)j[l].name===c.name&&(k=!0);if(!k){var m={};["examples","issues","comments"].forEach(function(a){"undefined"!=typeof c[a]&&(m[a]=c[a],delete c[a])}),c=h(c),j.push(c),"class"===c.fieldType&&c.baseClass&&s.subClass(c.baseClass,c);for(var n in m)for(var o=m[n],p=n.substring(0,n.length-1),l=0;l<o.length;++l)s[p](c.fullName.replace(/::/g,"."),o[l])}return c.value}}function h(a){var b=(a.parent&&a.parent+"."||"")+a.name,d=f(b);if(!d.fieldType){for(var e in a)d[e]=a[e];d.fullName||("issue"===d.fieldType&&Object.defineProperty(d,"issueID",{get:function(){return c(this.parent+"."+this.name)}}),Object.defineProperty(d,"fullName",{get:function(){var a="";return this.parent&&(a+=this.parent,a+="method"===this.fieldType||"property"===this.fieldType||"event"===this.fieldType?"::":"example"===this.fieldType||"issue"===this.fieldType?": ":"."),a+=this.name}})),d.id||Object.defineProperty(d,"id",{get:function(){return this.fullName.replace(/(\.|:)/g,"_").replace(/ /g,"")}}),i(b)||setTimeout(i,1,b)}return d}function i(a){var b=d(window,a);if(b){if("function"==typeof b)for(var c=b.toString(),e=null;e=q.exec(c);){var f=e[1],g=e.index+e[0].length,h=j(a,c.substring(g));1===h.length?h.unshift(a):h[0]=a+"."+h[0],s[f].apply(null,h)}b.help=s.bind(null,a)}return b}function j(a,b){for(var c=[],d=0,e=0,f=0,g=!1;d<b.length;++d){var h=b.charAt(d);if('"'!==h||0!==d&&"\\"===b.charAt(d-1)||(g=!g),g||("("===h||"{"===h||"["===h?++f:(")"===h||"}"===h||"]"===h)&&--f),(0===f||1===f&&","===h&&!g)&&(c.push(l(a,b.substring(e+1,d).trim())),e=d,0===f))break}return c}function k(a){return a}function l(a,b){var c=[],d=function(a){var b="&STRING_LIT"+c.length+";";return"'"===a[0]&&(a=a.replace(/\\"/g,"&_DBLQUOTE_;").replace(/\\'/g,"&_SGLQUOTE_;").replace(/"/g,'\\"').replace(/'/g,'"').replace(/&_DBLQUOTE_;/g,'\\"').replace(/&_SGLQUOTE_;/g,"\\'")),c.push(a),b},e=function(a,b){return c[b]},f=b.replace(/'(\\'|[^'])+'/g,d).replace(/"(\\"|[^"])+"/g,d).replace(/\b(\w+)\b\s*:/g,'"$1":').replace(/&STRING_LIT(\d+);/g,e).replace(/&STRING_LIT(\d+);/g,e).replace(/\\\r?\n/g,"");try{return JSON.parse(f)}catch(g){throw console.error(a+": "+b+" => "+f),g}}function m(a,b,c){if(a&&a.length>0){if("undefined"==typeof b)return new Promise(m.bind(null,a));var d=function(){0===a.length?b():Primrose.HTTP.getText(a.shift(),function(a){var b="";a=a.replace(/^#*\s+([^\n]+)\r?\n\s*/,function(a,c){return b=c,""}),s.page(b,a),d()},c)};d(0)}}function n(a,b){for(var c in b){var d=b[c];b.hasOwnProperty(c)&&"number"==typeof d&&s.value(a,{name:c,type:"Number",description:d.toString(),value:d})}}var o=b("marked"),p={fieldType:"database",fullName:"[Global]",id:"Global",description:"These are the elements in the global namespace."},q=/\bpliny\s*\.\s*(\w+)/gm,r={format:function(a){var b=null;if(b="string"==typeof a||a instanceof String?d(p,a):a){var c=this.shortDescription(!0,b);return c+="\n\n"+["parent","description","parameters","returns","errors","pages","namespaces","classes","functions","values","events","properties","methods","enumerations","records","examples","issues","comments"].map(r.checkAndFormatField.bind(this,b)).filter(k).join("\n")}},checkAndFormatField:function(a,b,c){var d=a[b];return d?this.formatField(a,b,d,c):void 0}};r.html={format:function(a){var b=e(p,a);return'<section id="'+b.id+'" class="'+b.fieldType+'"><article>'+r.format.call(r.html,b)+"</article></section>"},formatField:function(a,b,c){var d="";return d+="enumeration"===a.fieldType&&"values"===b?this.formatEnumeration(a,b,c):"page"===a.fieldType&&"description"===b?o(c):c instanceof Array?this.formatArray(a,b,c):"parent"===b?'<p>Contained in <a href="#'+s.get(c).id+'">'+c+"</a></p>":"description"===b?o(c):"returns"===b?"<h3>Return value</h3>"+o(c):"<dl><dt>"+b+"</dt><dd>"+c+"</dd></dl>"},formatEnumeration:function(a,b,c){for(var d="<table><thead><tr><th>Name</th><th>Value</th><tr><thead><tbody>",e=0;e<c.length;++e){var f=c[e];d+="<tr><td>"+f.name+"</td><td>"+f.description+"</td></tr>"}return d+="</tbody></table>"},examplesFormat:function(a,b){for(var c="",d=0;d<b.length;++d){var e=b[d];c+='<div><h3><a href="#'+e.id+'">'+e.name+"</a></h3>"+o(e.description)+"</div>"}return c},issuesFormat:function(a,b){for(var c={open:"",closed:""},d=0;d<b.length;++d){var e=b[d],f='<div><h3><a href="#'+e.id+'">'+e.issueID+": "+e.name+" ["+e.type+"]</a></h3>"+o(e.description)+"</div>";c[e.type]+=f}return c.open+"<h2>Closed Issues</h2>"+c.closed},commentsFormat:function(a,b){for(var c="",d=0;d<b.length;++d){var e=b[d];c+="<aside><h3>"+e.name+"</h3>"+o(e.description),"undefined"!=typeof e.comments&&e.comments instanceof Array&&(c+=this.formatArray(e,"comments",e.comments)),c+="</aside>"}return c},formatArray:function(a,b,c){var d="<h2>";"class"===a.fieldType&&("parameters"===b?d+="constructor ":"functions"===b&&(d+="static ")),"description"!==b&&(d+=b),d+="</h2>";var e=b+"Format";return d+=this[e]?this[e](a,c):'<ul class="'+b+'">'+c.map(this.formatArrayElement.bind(this,b)).join("")+"</ul>"},formatArrayElement:function(a,b){var c="<li>";if(b.description){var d=b.description.match(/^(([^\n](\n[^\n])?)+)\n\n/);d=d?d[1]+"...":b.description,c+="<dl><dt>"+this.shortDescription(!1,b)+"</dt><dd>"+o(d)+"</dd></dl>"}else c+=this.shortDescription(!1,b);return c+="</li>"},shortDescription:function(a,b){var c="",d=a?"h1":"span",e="function"===b.fieldType||"method"===b.fieldType||"event"===b.fieldType,f=e||"class"===b.fieldType||"namespace"===b.fieldType||"enumeration"===b.fieldType||"subClass"===b.fieldType||"record"===b.fieldType;return c+="<"+d+">",f&&!a&&(c+='<a href="#'+b.id+'">'),"page"!==b.fieldType&&(c+="<code>"),c+=a&&"example"!==b.fieldType?b.fullName:b.name,b.type&&(c+=' <span class="type">'+b.type+"</span>"),e&&(c+='<ol class="signatureParameters">',b.parameters&&(c+="<li>"+b.parameters.map(function(a){return a.name}).join("</li><li>")+"</li>"),c+="</ol>"),f&&!a&&(c+="</a>"),"page"!==b.fieldType&&(c+="</code>"),c+"</"+d+">"}},r.console={format:function(a){return r.format.call(r.console,a)},formatField:function(a,b,c){return c instanceof Array?this.formatArray(a,b,c):"description"===b?"	"+c+"\n":"	"+b+": "+c+"\n"},formatArray:function(a,b,c){var d="	";return"class"===a.fieldType&&("parameters"===b?d+="constructor ":"functions"===b&&(d+="static ")),"description"!==b&&(d+=b+":\n"),d+=c instanceof Array?c.map(this.formatArrayElement.bind(this,b)).join(""):c},formatArrayElement:function(a,b,c){var d="		"+c+": "+this.shortDescription(!1,b);return b.description&&(d+=" - "+b.description,"parameters"!==a&&"properties"!==a&&"methods"!==a&&d.length>200&&(d=d.substring(0,200)+"...")),d+="\n"},shortDescription:function(a,b){var c="";return(a||b.type)&&(c+="["+(b.type||b.fieldType)+"] "),c+=a?b.fullName:b.name,("function"===b.fieldType||"method"===b.fieldType)&&(c+="(",b.parameters&&(c+=b.parameters.map(this.shortDescription.bind(this,!1)).join(", ")),c+=")"),c}};var s=r.console.format;s.database=p,s.formats=r,s.get=d.bind(null,s.database),s.load=m,s.setEnumerationValues=n,["namespace","event","function","value","class","property","method","enumeration","record","subClass","example","error","issue","comment","page"].forEach(function(a){s[a]=g.bind(null,a)}),a.exports=s}("undefined"!=typeof module&&module||function(a){var b={};return Object.defineProperty(b,"exports",{get:function(){return window[a]},set:function(b){window[a]=b}}),b}("pliny"),function(a){return window[a]}),window.Primrose=function(){"use strict";pliny.namespace("Primrose","Primrose helps you make VR applications for web browsers as easy as making other types of interactive web pages.\n\nThis top-level namespace contains classes for manipulating and viewing 3D environments.");var a={};return pliny.namespace("Primrose.Input","The Input namespace contains classes that handle user input, for use in navigating the 3D environment."),a.Input={},pliny.namespace("Primrose.Output","The Output namespace contains classes that handle output to devices other than the screen (e.g. Audio, Music, etc.)."),a.Output={},pliny.namespace("Primrose.Text","The Text namespace contains classes everything regarding the Primrose source code editor."),a.Text={},pliny.namespace("Primrose.Text.CodePages","The CodePages namespace contains international keyboard parameters."),a.Text.CodePages={},pliny.namespace("Primrose.Text.CommandPacks","The CommandPacks namespace contains sets of keyboard shortcuts for different types of text-oriented controls."),a.Text.CommandPacks={},pliny.namespace("Primrose.Text.Controls","The Controls namespace contains different types of text-oriented controls."),a.Text.Controls={},pliny.namespace("Primrose.Text.Grammars","The Grammars namespace contains grammar parsers for different types of programming languages, to enable syntax highlighting."),a.Text.Grammars={},pliny.namespace("Primrose.Text.OperatingSystems","The OperatingSystems namespace contains sets of keyboard shortcuts for different operating systems."),a.Text.OperatingSystems={},pliny.namespace("Primrose.Text.Renderers","The Renderers namespace contains different renderers for using the general Text Editor logic in different output systems. Current, Canvas2D is the only system that works. A system for DOM elements exists, but it is broken and not likely to be fixed any time soon."),a.Text.Renderers={},pliny.namespace("Primrose.Text.Themes","The Themes namespace contains color themes for text-oriented controls, for use when coupled with a parsing grammar."),a.Text.Themes={},pliny.value("Primrose",{name:"SYS_FONTS",type:"String",description:"A selection of fonts that will match whatever the user's operating system normally uses."}),a.SYS_FONTS="-apple-system, '.SFNSText-Regular', 'San Francisco', 'Roboto', 'Segoe UI', 'Helvetica Neue', 'Lucida Grande', sans-serif",pliny.value("Primrose",{name:"SKINS",type:"Array of String",description:"A selection of color values that closely match skin colors of people."}),a.SKINS=["#FFDFC4","#F0D5BE","#EECEB3","#E1B899","#E5C298","#FFDCB2","#E5B887","#E5A073","#E79E6D","#DB9065","#CE967C","#C67856","#BA6C49","#A57257","#F0C8C9","#DDA8A0","#B97C6D","#A8756C","#AD6452","#5C3836","#CB8442","#BD723C","#704139","#A3866A","#870400","#710101","#430000","#5B0001","#302E2E"],pliny.value("Primrose",{name:"SKIN_VALUES",type:"Array of Number",description:"A selection of color values that closely match skin colors of people."}),a.SKIN_VALUES=a.SKINS.map(function(a){return parseInt(a.substring(1),16)}),pliny.value("",{name:"isMobile",type:"Boolean",description:'Flag indicating the current system is a recognized "mobile"\n\r\ndevice, usually possessing a motion sensor.'}),window.isMobile=function(a){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substring(0,4))}(navigator.userAgent||navigator.vendor||window.opera),pliny.value("",{name:"isiOS",type:"Boolean",description:"Flag indicating the current system is a device running the Apple\n\r\niOS operating system: iPad, iPod Touch, iPhone. Useful for invoking optional code\n\r\npaths necessary to deal with deficiencies in Apple's implementation of web standards."}),window.isiOS=/iP(hone|od|ad)/.test(navigator.userAgent||""),pliny.value("",{name:"isOSX",type:"Boolean",description:"Flag indicating the current system is a computer running the Apple\n\r\nOSX operating system. Useful for changing keyboard shortcuts to support Apple's\n\r\nidiosynchratic, concensus-defying keyboard shortcuts."}),window.isOSX=/Macintosh/.test(navigator.userAgent||""),pliny.value("",{name:"isWindows",type:"Boolean",description:"Flag indicating the current system is a computer running one of\n\r\nthe Microsoft Windows operating systems. We have not yet found a use for this flag."}),window.isWindows=/Windows/.test(navigator.userAgent||""),pliny.value("",{name:"isOpera",type:"Boolean",description:"Flag indicating the browser is currently calling itself Opera.\n\r\nOpera is a substandard browser that lags adoption of cutting edge web technologies,\n\r\nso you are not likely to need this flag if you are using Primrose, other than to\n\r\ncajole users into downloading a more advanced browser such as Mozilla Firefox or\n\r\nGoogle Chrome."}),window.isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,pliny.value("",{name:"isSafari",type:"Boolean",description:"Flag indicating the browser is currently calling itself Safari.\n\r\nSafari is an overly opinionated browser that thinks users should be protected from\n\r\nthemselves in such a way as to prevent users from gaining access to the latest in\n\r\ncutting-edge web technologies. Essentially, it was replaced Microsoft Internet\n\r\nExplorer as the Internet Explorer of the web."}),window.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,pliny.value("",{name:"isChrome",type:"Boolean",description:'Flag indicating the browser is currently calling itself Chrome\n\r\nor Chromium. Chromium was one of the first browsers to implement virtual reality\n\r\nfeatures directly in the browser, thanks to the work of Brandon "Toji" Jones.'}),window.isChrome=!!window.chrome&&!window.isOpera,pliny.value("",{name:"isFirefox",type:"Boolean",description:"Flag indicating the browser is currently calling itself Firefox.\n\r\nFirefox was one of the first browsers to implement virtual reality features directly\n\r\nin the browser, thanks to the work of the MozVR team."}),window.isFirefox="undefined"!=typeof window.InstallTrigger,pliny.value("",{name:"isWebKit",type:"Boolean",description:"Flag indicating the browser is one of Chrome, Safari, or Opera.\n\r\nWebKit browsers have certain issues in common that can be treated together, like\n\r\na common basis for orientation events."}),window.isWebKit=window.isiOS||window.isOpera||window.isChrome,pliny.value("",{name:"isIE",type:"Boolean",description:"Flag indicating the browser is currently calling itself Internet\n\r\nExplorer. Once the bane of every web developer's existence, it has since passed\n\r\nthe torch on to Safari in all of its many useless incarnations."}),window.isIE=!1||!!document.documentMode,pliny.value("",{name:"isVR",type:"Boolean",description:"Flag indicating the browser supports awesomesauce as well as\n\r\nthe WebVR standard in some form."}),window.isVR=!(!navigator.getVRDevices&&!navigator.getVRDisplays),pliny.issue("",{name:"Make a getting started page.",type:"closed",description:"Make a page that explains downloading the right dependencies,\n\r\nmaking a simple page using a sample scene, making it VR capable, and adding\n\r\nobjects to it."}),pliny.issue("",{name:"Make a simple Blender tutorial.",type:"open",description:"Show where to download Blender and how to use it to make a smooth-shaded,\n\r\nflat color, low-poly scene and make it VR ready."}),pliny.issue("",{name:"Make a more advanced Blender tutorial.",type:"open",description:"Show how to do texturing in Blender."}),pliny.issue("",{name:"Make a simple lighting tutorial.",type:"open",description:"Basic point and spot lights."}),pliny.issue("",{name:"Make a simple video tutorial.",type:"open",description:"Put a quad in the scene on which a movie can play. Make it look\n\r\nlike a drive-in to be really cool."}),pliny.issue("",{name:"Make a drum machine tutorial.",type:"open",description:"Show how to create elements and useful interactions with those elements."}),pliny.issue("",{name:"Make a 3D IDE tutorial.",type:"open",description:"Show how to build the 3D editor demo."}),pliny.issue("",{name:"Make a basic server tutorial.",type:"open",description:"Show how to setup a basic Node WebSockets server to be able to do\n\r\nmultiplayer chat."}),pliny.issue("",{name:"Make an adventure demo.",type:"open",description:"Make a small adventure game of locked treasure chests and mazes."}),pliny.issue("",{name:"Make an HMD overview page.",type:"open",description:"Go into what is available, what are the key components, and how\n\r\nto build your own Google Cardboard."}),pliny.issue("",{name:"Make a tutorial on modeling a scene with Primrose and saving/exporting it.",type:"open",description:"Live program a scene and save it to an HTML file that can be put up\n\r\non a website and be ready to run in VR."}),pliny.issue("",{name:"Make a CHANGELOG",type:"open",description:"Document the changes between versions better."}),pliny.issue("",{name:"Make better icons for full-screen view.",type:"open",description:"The current icons don't match each other, and they are in a bad place on screen."}),pliny.issue("",{name:"Link examples to each other.",type:"open",description:"Make it so you can jump from one example to another, both in 2D and VR contexts."}),pliny.issue("",{name:"Make more examples on CodePen.",type:"open",description:"Demonstrate using Primrose with the different options available in CodePen."}),pliny.issue("",{name:"Update the README.",type:"open",description:"It's woefully out of date."}),pliny.issue("",{name:"Make Haptic Glove tutorial.",type:"open",description:"Offer the supplies for sale, and show how to build a haptic glove\n\r\nthat can be used with Primrose."}),pliny.issue("",{name:"Adopt ES6.",type:"open",description:"Classes and arrow functions are good. Rely on browser support for\n\r\ndevelopment. Setup a transpiler for production builds."}),pliny.issue("",{name:"Figure out a better module system.",type:"open",description:'I still want Primrose to be an "Include one JS file" type of library\n\r\nfor working in browsers. But I also want the component parts to work well with Node\n\r\nand other neuveau JS shenanigans.'}),pliny.issue("",{name:"Investigate compatability with A-Frame.",type:"open",description:"If it's easy, it won't hurt."}),pliny.issue("",{name:"Investigate compatability with SceneVR.",type:"open",description:"If it's easy, it won't hurt."}),pliny.issue("",{name:"Investigate compatability with Vizor.",type:"open",description:"If it's easy, it won't hurt."}),pliny.issue("",{name:"Investigate compatability with X3D.",type:"open",description:"If it's easy, it won't hurt."}),pliny.issue("",{name:"Investigate compatability with JanusVR.",type:"open",description:"If it's easy, it won't hurt."}),pliny.issue("",{name:"Investigate compatability with AltspaceVR.",type:"open",description:"If it's easy, it won't hurt."}),a}(),Primrose.Angle=function(){function a(a){if("number"!=typeof a)throw new Error("Angle must be initialized with a number. Initial value was: "+a);var b,c,d,e=a,f=0;pliny.property({name:"degrees",type:"Number",description:"Get/set the current value of the angle in degrees."}),Object.defineProperty(this,"degrees",{set:function(a){do b=a+f-e,c=Math.abs(b+360),d=Math.abs(b-360),b=Math.abs(b),b>c&&d>c?f+=360:b>d&&(f-=360);while(b>c||b>d);e=a+f},get:function(){return e}})}var b=Math.PI/180,c=180/Math.PI;return pliny["class"]("Primrose",{name:"Angle",description:"The Angle class smooths out the jump from 360 to 0 degrees. It\n\r\nkeeps track of the previous state of angle values and keeps the change between\n\r\nangle values to a maximum magnitude of 180 degrees, plus or minus. This allows for\n\r\nsmoother opperation as rotating past 360 degrees will not reset to 0, but continue\n\r\nto 361 degrees and beyond, while rotating behind 0 degrees will not reset to 360\n\r\nbut continue to -1 and below.\n\r\n\n\r\nWhen instantiating, choose a value that is as close as you can guess will be your\n\r\ninitial sensor readings.\n\r\n\n\r\nThis is particularly important for the 180 degrees, +- 10 degrees or so. If you\n\r\nexpect values to run back and forth over 180 degrees, then initialAngleInDegrees\n\r\nshould be set to 180. Otherwise, if your initial value is anything slightly larger\n\r\nthan 180, the correction will rotate the angle into negative degrees, e.g.:\n\r\n* initialAngleInDegrees = 0\n\r\n* first reading = 185\n\r\n* updated degrees value = -175\n\r\n\n\r\nIt also automatically performs degree-to-radian and radian-to-degree conversions.\n\r\nFor more information, see [Radian - Wikipedia, the free encyclopedia](https://en.wikipedia.org/wiki/Radian).\n\r\n\n\r\n![Radians](https://upload.wikimedia.org/wikipedia/commons/4/4e/Circle_radians.gif)",parameters:[{name:"initialAngleInDegrees",type:"Number",description:"(Required) Specifies the initial context of the angle. Zero is not always the correct value."}],examples:[{name:"Basic usage",description:'To use the Angle class, create an instance of it with `new`, and modify the `degrees` property.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var a = new Primrose.Angle(356);\n\r\n    a.degrees += 5;\n\r\n    console.log(a.degrees);\n\r\n\n\r\n## Results:\n\r\n> 361'},{name:"Convert degrees to radians",description:'Create an instance of Primrose.Angle, modify the `degrees` property, and read the `radians` property.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var a = new Primrose.Angle(10);\n\r\n    a.degrees += 355;\n\r\n    console.log(a.radians);\n\r\n\n\r\n## Results:\n\r\n> 0.08726646259971647'},{name:"Convert radians to degress",description:'Create an instance of Primrose.Angle, modify the `radians` property, and read the `degrees` property.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var a = new Primrose.Angle(0);\n\r\n    a.radians += Math.PI / 2;\n\r\n    console.log(a.degrees);\n\r\n\n\r\n## Results:\n\r\n> 90'}]}),pliny.property("Primrose.Angle",{name:"radians",type:"Number",description:"Get/set the current value of the angle in radians."}),Object.defineProperty(a.prototype,"radians",{get:function(){return this.degrees*b},set:function(a){this.degrees=a*c}}),a}(),pliny.issue("Primrose.Angle",{name:"document Angle",type:"closed",description:"Finish writing the documentation for the [Primrose.Angle](#Primrose_Angle) class in the  directory"}),Primrose.BaseControl=function(){"use strict";function a(){pliny.property({name:"controlID",type:"Number",description:"Automatically incrementing counter for controls, to make sure there is a distinct differentiator between them all."}),this.controlID=b++,pliny.property({name:"focused",type:"Boolean",description:"Flag indicating this control has received focus. You should theoretically only read it."}),this.focused=!1,pliny.property({name:"listeners",type:"Object",description:"A bag of arrays that hold the callback functions for each event. The child class of BaseControl may add such arrays to this object. By default, includes listeners for focus and blur events."}),this.listeners={focus:[],blur:[]}}var b=1;pliny["class"]("Primrose",{name:"BaseControl",description:"The BaseControl class is the parent class for all 3D controls.\n\r\nIt manages a unique ID for every new control, the focus state of the control, and\n\r\nperforms basic conversions from DOM elements to the internal Control format."}),pliny.method("Primrose.BaseControl",{name:"addEventListener",description:"Adding an event listener registers a function as being ready to receive events.",parameters:[{name:"evt",type:"String",description:"The name of the event for which we are listening."},{name:"thunk",type:"Function",description:"The callback to fire when the event occurs."}],examples:[{name:"Add an event listener.",description:'The `addEventListener()` method operates nearly identically\n\r\nto the method of the same name on DOM elements.\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var txt = new Primrose.Text.Controls.TextBox();\n\r\n    txt.addEventListener("mousemove", console.log.bind(console, "mouse move"));\n\r\n    txt.addEventListener("keydown", console.log.bind(console, "key down"));'
}]}),a.prototype.addEventListener=function(a,b){this.listeners[a]&&this.listeners[a].push(b)},pliny.method("Primrose.BaseControl",{name:"focus",description:"Sets the focus property of the control, does not change the focus property of any other control.",examples:[{name:"Focus on one control, blur all the rest",description:'When we have a list of controls and we are trying to track\n\r\nfocus between them all, we must coordinate calls between `focus()` and `blur()`.\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var ctrls = [\n\r\n      new Primrose.Text.Controls.TextBox(),\n\r\n      new Primrose.Text.Controls.TextBox(),\n\r\n      new Primrose.Text.Button()\n\r\n    ];\n\r\n\n\r\n    function focusOn(id){\n\r\n      for(var i = 0; i < ctrls.length; ++i){\n\r\n        var c = ctrls[i];\n\r\n        if(c.controlID === id){\n\r\n          c.focus();\n\r\n        }\n\r\n        else{\n\r\n          c.blur();\n\r\n        }\n\r\n      }\n\r\n    }'}]}),a.prototype.focus=function(){this.focused=!0,emit.call(this,"focus",{target:this})},pliny.method("Primrose.BaseControl",{name:"blur",description:"Unsets the focus property of the control, does not change the focus property of any other control.",examples:[{name:"Focus on one control, blur all the rest",description:'When we have a list of controls and we are trying to track\n\r\nfocus between them all, we must coordinate calls between `focus()` and `blur()`.\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var ctrls = [\n\r\n      new Primrose.Text.Controls.TextBox(),\n\r\n      new Primrose.Text.Controls.TextBox(),\n\r\n      new Primrose.Text.Button()\n\r\n    ];\n\r\n    \n\r\n    function focusOn(id){\n\r\n      for(var i = 0; i < ctrls.length; ++i){\n\r\n        var c = ctrls[i];\n\r\n        if(c.controlID === id){\n\r\n          c.focus();\n\r\n        }\n\r\n        else{\n\r\n          c.blur();\n\r\n        }\n\r\n      }\n\r\n    }'}]}),a.prototype.blur=function(){this.focused=!1,emit.call(this,"blur",{target:this})};var c="([+-]?(?:(?:\\d+(?:\\.\\d*)?)|(?:\\.\\d+)))",d="\\s*,\\s*",e="(?:em|px)",f=new RegExp("translate3d\\s*\\(\\s*"+c+e+d+c+e+d+c+e+"\\s*\\)","i"),g=new RegExp("rotate3d\\s*\\(\\s*"+c+d+c+d+c+d+c+"rad\\s*\\)","i");return pliny.method("Primrose.BaseControl",{name:"copyElement",description:"Copies properties from a DOM element that the control is supposed to match.",parameters:[{name:"elem",type:"Element",description:"The element--e.g. a button or textarea--to copy."}],examples:[{name:"Rough concept",description:'The class is not used directly. Its methods would be used in a base\n\r\nclass that implements its functionality.\n\r\n\n\r\nThe `copyElement()` method gets used when a DOM element is getting "converted"\n\r\nto a 3D element on-the-fly.\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var myDOMButton = document.querySelector("button[type=\'button\']"),\n\r\n      my3DButton = new Primrose.Button();\n\r\n    my3DButton.copyElement(myDOMButton);'}]}),a.prototype.copyElement=function(a){if(this.element=a,a.style.transform){var b=f.exec(a.style.transform);b&&this.position.set(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])),b=g.exec(a.style.transform),b&&this.quaternion.setFromAxisAngle((new THREE.Vector3).set(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])),parseFloat(b[4]))}},pliny.issue("Primrose.BaseControl",{name:"document BaseControl",type:"closed",description:"Finish writing the documentation for the [Primrose.BaseControl](#Primrose_BaseControl) class in the  directory"}),a}(),Primrose.Button=function(){function a(b,c,d){Primrose.BaseControl.call(this),d=combineDefaults(d,a),d.minDeflection=Math.cos(d.minDeflection),d.colorUnpressed=new THREE.Color(d.colorUnpressed),d.colorPressed=new THREE.Color(d.colorPressed),pliny.event({name:"click",description:"Occurs when the button is activated."}),this.listeners.click=[],pliny.event({name:"release",description:"Occurs when the button is deactivated."}),this.listeners.release=[],pliny.property({name:"base",type:"THREE.Object3D",description:"The stand the button cap sits on."}),this.base=b.children[1],pliny.property({name:"base",type:"THREE.Object3D",description:"The moveable part of the button, that triggers the click event."}),this.cap=b.children[0],this.cap.name=c,this.cap.material=this.cap.material.clone(),this.cap.button=this,this.cap.base=this.base,pliny.property({name:"container",type:"THREE.Object3D",description:"A grouping collection for the base and cap."}),this.container=new THREE.Object3D,this.container.add(this.base),this.container.add(this.cap),pliny.property({name:"color",type:"Number",description:"The current color of the button cap."}),this.color=this.cap.material.color,this.name=c,this.element=null,this.startUV=function(){this.color.copy(d.colorPressed),this.element?this.element.click():emit.call(this,"click")},this.moveUV=function(){},this.endPointer=function(){this.color.copy(d.colorUnpressed),emit.call(this,"release")}}return pliny["class"]("Primrose",{name:"Button",parameters:[{name:"model",type:"THREE.Object3D",description:"A 3D model to use as the graphics for this button."},{name:"name",type:"String",description:"A name for the button, to make it distinct from other buttons."},{name:"options",type:"Object",description:"A hash of options:\n			maxThrow - The limit for how far the button can be depressed.\n			minDeflection - The minimum distance the button must be depressed before it is activated.\n			colorPressed - The color to change the button cap to when the button is activated.\n			colorUnpressed - The color to change the button cap to when the button is deactivated.\n			toggle - True if deactivating the button should require a second click. False if the button should deactivate when it is released."}],description:"A 3D button control, with a separate cap from a stand that it sits on. You click and depress the cap on top of the stand to actuate."}),inherit(a,Primrose.BaseControl),pliny.record("Primrose.Button.DEFAULTS","Default option values that override undefined options passed to the Button class."),pliny.value("Primrose.Button.DEFAULTS",{name:"maxThrow",type:"Number",description:"The limit for how far the button can be depressed."}),pliny.value("Primrose.Button.DEFAULTS",{name:"minDeflection",type:"Number",description:"The minimum distance the button must be depressed before it is activated."}),pliny.value("Primrose.Button.DEFAULTS",{name:"colorUnpressed",type:"Number",description:"The color to change the button cap to when the button is deactivated."}),pliny.value("Primrose.Button.DEFAULTS",{name:"colorPressed",type:"Number",description:"The color to change the button cap to when the button is activated."}),pliny.value("Primrose.Button.DEFAULTS",{name:"toggle",type:"Boolean",description:"True if deactivating the button should require a second click. False if the button should deactivate when it is released."}),a.DEFAULTS={maxThrow:.1,minDeflection:10,colorUnpressed:8323072,colorPressed:32512,toggle:!0},pliny.property("Primrose.Button",{name:"position",type:"THREE.Vector3",description:"The location of the button."}),Object.defineProperty(a.prototype,"position",{get:function(){return this.container.position}}),a}(),pliny.issue("Primrose.Button",{name:"document Button",type:"closed",description:"Finish writing the documentation for the [Primrose.Button](#Primrose_Button) class in the  directory"}),Primrose.ButtonFactory=function(){function a(a,b,c){pliny.property({name:"options",type:"Object",description:"The options that the user provided, so that we might change them after the factory has been created, if we so choose."}),this.options=b,"string"==typeof a?Primrose.ModelLoader.loadObject(a,function(a){this.template=a,c&&c()}.bind(this)):(pliny.property({name:"template",type:"THREE.Object3D",description:"The 3D model for the button, that will be cloned every time a new button is created."}),this.template=a)}var b=0;return pliny["class"]("Primrose",{name:"ButtonFactory",description:"Loads a model file and holds the data, creating clones of the data whenever a new button is desired.",parameters:[{name:"templateFile",type:"(String|THREE.Object3D}",description:"Either a path to a Three.js formatted JSON file, or a THREE.Object3D, that specifies a 3D model for a button, to be used as a template."},{name:"options",type:"Object",description:"The options to apply to all buttons that get created by the factory."},{name:"complete",type:"Function",description:"A callback function to indicate when the loading process has completed, if `templateFile` was a String path."}]}),pliny.method("Primrose.ButtonFactory",{name:"create",description:"Clones all of the geometry, materials, etc. in a 3D model to create a new copy of it. This really should be done with instanced objects, but I just don't have the time to deal with it right now.",parameters:[{name:"toggle",type:"Boolean",description:'True if the new button should be a toggle button (requiring additional clicks to deactivate) or a regular button (deactivating when the button is released, aka "momentary".'}],"return":"The cloned button that which we so desired."}),a.prototype.create=function(a){var c="button"+ ++b,d=this.template.clone(),e=new Primrose.Button(d,c,this.options,a);return e},a}(),pliny.issue("Primrose.ButtonFactory",{name:"document ButtonFactory",type:"closed",description:"Finish writing the documentation for the [Primrose.ButtonFactory](#Primrose_ButtonFactory) class in the  directory"}),Primrose.DOM=function(){pliny.namespace("Primrose.DOM","A few functions for manipulating DOM.");var a={};return pliny["function"]("Primrose.DOM",{name:"cascadeElement",description:"* If `id` is a string, tries to find the DOM element that has said ID\n\r\n  * If it exists, and it matches the expected tag type, returns the element, or throws an error if validation fails.\n\r\n  * If it doesn't exist, creates it and sets its ID to the provided id, then returns the new DOM element, not yet placed in the document anywhere.\n\r\n* If `id` is a DOM element, validates that it is of the expected type,\n\r\n  * returning the DOM element back if it's good,\n\r\n  * or throwing an error if it is not\n\r\n* If `id` is null, creates the DOM element to match the expected type.",parameters:[{name:"id",type:"(String|Element)",description:"A vague reference to the element. Either a String id where the element can be had, a String id to give a newly created element if it does not exist, or an Element to manipulate and validate"},{name:"tag",type:"String",description:"The HTML tag name of the element we are finding/creating/validating."},{name:"DOMClass",type:"Class",description:"The class Function that is the type of element that we are frobnicating."}],returns:"DOM element",examples:[{name:"Get an element by ID that already exists.",description:'Assuming the following HTML snippet:\n\r\n\n\r\n    grammar("HTML");\n\r\n    <div>\n\r\n      <div id="First">first element</div>\n\r\n      <section id="second-elem">\n\r\n        Second element\n\r\n        <img id="img1" src="img.png">\n\r\n      </section>\n\r\n    </div>\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var elem = Primrose.DOM.cascadeElement("second-elem", "section", HTMLElement);\n\r\n    console.assert(elem.textContent === "Second element");'},{name:"Validate the tag type.",description:'Assuming the following HTML snippet:\n\r\n\n\r\n    grammar("HTML");\n\r\n    <div>\n\r\n      <div id="First">first element</div>\n\r\n      <section id="second-elem">\n\r\n        Second element\n\r\n        <img id="img1" src="img.png">\n\r\n      </section>\n\r\n    </div>\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    //The following line of code should cause a runtime error.\n\r\n    Primrose.DOM.cascadeElement("img1", "section", HTMLElement);'},{name:"Create an element.",description:'Assuming the following HTML snippet:\n\r\n\n\r\n    grammar("HTML");\n\r\n    <div>\n\r\n      <div id="First">first element</div>\n\r\n      <section id="second-elem">\n\r\n        Second element\n\r\n        <img id="img1" src="img.png">\n\r\n      </section>\n\r\n    </div>\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var elem = Primrose.DOM.cascadeElement("img2", "img", HTMLImageElement);\n\r\n    console.assert(elem.id === "img2");\n\r\n    console.assert(elem.parentElement === null);\n\r\n    document.body.appendChild(elem);\n\r\n    console.assert(elem.parentElement === document.body);'}]}),a.cascadeElement=function(a,b,c){var d=null;if(null===a?(d=document.createElement(b),d.id=a="auto_"+b+Date.now()):void 0===c||a instanceof c?d=a:"string"==typeof a&&(d=document.getElementById(a),null===d?(d=document.createElement(b),d.id=a):d.tagName!==b.toUpperCase()&&(d=null)),null===d)throw pliny.error({name:"Invalid element",type:"Error",description:"If the element could not be found, could not be created, or one of the appropriate ID was found but did not match the expected type, an error is thrown to halt operation."}),new Error(a+" does not refer to a valid "+b+" element.");return d.innerHTML="",d},pliny["function"]("Primrose.DOM",{name:"findEverything",description:"Searches an element for all sub elements that have a named ID,\n\r\nusing that ID as the name of a field in a hashmap to store a reference to the element.\n\r\nBasically, a quick way to get at all the named elements in a page.\n\r\n\n\r\n> NOTE: You may name your IDs pretty much anything you want, but for ease of use,\n\r\n> you should name them in a camalCase fashion. See [CamelCase - Wikipedia, the free encyclopedia](https://en.wikipedia.org/wiki/CamelCase).",parameters:[{name:"elem",type:"Element",description:"(Optional) the root element from which to search. Defaults to `document`."},{name:"obj",type:"Object",description:"(Optional) the object in which to store the element references. If no object is provided, one will be created."}],returns:"An object full of element references, with fields named by the ID of the elements that were found.",examples:[{name:"Get all child elements.",description:'Assuming the following HTML snippet:\n\r\n\n\r\n    grammar("HTML");\n\r\n    <div>\n\r\n      <div id="First">first element</div>\n\r\n      <section id="second-elem">\n\r\n        Second element\n\r\n        <img id="img1" src="img.png">\n\r\n      </section>\n\r\n    </div>\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var elems = Primrose.DOM.findEverything();\n\r\n    console.log(elems.First.innerHTML);\n\r\n    console.log(elems["second-elem"].textContent);\n\r\n    console.log(elems.img1.src);\n\r\n\n\r\n## Results:\n\r\n> first element  \n\r\n> Second element  \n\r\n> img.png'}]}),a.findEverything=function(a,b){a=a||document,b=b||{};for(var c=a.querySelectorAll("*"),d=0;d<c.length;++d){var e=c[d];e.id&&e.id.length>0&&(b[e.id]=e,e.parentElement&&(e.parentElement[e.id]=e))}return b},pliny["function"]("Primrose.DOM",{name:"makeHidingContainer",description:"Takes an element and shoves it into a containing element that\n\r\nis 0x0 pixels in size, with the overflow hidden. Sometimes, we need an element\n\r\nlike a TextArea in the DOM to be able to receive key events, but we don't want the\n\r\nuser to see it, so the makeHidingContainer function makes it easy to make it disappear.",parameters:[{name:"id",type:"(String|Element)",description:"A vague reference to\n\r\nthe element. Either a String id where the element can be had, a String id to give\n\r\na newly created element if it does not exist, or an Element to manipulate and validate."},{name:"obj",type:"Element",description:"The child element to stow in the hiding container."}],returns:"The hiding container element, not yet inserted into the DOM."}),a.makeHidingContainer=function(b,c){var d=a.cascadeElement(b,"div",window.HTMLDivElement);return d.style.position="absolute",d.style.left=0,d.style.top=0,d.style.width=0,d.style.height=0,d.style.overflow="hidden",d.appendChild(c),d},a}(),pliny.issue("Primrose.DOM",{name:"document DOM",type:"closed",description:"Finish writing the documentation for the [Primrose.DOM](#Primrose_DOM) class in the  directory"}),Primrose.HTTP=function(){pliny.namespace("Primrose.HTTP","A collection of basic XMLHttpRequest wrappers.");var a={};return pliny["function"]("Primrose.HTTP",{name:"XHR",description:"Wraps up the XMLHttpRequest object into a workflow that is easier for me to handle: a single function call. Can handle both GETs and POSTs, with or  without a payload.",parameters:[{name:"method",type:"String",description:"The HTTP Verb being used for the request."},{name:"type",type:"String",description:'How the response should be interpreted. Defaults to "text". "json", "arraybuffer", and other values are also available. See the [MDN - XMLHttpRequest - responseType](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#xmlhttprequest-responsetype).'},{name:"url",type:"String",description:"The resource to which the request is being sent."},{name:"data",type:"Object",description:"The data object to use as the request body payload, if this is a PUT request."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully, even going so far as to check HTTP status code on the OnLoad event."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}],examples:[{name:"Make a GET request.",description:'Typically, you would use one of the other functions in the Primrose.HTTP namespace, but the XHR function is provided as a fallback in case those others do not meet your needs.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    Primrose.HTTP.XHR("GET", "json", "localFile.json",\n\r\n      console.log.bind(console, "done"),\n\r\n      console.error.bind(console),\n\r\n      console.log.bind(console, "progress"));\n\r\n\n\r\n## Results:\n\r\n> Object {field1: 1, field2: "Field2"}'}]}),a.XHR=function(a,b,c,d,e,f,g){var h=new XMLHttpRequest;h.onerror=f,h.onabort=f,h.onprogress=g,h.onload=function(){h.status<400?e&&e(h.response):f&&f()},h.open(a,c),b&&(h.responseType=b),d?(h.setRequestHeader("Content-Type","application/json;charset=UTF-8"),h.send(JSON.stringify(d))):h.send()},pliny["function"]("Primrose.HTTP",{name:"get",description:"Process an HTTP GET request.",parameters:[{name:"type",type:"String",description:'How the response should be interpreted. Defaults to "text". "json", "arraybuffer", and other values are also available. See the [MDN - XMLHttpRequest - responseType](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#xmlhttprequest-responsetype).'},{name:"url",type:"String",description:"The resource to which the request is being sent."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully, even going so far as to check HTTP status code on the OnLoad event."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}],examples:[{name:"Make a GET request.",description:'Typically, you would use one of the other functions in the Primrose.HTTP namespace, but the XHR function is provided as a fallback in case those others do not meet your needs.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    Primrose.HTTP.get("json", "localFile.json",\n\r\n      console.log.bind(console, "done"),\n\r\n      console.error.bind(console),\n\r\n      console.log.bind(console, "progress"));\n\r\n\n\r\n## Results:\n\r\n> Object {field1: 1, field2: "Field2"}'}]}),a.get=function(b,c,d,e,f){a.XHR("GET",b||"text",c,null,d,e,f)},pliny["function"]("Primrose.HTTP",{name:"put",description:"Process an HTTP PUT request.",parameters:[{name:"type",type:"String",description:'How the response should be interpreted. Defaults to "text". "json", "arraybuffer", and other values are also available. See the [MDN - XMLHttpRequest - responseType](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#xmlhttprequest-responsetype).'},{name:"url",type:"String",description:"The resource to which the request is being sent."},{name:"data",type:"Object",description:"The data object to use as the request body payload, if this is a PUT request."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully, even going so far as to check HTTP status code on the OnLoad event."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}]}),a.post=function(b,c,d,e,f,g){a.XHR("POST",b,c,d,e,f,g)},pliny["function"]("Primrose.HTTP",{name:"getObject",description:"Get a JSON object from a server.",parameters:[{name:"url",type:"String",description:"The resource to which the request is being sent."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully, even going so far as to check HTTP status code on the OnLoad event."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}],examples:[{name:"Make a GET request for a JSON object.",description:'Typically, you would use one of the other functions in the Primrose.HTTP namespace, but the XHR function is provided as a fallback in case those others do not meet your needs.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    Primrose.HTTP.getObject("localFile.json",\n\r\n      console.log.bind(console, "done"),\n\r\n      console.error.bind(console),\n\r\n      console.log.bind(console, "progress"));\n\r\n\n\r\n## Results:\n\r\n> Object {field1: 1, field2: "Field2"}'}]}),a.getObject=function(b,c,d,e){a.get("json",b,c,d,e)},pliny["function"]("Primrose.HTTP",{name:"getText",description:"Get plain text from a server.",parameters:[{name:"url",type:"String",description:"The resource to which the request is being sent."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully, even going so far as to check HTTP status code on the OnLoad event."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}],examples:[{name:"Make a GET request for plain text.",description:'Use this to load arbitrary files and do whatever you want with them.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    Primrose.HTTP.getText("localFile.json",\n\r\n      console.log.bind(console, "done"),\n\r\n      console.error.bind(console),\n\r\n      console.log.bind(console, "progress"));\n\r\n\n\r\n## Results:\n\r\n> "Object {field1: 1, field2: \\"Field2\\"}"'}]}),a.getText=function(b,c,d,e){a.get("text",b,c,d,e)},pliny["function"]("Primrose.HTTP",{name:"sendObject",description:"Send a JSON object to a server.",parameters:[{name:"url",type:"String",description:"The resource to which the request is being sent."},{name:"data",type:"Object",description:"The data object to use as the request body payload, if this is a PUT request."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully, even going so far as to check HTTP status code on the OnLoad event."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}]}),a.sendObject=function(b,c,d,e,f){a.put("json",b,c,d,e,f)},a}(),pliny.issue("Primrose.HTTP",{name:"document HTTP",type:"closed",description:"Finish writing the documentation for the [Primrose.HTTP](#Primrose_HTTP) class in the  directory"}),Primrose.Keys=function(){"use strict";pliny.enumeration("Primrose",{name:"Keys",description:"Keycode values for system keys that are the same across all international standards"});var a={MODIFIER_KEYS:["ctrl","shift","alt","meta","meta_l","meta_r"],SHIFT:16,CTRL:17,ALT:18,META:91,META_L:91,META_R:92,BACKSPACE:8,TAB:9,ENTER:13,SPACE:32,DELETE:46,PAUSEBREAK:19,CAPSLOCK:20,NUMLOCK:144,SCROLLLOCK:145,INSERT:45,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,SELECTKEY:93,NUMBER0:48,NUMBER1:49,NUMBER2:50,NUMBER3:51,NUMBER4:52,NUMBER5:53,NUMBER6:54,NUMBER7:55,NUMBER8:56,NUMBER9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};for(var b in a){var c=a[b];a.hasOwnProperty(b)&&"number"==typeof c&&(a[c]=b)}return pliny.setEnumerationValues("Primrose.Keys",a),a}(),pliny.issue("Primrose.Keys",{name:"document Keys",type:"closed",description:"Finish writing the documentation for the [Primrose.Keys](#Primrose_Keys) class in the  directory"}),Primrose.ModelLoader=function(){function a(a){return a.traverse(function(a){a.geometry&&(a.geometry.computeBoundingSphere(),a.geometry.computeBoundingBox())}),a}function b(a){a.traverse(function(a){if(a instanceof THREE.Mesh)for(var b in f)a[b]=a[b]||f[b](a)})}function c(a,b,c,d){try{d.buttons=[],d.traverse(function(a){a.isButton&&d.buttons.push(new Primrose.Button(a.parent,a.name)),a.name&&(d[a.name]=a)}),a&&a(d)}catch(e){b&&b(e)}}function d(a,b,c,e){pliny.property({name:"template",type:"THREE.Object3D",description:"When a model is loaded, stores a reference to the model so it can be cloned in the future."});var f=function(a){this.template=a,b&&b(a)}.bind(this);d.loadObject(a,f,c,e)}if("undefined"==typeof THREE)return function(){};var e=THREE.ObjectLoader&&new THREE.ObjectLoader,f={isButton:function(a){return a.material&&a.material.name.match(/^button\d+$/)},isSolid:function(a){return!a.name.match(/^(water|sky)/)},isGround:function(a){return a.material&&a.material.name&&a.material.name.match(/\bground\b/)}};return pliny["class"]("Primrose",{name:"ModelLoader",description:"Loads a model and keeps a reference of it around to be able to use as a factory of models.\n\r\n\n\r\n> NOTE: ModelLoader uses the same Cross-Origin Request policy as THREE.ImageUtils,\n\r\n> meaning you may use THREE.ImageUtils.crossOrigin to configure the cross-origin\n\r\n> policy that Primrose uses for requests.",parameters:[{name:"src",type:"String",description:"The file from which to load."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}],examples:[{name:"Load a basic model.",description:'When Blender exports the Three.js JSON format, models are treated as full scenes, essentially making them scene-graph sub-trees. Instantiating a Primrose.ModelLoader object referencing one of these model files creates a factory for that model that we can use to generate an arbitrary number of copies of the model in our greater scene.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    // Create the scene where objects will go\n\r\n    var scene = new THREE.Scene(),\n\r\n     \n\r\n    // Load up the file, optionally "check it out"\n\r\n      modelFactory = new Primrose.ModelLoader("path/to/model.json", function(model){\n\r\n        model.traverse(function(child){\n\r\n          // Do whatever you want to the individual child objects of the scene.\n\r\n        });\n\r\n    }, console.error.bind(console), console.log.bind(console, "Progress:"));\n\r\n     \n\r\n    // Add copies of the model to the scene every time the user hits the ENTER key.\n\r\n    window.addEventListener("keyup", function(evt){\n\r\n      // If the template object exists, then the model loaded successfully.\n\r\n      if(modelFactory.template && evt.keyCode === 10){\n\r\n        scene.add(modelFactory.clone());\n\r\n      }\n\r\n    });'}]}),pliny.method("Primrose.ModelLoader",{name:"clone",description:"Creates a copy of the stored template model.",returns:"A THREE.Object3D that is a copy of the stored template.",examples:[{name:"Load a basic model.",description:'When Blender exports the Three.js JSON format, models are treated as full scenes, essentially making them scene-graph sub-trees. Instantiating a Primrose.ModelLoader object referencing one of these model files creates a factory for that model that we can use to generate an arbitrary number of copies of the model in our greater scene.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    // Create the scene where objects will go\n\r\n    var scene = new THREE.Scene(),\n\r\n    \n\r\n    // Load up the file, optionally "check it out"\n\r\n      modelFactory = new Primrose.ModelLoader("path/to/model.json", function(model){\n\r\n        model.traverse(function(child){\n\r\n          // Do whatever you want to the individual child objects of the scene.\n\r\n        });\n\r\n    }, console.error.bind(console), console.log.bind(console, "Progress:"));\n\r\n    \n\r\n    // Add copies of the model to the scene every time the user hits the ENTER key.\n\r\n    window.addEventListener("keyup", function(evt){\n\r\n      // If the template object exists, then the model loaded successfully.\n\r\n      if(modelFactory.template && evt.keyCode === 10){\n\r\n        scene.add(modelFactory.clone());\n\r\n      }\n\r\n    });'}]}),d.prototype.clone=function(){var a=this.template.clone();return a.traverse(function(b){b instanceof THREE.SkinnedMesh&&(a.animation=new THREE.Animation(b,b.geometry.animation),!this.template.originalAnimationData&&a.animation.data&&(this.template.originalAnimationData=a.animation.data),a.animation.data||(a.animation.data=this.template.originalAnimationData))}.bind(this)),b(a),a},pliny["function"]("Primrose.ModelLoader",{name:"loadScene",description:"Asynchronously loads a model intended to be used as a scene. It processes the scene for attributes, creates new properties on the scene to give us faster access to some of the elements within it. It also translates objects marked as GUI elements into instances of their associated elements within the Primrose framework.\n\r\n\n\r\n> NOTE: ModelLoader uses the same Cross-Origin Request policy as THREE.ImageUtils,\n\r\n> meaning you may use THREE.ImageUtils.crossOrigin to configure the cross-origin\n\r\n> policy that Primrose uses for requests.",parameters:[{name:"src",type:"String",description:"The file from which to load."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}],examples:[{name:"Load a basic model.",description:'When Blender exports the Three.js JSON format, models are treated as full scenes, essentially making them scene-graph sub-trees. Instantiating a Primrose.ModelLoader object referencing one of these model files creates a factory for that model that we can use to generate an arbitrary number of copies of the model in our greater scene.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    // Create the scene where objects will go\n\r\n    var renderer = new THREE.WebGLRenderer(),\n\r\n        currentScene = new THREE.Scene(),\n\r\n        camera = new THREE.PerspectiveCamera();\n\r\n     \n\r\n    // Load up the file, optionally "check it out"\n\r\n    Primrose.ModelLoader.loadScene("path/to/scene.json", function(newScene){\n\r\n      currentScene = newScene;\n\r\n      newScene.traverse(function(child){\n\r\n        if(child instanceof THREE.PerspectiveCamera){\n\r\n          camera = child;\n\r\n        }\n\r\n        // Do whatever else you want to the individual child objects of the scene.\n\r\n      });\n\r\n    }, console.error.bind(console), console.log.bind(console, "Progress:"));\n\r\n     \n\r\n    function paint(t){\n\r\n      requestAnimationFrame(paint);\n\r\n      renderer.render(scene, camera);\n\r\n    }\n\r\n     \n\r\n    requestAnimationFrame(paint);'
}]}),d.loadScene=function(a,b,e,f){var g=c.bind(window,b,e,f);d.loadObject(a,g,e,f)},pliny["function"]("Primrose.ModelLoader",{name:"loadObject",description:"Asynchronously loads a JSON file as a JavaScript object. It processes the scene for attributes, creates new properties on the scene to give us faster access to some of the elements within it. It uses callbacks to tell you when loading progresses, when it's complete, or when an error occurred. Useful for one-time use models.\n\r\n\n\r\n> NOTE: ModelLoader uses the same Cross-Origin Request policy as THREE.ImageUtils,\n\r\n> meaning you may use THREE.ImageUtils.crossOrigin to configure the cross-origin\n\r\n> policy that Primrose uses for requests.",parameters:[{name:"src",type:"String",description:"The file from which to load."},{name:"success",type:"Function",description:"(Optional) the callback to issue whenever the request finishes successfully."},{name:"error",type:"Function",description:"(Optional) the callback to issue whenever an error occurs."},{name:"progress",type:"Function",description:"(Optional) A callback function to be called as the download from the server progresses."}],examples:[{name:"Load a basic model.",description:'When Blender exports the Three.js JSON format, models are treated as full scenes, essentially making them scene-graph sub-trees. Instantiating a Primrose.ModelLoader object referencing one of these model files creates a factory for that model that we can use to generate an arbitrary number of copies of the model in our greater scene.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    // Create the scene where objects will go\n\r\n    var renderer = new THREE.WebGLRenderer(),\n\r\n        currentScene = new THREE.Scene(),\n\r\n        camera = new THREE.PerspectiveCamera();\n\r\n     \n\r\n    // Load up the file\n\r\n    Primrose.ModelLoader.loadObject(\n\r\n      "path/to/model.json",\n\r\n      scene.add.bind(scene),\n\r\n      console.error.bind(console),\n\r\n      console.log.bind(console, "Progress:"));\n\r\n     \n\r\n    function paint(t){\n\r\n      requestAnimationFrame(paint);\n\r\n      renderer.render(scene, camera);\n\r\n    }\n\r\n     \n\r\n    requestAnimationFrame(paint);'}]}),d.loadObject=function(c,d,f,g){var h=function(a){b(a),d&&d(a)};if(e)try{e.setCrossOrigin(THREE.ImageUtils.crossOrigin),e.load(c,function(b){h(a(b))},g,f)}catch(i){f&&f(i)}else f&&f("JSON seems to be broken right now")},d}(),pliny.issue("Primrose.ModelLoader",{name:"document ModelLoader",type:"closed",description:"Finish writing the documentation for the [Primrose.ModelLoader](#Primrose_ModelLoader) class in the  directory"}),pliny.issue("Primrose.ModelLoader",{name:"Move ModelLoader to a Three.js specific namespace",type:"open",description:"This class won't work outside of a Three.js context. The bits of code that absolutely must have Three.js should be moved to their own namespace."}),Primrose.NetworkedInput=function(){function a(a,b,c){function d(a){for(var b=0;b<Primrose.Keys.MODIFIER_KEYS.length;++b){var c=Primrose.Keys.MODIFIER_KEYS[b];this.inputState[c]=a[c+"Key"]}}this.name=a,this.commands={},this.commandNames=[],this.socket=c,this.enabled=!0,this.paused=!1,this.ready=!0,this.transmitting=!0,this.receiving=!0,this.socketReady=!1,this.inPhysicalUse=!0,this.inputState={},this.lastState="",window.addEventListener("keydown",d.bind(this),!1),window.addEventListener("keyup",d.bind(this),!1),c&&(c.on("open",function(){this.socketReady=!0,this.inPhysicalUse=!this.receiving}.bind(this)),c.on(a,function(a){this.receiving&&(this.inPhysicalUse=!1,this.decodeStateSnapshot(a),this.fireCommands())}.bind(this)),c.on("close",function(){this.inPhysicalUse=!0,this.socketReady=!1}.bind(this)));for(var e in b)this.addCommand(e,b[e]);for(var f=0;f<Primrose.Keys.MODIFIER_KEYS.length;++f)this.inputState[Primrose.Keys.MODIFIER_KEYS[f]]=!1}return pliny["class"]("Primrose",{name:"NetworkedInput",description:"<under construction>"}),a.prototype.addCommand=function(a,b){b.name=a,b=this.cloneCommand(b),b.repetitions=b.repetitions||1,b.state={value:null,pressed:!1,wasPressed:!1,fireAgain:!1,lt:0,ct:0,repeatCount:0},this.commands[a]=b,this.commandNames.push(a)},a.prototype.cloneCommand=function(a){throw new Error("cloneCommand function must be defined in subclass")},a.prototype.update=function(a){if(this.ready&&this.enabled&&this.inPhysicalUse&&!this.paused){for(var b in this.commands){var c=this.commands[b];if(c.state.wasPressed=c.state.pressed,c.state.pressed=!1,!c.disabled){var d=!0;if(c.metaKeys)for(var e=0;e<c.metaKeys.length&&d;++e){var f=c.metaKeys[e];d=d&&(this.inputState[Primrose.Keys.MODIFIER_KEYS[f.index]]&&!f.toggle||!this.inputState[Primrose.Keys.MODIFIER_KEYS[f.index]]&&f.toggle)}this.evalCommand(c,d,a),c.state.lt+=a,c.state.lt>=c.dt&&c.state.repeatCount++,c.state.fireAgain=c.state.pressed&&c.state.lt>=c.dt&&c.state.repeatCount>=c.repetitions,c.state.fireAgain&&(c.state.lt=0,c.state.repeatCount=0)}}if(this.socketReady&&this.transmitting){var g=this.makeStateSnapshot();g!==this.lastState&&(this.socket.emit(this.name,g),this.lastState=g)}this.fireCommands()}},a.prototype.fireCommands=function(){if(this.ready&&!this.paused)for(var a in this.commands){var b=this.commands[a];b.state.fireAgain&&b.commandDown&&b.commandDown(),!b.state.pressed&&b.state.wasPressed&&b.commandUp&&b.commandUp()}},a.prototype.makeStateSnapshot=function(){var a="",b=0,c=Object.keys(this.commands).length;for(var d in this.commands){var e=this.commands[d];e.state&&(a+=b<<2|(e.state.pressed?1:0)|(e.state.fireAgain?2:0)+":"+e.state.value,c-1>b&&(a+="|")),++b}return a},a.prototype.decodeStateSnapshot=function(a){var b,c;for(c in this.commands)b=this.commands[c],b.state.wasPressed=b.state.pressed;for(var d=a.split("|"),e=0;e<d.length;++e){var f=d[e],g=f.split(":"),h=parseInt(g[0],10),i=0!==(1&h),j=0!==(2&k),k=parseInt(g[2],10);h>>=2,c=this.commandNames(h),b=this.commands[c],b.state={value:parseFloat(g[1]),pressed:i,fireAgain:j}}},a.prototype.setProperty=function(a,b,c){this.commands[b]&&(this.commands[b][a]=c)},a.prototype.addToArray=function(a,b,c){this.commands[b]&&this.commands[b][a]&&this.commands[b][a].push(c)},a.prototype.removeFromArray=function(a,b,c){if(this.commands[b]&&this.commands[b][a]){var d=this.commands[b][a],e=d.indexOf(c);e>-1&&d.splice(e,1)}},a.prototype.invertInArray=function(a,b,c){if(this.commands[b]&&this.commands[b][a]){var d=this.commands[b][a],e=d.indexOf(c);e>-1&&(d[e]*=-1)}},a.prototype.pause=function(a){this.paused=a},a.prototype.isPaused=function(){return this.paused},a.prototype.enable=function(a,b){(void 0===b||null===b)&&(b=a,a=null),a?this.setProperty("disabled",a,!b):this.enabled=b},a.prototype.isEnabled=function(a){return a&&this.commands[a]&&!this.commands[a].disabled},a.prototype.transmit=function(a){this.transmitting=a},a.prototype.isTransmitting=function(){return this.transmitting},a.prototype.receive=function(a){this.receiving=a},a.prototype.isReceiving=function(){return this.receiving},a}(),pliny.issue("Primrose.NetworkedInput",{name:"document NetworkedInput",type:"open",description:"Finish writing the documentation for the [Primrose.NetworkedInput](#Primrose_NetworkedInput) class in the  directory"}),Primrose.Projector=function(){function a(a){a&&"undefined"==typeof THREE&&(self.THREE={REVISION:"72dev"},void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:a>0?1:+a}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),THREE.Quaternion=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this.onChangeCallback(),this},setFromEuler:function(a,b){if(a instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);return"XYZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===a.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h),b!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this.onChangeCallback(),this},setFromRotationMatrix:function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this._w=.25/b,this._x=(k-i)*b,this._y=(f-j)*b,this._z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this._w=(k-i)/b,this._x=.25*b,this._y=(e+g)/b,this._z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this._w=(f-j)/b,this._x=(e+g)/b,this._y=.25*b,this._z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this._w=(g-e)/b,this._x=(f+j)/b,this._y=(i+k)/b,this._z=.25*b),this.onChangeCallback(),this},setFromUnitVectors:function(){var a,b,c=1e-6;return function(d,e){return void 0===a&&(a=new THREE.Vector3),b=d.dot(e)+1,c>b?(b=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,e),this._x=a.x,this._y=a.y,this._z=a.z,this._w=b,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this.onChangeCallback(),this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this.onChangeCallback(),this},multiplyVector3:function(a){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);if(Math.abs(i)<.001)return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;return this._w=f*j+this._w*k,this._x=c*j+this._x*k,this._y=d*j+this._y*k,this._z=e*j+this._z*k,this.onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){return void 0===b&&(b=0),this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this.onChangeCallback(),this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){}},THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)},THREE.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(){var a;return function(b){return b instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===a&&(a=new THREE.Quaternion),this.applyQuaternion(a.setFromEuler(b)),this}}(),applyAxisAngle:function(){var a;return function(b,c){return void 0===a&&(a=new THREE.Quaternion),this.applyQuaternion(a.setFromAxisAngle(b,c)),this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},project:function(){var a;return function(b){return void 0===a&&(a=new THREE.Matrix4),a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld)),this.applyProjection(a)}}(),unproject:function(){var a;return function(b){return void 0===a&&(a=new THREE.Matrix4),a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix)),this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3),a.set(c,c,c),b.set(d,d,d),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var a,b;return function(c){return void 0===a&&(a=new THREE.Vector3),a.copy(c).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new THREE.Vector3),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new THREE.Vector3),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(a,b){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(a,b){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this.z=a.array[b+2],this}},THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(a){return this.elements.set(a.elements),this},extractPosition:function(a){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)},copyPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractBasis:function(a,b,c){var d=this.elements;return a.set(d[0],d[1],d[2]),b.set(d[4],d[5],d[6]),c.set(d[8],d[9],d[10]),this},makeBasis:function(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);var c=this.elements,d=b.elements,e=1/a.set(d[0],d[1],d[2]).length(),f=1/a.set(d[4],d[5],d[6]).length(),g=1/a.set(d[8],d[9],d[10]).length();return c[0]=d[0]*e,c[1]=d[1]*e,c[2]=d[2]*e,c[4]=d[4]*f,c[5]=d[5]*f,c[6]=d[6]*f,c[8]=d[8]*g,c[9]=d[9]*g,c[10]=d[10]*g,this}}(),makeRotationFromEuler:function(a){a instanceof THREE.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=m+n*i,b[5]=l-o*i,b[9]=-g*h,b[2]=o-l*i,b[6]=n+m*i,b[10]=f*h}else if("YXZ"===a.order){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p+s*g,b[4]=r*g-q,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=q*g-r,b[6]=s+p*g,b[10]=f*h}else if("ZXY"===a.order){var p=h*j,q=h*k,r=i*j,s=i*k;b[0]=p-s*g,b[4]=-f*k,b[8]=r+q*g,b[1]=q+r*g,b[5]=f*j,b[9]=s-p*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){var l=f*j,m=f*k,n=g*j,o=g*k;b[0]=h*j,b[4]=n*i-m,b[8]=l*i+o,b[1]=h*k,b[5]=o*i+l,b[9]=m*i-n,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j,b[4]=w-t*k,b[8]=v*k+u,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=u*k+v,b[10]=t-w*k}else if("XZY"===a.order){var t=f*h,u=f*i,v=g*h,w=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=t*k+w,b[5]=f*j,b[9]=u*k-v,b[2]=v*k-u,b[6]=g*j,b[10]=w*k+t}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},setRotationFromQuaternion:function(a){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(a)},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},lookAt:function(){var a,b,c;return function(d,e,f){void 0===a&&(a=new THREE.Vector3),void 0===b&&(b=new THREE.Vector3),void 0===c&&(c=new THREE.Vector3);var g=this.elements;return c.subVectors(d,e).normalize(),0===c.length()&&(c.z=1),a.crossVectors(f,c).normalize(),0===a.length()&&(c.x+=1e-4,a.crossVectors(f,c).normalize()),b.crossVectors(c,a),g[0]=a.x,g[4]=b.x,g[8]=c.x,g[1]=a.y,g[5]=b.y,g[9]=c.y,g[2]=a.z,g[6]=b.z,g[10]=c.z,this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},multiplyVector3:function(a){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),a.applyProjection(this)},multiplyVector4:function(a){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},multiplyVector3Array:function(a){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3),void 0===c&&(c=0),void 0===d&&(d=b.length);for(var e=0,f=c;d>e;e+=3,f+=3)a.fromArray(b,f),a.applyMatrix4(this),a.toArray(b,f);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Vector3),void 0===c&&(c=0),void 0===d&&(d=b.length/b.itemSize);for(var e=0,f=c;d>e;e++,f++)a.x=b.getX(f),a.y=b.getY(f),a.z=b.getZ(f),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)},crossVector:function(a){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var a;return function(){void 0===a&&(a=new THREE.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0===u){var v="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},translate:function(a){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},decompose:function(){var a,b;return function(c,d,e){void 0===a&&(a=new THREE.Vector3),void 0===b&&(b=new THREE.Matrix4);var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),i=a.set(f[8],f[9],f[10]).length(),j=this.determinant();0>j&&(g=-g),c.x=f[12],c.y=f[13],c.z=f[14],b.elements.set(this.elements);var k=1/g,l=1/h,m=1/i;return b.elements[0]*=k,b.elements[1]*=k,b.elements[2]*=k,b.elements[4]*=l,b.elements[5]*=l,b.elements[6]*=l,b.elements[8]*=m,b.elements[9]*=m,b.elements[10]*=m,d.setFromRotationMatrix(b),e.x=g,e.y=h,e.z=i,this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,
this},makePerspective:function(a,b,c,d){var e=c*Math.tan(THREE.Math.degToRad(.5*a)),f=-e,g=f*b,h=e*b;return this.makeFrustum(g,h,f,e,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e,k=(b+a)/h,l=(c+d)/i,m=(f+e)/j;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2/i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},equals:function(a){for(var b=this.elements,c=a.elements,d=0;16>d;d++)if(b[d]!==c[d])return!1;return!0},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]}},THREE.Math={generateUUID:function(){var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=new Array(36),d=0;return function(){for(var e=0;36>e;e++)8===e||13===e||18===e||23===e?c[e]="-":14===e?c[e]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19===e?3&a|8:a]);return c.join("")}}(),clamp:function(a,b,c){return b>a?b:a>c?c:a},clampBottom:function(a,b){return b>a?b:a},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*(3-2*a))},smootherstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*a*(a*(6*a-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a++,a}}),this.objectIDs=[],this.objects={},this.transformCache={},this.vertCache={},this.a=new THREE.Vector3,this.b=new THREE.Vector3,this.c=new THREE.Vector3,this.d=new THREE.Vector3,this.f=new THREE.Vector3,this.p=new THREE.Vector3,this.m=new THREE.Matrix4,this.listeners={hit:[]}}return pliny["class"]("Primrose",{name:"Projector",description:"<under construction>"}),a.prototype.addEventListener=function(a,b){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},a.prototype._emit=emit,a.prototype._transform=function(a,b){return b.clone().applyMatrix4(a.matrix)},a.prototype._getVerts=function(a){var b=Array.prototype.join.call(a.matrix.elements,",");if(b!==this.transformCache[a.uuid]){var c=[];this.vertCache[a.uuid]=c;for(var d=a.geometry.vertices,e=0;e<d.length;++e)c[e]=this._transform(a,d[e]);this.transformCache[a.uuid]=b}return this.vertCache[a.uuid]},a.prototype.setObject=function(a){this.objects[a.uuid]?(this.setProperty(a.uuid,"geometry.faces",a.geometry.faces),this.setProperty(a.uuid,"geometry.uvs",a.geometry.uvs)):(this.objectIDs.push(a.uuid),this.objects[a.uuid]=a),this.setProperty(a.uuid,"geometry.vertices",a.geometry.vertices),this.updateObjects([a])},a.prototype.updateObjects=function(a){for(var b=0;b<a.length;++b){for(var c=a[b],d=c,e=new THREE.Matrix4,f=(new THREE.Matrix4).identity(),g=null;null!==d;)e.fromArray(d.matrix),e.multiply(f),g=e,e=f,f=g,d=d.parent;this.setProperty(c.uuid,"matrix",f),this.setProperty(c.uuid,"visible",c.visible),delete c.parent}},a.prototype.setProperty=function(a,b,c){for(var d=this.objects[a],e=b.split(".");e.length>1;)b=e.shift(),d[b]||(d[b]={}),d=d[b];1===e.length&&(b=e[0],"vertices"===b&&(c=c.map(function(a){return(new THREE.Vector3).fromArray(a)})),d[e[0]]=c)},a.prototype.projectPointer=function(a){var b=a[0],c=a[1],d=null;this.p.fromArray(b),this.f.fromArray(c);for(var e=0;e<this.objectIDs.length;++e){var f=this.objectIDs[e],g=this.objects[f];if(g.visible)for(var h=this._getVerts(g),i=g.geometry.faces,j=g.geometry.uvs,k=0;k<i.length;++k){var l=i[k],m=h[l[0]],n=h[l[1]],o=h[l[2]];if(this.a.subVectors(n,m),this.b.subVectors(o,m),this.c.subVectors(this.p,this.f),this.m.set(this.a.x,this.b.x,-this.c.x,0,this.a.y,this.b.y,-this.c.y,0,this.a.z,this.b.z,-this.c.z,0,0,0,0,1),0!==this.m.determinant()&&(this.m.getInverse(this.m),this.d.subVectors(this.f,m).applyMatrix4(this.m),this.d.x>=0&&this.d.x<=1&&this.d.y>=0&&this.d.y<=1&&this.d.z>0)){this.c.multiplyScalar(this.d.z).add(this.f);var p=Math.sign(this.d.z)*this.p.distanceTo(this.c);(!d||p<d.distance)&&(d={objectID:f,distance:p,faceIndex:k,facePoint:this.c.toArray(),faceNormal:this.d.toArray()},j&&(m=j[l[0]],n=j[l[1]],o=j[l[2]],d.point=[this.d.x*(n[0]-m[0])+this.d.y*(o[0]-m[0])+m[0],this.d.x*(n[1]-m[1])+this.d.y*(o[1]-m[1])+m[1]]))}}}this._emit("hit",d)},a}(),pliny.issue("Primrose.Projector",{name:"document Projector",type:"open",description:"Finish writing the documentation for the [Primrose.Projector](#Primrose_Projector) class in the  directory"}),Primrose.Random=function(){pliny.namespace("Primrose.Random","Functions for handling random numbers of different criteria, or selecting random elements of arrays.");var a={};return pliny["function"]("Primrose.Random",{name:"number",description:"Returns a random floating-point number on a given range [min, max), i.e. min is inclusive, max is exclusive.",parameters:[{name:"min",type:"Number",description:"The included minimum side of the range of numbers."},{name:"max",type:"Number",description:"The excluded maximum side of the range of numbers."}],returns:"A random number as good as your JavaScript engine supports with Math.random(), which is not good enough for crypto, but is certainly good enough for games.",examples:[{name:"Generate a random number on the range [-1, 1).",description:'To generate a random number on a closed range, call the `Primrose.Random.number` function as shown:\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    for(var i = 0; i < 10; ++i){\n\r\n      console.log(Primrose.Random.number(-1, 1));\n\r\n    }\n\r\n\n\r\n## Result (note that this is just one possible outcome):\n\r\n> -0.4869012129493058  \n\r\n> 0.5300767715089023  \n\r\n> 0.11962601682171226  \n\r\n> -0.22012147679924965  \n\r\n> 0.48508461797609925  \n\r\n> -0.8488651723600924  \n\r\n> 0.15711558377370238  \n\r\n> -0.3644236018881202  \n\r\n> 0.4486056035384536  \n\r\n> -0.9659552359953523'}]}),a.number=function(a,b){return Math.random()*(b-a)+a},pliny["function"]("Primrose.Random",{name:"int",description:"Returns a random integer number on a given range [min, max), i.e. min is inclusive, max is exclusive. Includes a means to skew the results in one direction or another.",parameters:[{name:"min",type:"Number",description:"The included minimum side of the range of numbers."},{name:"max",type:"Number",description:"The excluded maximum side of the range of numbers."},{name:"power",type:"Number",description:"(Optional) The power to which to raise the random number before scaling and translating into the desired range. Values greater than 1 skew output values to the minimum of the range. Values less than 1 skew output values to the maximum of the range. Defaults to 1."}],returns:"A random integer as good as your JavaScript engine supports with Math.random(), which is not good enough for crypto, but is certainly good enough for games.",examples:[{name:"Generate a random integer numbers on the range [-10, 10).",description:'To generate a random integer on a closed range, call the `Primrose.Random.integer` function as shown:\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    for(var i = 0; i < 10; ++i){\n\r\n      console.log(Primrose.Random.int(-10, 10));\n\r\n    }\n\r\n\n\r\n## Result (note that this is just one possible outcome):\n\r\n> -3  \n\r\n> 1  \n\r\n> -2  \n\r\n> 8  \n\r\n> 7  \n\r\n> 4  \n\r\n> 5  \n\r\n> -9  \n\r\n> 4  \n\r\n> 0'},{name:"Generate skewed random integer numbers on the range [-100, 100).",description:'To generate a random integer skewed to one end of the range on a closed range, call the `Primrose.Random.integer` function with the `power` parameter as shown:\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    for(var i = 0; i < 10; ++i){\n\r\n      console.log(Primrose.Random.int(-100, 100, 5));\n\r\n    }\n\r\n\n\r\n## Result (note that this is just one possible outcome):\n\r\n> -100  \n\r\n> -100  \n\r\n> -78  \n\r\n> -81  \n\r\n> -99  \n\r\n> 18  \n\r\n> -100  \n\r\n> -100  \n\r\n> -100  \n\r\n> 52'}]}),a["int"]=function(a,b,c){c=c||1,void 0===b&&(b=a,a=0);var d=b-a,e=Math.pow(Math.random(),c);return Math.floor(a+e*d)},pliny["function"]("Primrose.Random",{name:"item",description:"Returns a random element from an array.",parameters:[{name:"arr",type:"Array",description:"The array form which to pick items."}],returns:"One of the elements of the array, at random.",examples:[{name:"Select a random element from an array.",description:'To pick an item from an array at random, call the `Primrose.Random.item` function with the `power` parameter as shown:\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var numbers = [\n\r\n      "one",\n\r\n      "two",\n\r\n      "three",\n\r\n      "four",\n\r\n      "five"\n\r\n    ];\n\r\n    for(var i = 0; i < 10; ++i){\n\r\n      console.log(Primrose.Random.item(numbers));\n\r\n    }\n\r\n\n\r\n## Result (note that this is just one possible outcome):\n\r\n> three  \n\r\n> four  \n\r\n> four  \n\r\n> two  \n\r\n> three  \n\r\n> two  \n\r\n> five  \n\r\n> four  \n\r\n> three  \n\r\n> two'}]}),a.item=function(a){return a[Primrose.Random["int"](a.length)]},pliny["function"]("Primrose.Random",{name:"steps",description:"Returns a random integer number on a given range [min, max), i.e. min is inclusive, max is exclusive, sticking to a number of steps in between. Useful for randomly generating music note values on pentatonic scales.",parameters:[{name:"min",type:"Number",description:"The included minimum side of the range of numbers."},{name:"max",type:"Number",description:"The excluded maximum side of the range of numbers."},{name:"steps",type:"Number",description:"The number of steps between individual integers, e.g. if min is even and step is even, then no odd numbers will be generated."}],returns:"A random integer as good as your JavaScript engine supports with Math.random(), which is not good enough for crypto, but is certainly good enough for games.",examples:[{name:"Generate random, even numbers.",description:'To generate numbers on a closed range with a constant step size between them, call the `Primrose.Random.step` function as shown:\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    for(var i = 0; i < 10; ++i){\n\r\n      console.log(Primrose.Random.steps(0, 100, 2));\n\r\n    }\n\r\n\n\r\n## Result (note that this is just one possible outcome):\n\r\n> 86  \n\r\n> 32  \n\r\n> 86  \n\r\n> 56  \n\r\n> 4  \n\r\n> 96  \n\r\n> 68  \n\r\n> 92  \n\r\n> 4  \n\r\n> 36'}]}),a.steps=function(a,b,c){return a+Primrose.Random["int"](0,(1+b-a)/c)*c},a}(),pliny.issue("Primrose.Random",{name:"document Random",type:"closed",description:"Finish writing the documentation for the [Primrose.Random](#Primrose_Random) class in the  directory"}),Primrose.StateList=function(){function a(a,b,c,d,e){for(var f=Primrose.DOM.cascadeElement(a,"select",HTMLSelectElement),g=0;g<c.length;++g){var h=document.createElement("option");h.appendChild(document.createTextNode(c[g].name)),f.appendChild(h)}f.addEventListener("change",function(){var a=c[f.selectedIndex].values;if(void 0!==a){for(var e in a)if(a.hasOwnProperty(e)){var g=a[e];for(var h in g)g.hasOwnProperty(h)&&(b[e][h]=g[h])}d&&d()}}.bind(this),!1),pliny.property({name:"DOMElement",type:"HTMLSelectElement",description:"The DOM element that should be put on the page to control the settings."}),this.DOMElement=f,e&&e.appendChild(this.DOMElement)}return pliny["class"]("Primrose",{name:"StateList",description:'The StateList is a set of objects that can be mapped to DOM elements in such a way to alter their state. The UI presents a drop down list and the select action changes the various controls as the state set dictates. It\'s a way of streamlining the altering of UI state by select list.\n\r\n\n\r\nThe states paramareter should be an array of State objects that take the form of:\n\r\n    { \n\r\n      name: "A string for display", \n\r\n      values: {\n\r\n        ctrlName1: {attributeName1: value1, attributeName2: value2 },\n\r\n        ctrlName2: {attributeName3: value3, attributeName4: value4 }\n\r\n      }\n\r\n    }'}),a}(),pliny.issue("Primrose.StateList",{name:"document StateList",type:"open",description:"Finish writing the documentation for the [Primrose.StateList](#Primrose_StateList) class in the  directory"}),Primrose.VRApplication=function(){"use strict";function a(o,p){this.options=combineDefaults(p,a.DEFAULTS);var q=function(){var a,b,c;if(this.inVR){var d=this.input.transforms,e=d[0],f=d[1];a=Math.floor((e.viewport.width+f.viewport.width)*n),b=Math.floor(Math.max(e.viewport.height,f.viewport.height)*n),c=a/2,this.camera.aspect=c/b}else{var g=this.renderer.domElement.getBoundingClientRect(),h=screen.width/screen.height,i=g.width,j=isiOS?i*h:i/h,k=devicePixelRatio||1;a=Math.floor(i*k*n),b=Math.floor(j*k*n),c=a,isMobile&&(document.body.style.height=Math.max(document.body.clientHeight,j)+"px",document.documentElement.style.height=Math.max(document.documentElement.clientHeight,j)+"px"),this.renderer.setViewport(0,0,a,b),this.renderer.setScissor(0,0,a,b),this.camera.fov=this.options.defaultFOV,this.camera.aspect=c/b,this.camera.updateProjectionMatrix()}this.renderer.domElement.width=a,this.renderer.domElement.height=b}.bind(this),r=emit.bind(this);this.addEventListener=function(a,b,c){this.listeners[a]?this.listeners[a].push(b):m.indexOf(a)>=0&&window.addEventListener(a,b,c)};var s=function(){return this.currentControl&&this.currentControl.readOnly===!1}.bind(this);this.zero=function(){s()||(this.player.position.set(0,this.avatarHeight,0),this.player.velocity.set(0,0,0),this.input.zero())},this.jump=function(){this.player.isOnGround&&!s()&&(this.player.velocity.y+=this.options.jumpSpeed,this.player.isOnGround=!1)};var t=function(a,b,c,d,e){var f=isMobile?.25:.5;e.size=e.size||new Primrose.Text.Size(1024*c,1024*d),e.fontSize=e.fontSize||32,void 0===e.opacity&&(e.opacity=1);var g=new Primrose.Text.Controls.TextBox(b,e),h=Math.round(1024*f*c/e.fontSize),i=Math.round(1024*f*d/e.fontSize),j=e.useShell?shell.bind(null,1,h,i):quad.bind(null,c,d,1,1),k=textured(j(),g,!1,e.opacity);return a.add(k),g.mesh=k,k.textarea=g,this.registerPickableObject(k),g}.bind(this),u=function(){return t(this.scene,"textEditor"+this.pickableObjects.length,1,1,{tokenizer:Primrose.Text.Grammars.JavaScript,useShell:!0,keyEventSource:window,wheelEventSource:this.renderer.domElement})}.bind(this),v=function(){return t(this.scene,"textEditor"+this.pickableObjects.length,1,1,{tokenizer:Primrose.Text.Grammars.PlainText,useShell:!1,keyEventSource:window,wheelEventSource:this.renderer.domElement,hideLineNumbers:!0,readOnly:!0})}.bind(this),w=function(){var a=this.buttonFactory.create(!1);return this.scene.add(a.container),this.registerPickableObject(a.cap),a}.bind(this),x={textarea:u,pre:v,button:w};this.appendChild=function(a){var b=a.tagName.toLocaleLowerCase(),c=null;return x[b]&&(c=x[b](),c.copyElement(a)),c},this.convertToEditor=function(a){var b=new Primrose.Text.Controls.TextBox("textEditor",{size:new Primrose.Text.Size(1024,1024),fontSize:32,tokenizer:Primrose.Text.Grammars.Basic,theme:Primrose.Text.Themes.Dark,keyEventSource:window,wheelEventSource:this.renderer.domElement,hideLineNumbers:!0});return textured(a,b),b.mesh=a,a.textarea=b,this.registerPickableObject(a),b},this.registerPickableObject=function(a){if("Object3D"===a.type&&(a.children[0].name=a.children[0].name||a.name,a=a.children[0]),a){var c,d,e,f,g=b(a);if(a.geometry instanceof THREE.BufferGeometry){var h=a.geometry.attributes,i=h.position,j=h.uv,k=h.index;for(c=[],d=[],j&&(e=[]),f=0;f<i.count;++f)c.push([i.getX(f),i.getY(f),i.getZ(f)]),j&&e.push([j.getX(f),j.getY(f)]);if(k)for(f=0;f<k.count-2;++f)d.push([k.getX(f),k.getX(f+1),k.getX(f+2)]);else for(f=0;f<i.count;f+=3)d.push([f,f+1,f+2])}else for(c=a.geometry.vertices.map(function(a){return a.toArray()}),d=[],e=[],f=0;f<a.geometry.faces.length;++f){var l=a.geometry.faces[f],m=a.geometry.faceVertexUvs[0][f];d.push([l.a,l.b,l.c]),e[l.a]=[m[0].x,m[0].y],e[l.b]=[m[1].x,m[1].y],e[l.c]=[m[2].x,m[2].y]}g.geometry={vertices:c,faces:d,uvs:e},this.pickableObjects.push(a),this.projector.setObject(g)}},this.findObject=function(a){for(var b=0;b<this.pickableObjects.length;++b)if(this.pickableObjects[b].uuid===a)return this.pickableObjects[b]};var y=function(a){O(y),a*=.001;var d,e,f=a-z,g=0,m=0,o=0,p=0;if(z=a,this.input.update(f),g=this.input.getValue("heading"),o=this.input.getValue("strafe"),p=this.input.getValue("drive"),m=this.input.getValue("pitch"),this.input.getQuaternion("headRX","headRY","headRZ","headRW",F),D.setFromAxisAngle(h,m),this.nose.visible=this.inVR,this.player.isOnGround?s()||(this.player.velocity.set(o,0,p).normalize().multiplyScalar(this.walkSpeed),E.setFromAxisAngle(i,C),this.player.velocity.applyQuaternion(F),this.player.velocity.y=0,this.player.velocity.applyQuaternion(E)):this.player.velocity.y-=this.options.gravity*f,this.player.position.add(G.copy(this.player.velocity).multiplyScalar(f)),!this.player.isOnGround&&this.player.position.y<this.avatarHeight&&(this.player.isOnGround=!0,this.player.position.y=this.avatarHeight,this.player.velocity.y=0),this.sky&&this.sky.position.copy(this.player.position),this.ground&&(this.ground.position.set(Math.floor(this.player.position.x),0,Math.floor(this.player.position.z)),this.ground.material.needsUpdate=!0),this.inVR){var q=g-C;if(!s()&&Math.abs(q)>Math.PI/5){var t=Math.sign(q)*Math.PI/100;C+=t,g-=t,q=g-C}this.player.quaternion.setFromAxisAngle(i,C),E.setFromAxisAngle(i,q).multiply(D)}else C=g,this.player.quaternion.setFromAxisAngle(i,C),this.player.quaternion.multiply(D);this.pointer.position.copy(j),this.inVR&&!isMobile&&this.pointer.position.applyQuaternion(E),(!s()||isMobile)&&(this.pointer.position.add(this.camera.position),this.pointer.position.applyQuaternion(this.camera.quaternion)),this.pointer.position.applyQuaternion(this.player.quaternion),this.pointer.position.add(this.player.position),this.projector.ready&&(this.projector.ready=!1,this.projector.updateObjects(this.pickableObjects.map(b)),this.projector.projectPointer([this.pointer.position.toArray(),c(this.player)]));var u=this.input.getValue("dButtons");if(B){var v=B.facePoint,w=B.faceNormal,x=this.findObject(B.objectID);if(this.pointer.position.set(v[0]+w[0]*k,v[1]+w[1]*k,v[2]+w[2]*k),x===this.ground?this.pointer.scale.set(l,l,l):this.pointer.scale.set(1,1,1),this.pointer.material.color.setRGB(1,1,1),this.pointer.material.emissive.setRGB(.25,.25,.25),x){var H=this.input.getValue("buttons"),I=0!==u,J=x.textarea||x.button;s()||(H|=this.input.keyboard.getValue("select"),I=I||0!==this.input.keyboard.getValue("dSelect")),A&&B&&A.objectID===B.objectID&&!I&&H>0?r("pointermove",B):(A&&I&&0===H&&r("pointerend",A),B&&I&&H>0&&r("pointerstart",B)),I&&H>0&&(this.currentControl&&this.currentControl!==J&&(this.currentControl.blur(),this.currentControl=null),!this.currentControl&&J?(this.currentControl=J,this.currentControl.focus()):x===this.ground&&(this.player.position.copy(this.pointer.position),this.player.position.y=this.avatarHeight,this.player.isOnGround=!1)),this.currentControl&&(I?H>0?this.currentControl.startUV(B.point):this.currentControl.endPointer():!I&&H>0&&this.currentControl.moveUV(B.point))}}else this.currentControl&&u>0&&(this.currentControl.blur(),this.currentControl=null),this.pointer.material.color.setRGB(1,0,0),this.pointer.material.emissive.setRGB(.25,0,0),this.pointer.scale.set(1,1,1);for(r("update",f),e=0;e<this.pickableObjects.length;++e){var K=this.pickableObjects[e],L=K.textarea;L&&L.render()}if(this.inVR)for(d=0;d<this.input.transforms.length;++d){var M=this.input.transforms[d],N=M.viewport,P=2*d-1;this.input.getVector3("headX","headY","headZ",this.camera.position),this.camera.projectionMatrix.copy(M.projection),this.camera.position.applyMatrix4(M.translation),this.camera.quaternion.copy(F),this.nose.position.set(P*-.12,-.12,-.15),this.nose.rotation.z=.7*P,this.renderer.setViewport(N.left*n,N.top*n,N.width*n,N.height*n),this.renderer.setScissor(N.left*n,N.top*n,N.width*n,N.height*n),this.renderer.render(this.scene,this.camera),this.input.vr.submitFrame()}else this.camera.position.set(0,0,0),this.camera.quaternion.copy(F),this.renderer.render(this.scene,this.camera)}.bind(this);this.ctrls=Primrose.DOM.findEverything(),this.formStateKey=o+" - formState",this.formState=getSetting(this.formStateKey),this.fullscreenElement=document.documentElement,this.users={},this.chatLines=[],this.userName=a.DEFAULT_USER_NAME,this.focused=!0,this.wasFocused=!1,writeForm(this.ctrls,this.formState),window.addEventListener("beforeunload",function(){this.stop(),this.inVR&&this.input.vr.currentDisplay.exitPresent();var a=readForm(this.ctrls);setSetting(this.formStateKey,a)}.bind(this),!1),this.setupModuleEvents=function(a,b,c){var e=c+"Enable",f=c+"Transmit",g=c+"Receive",h=document.createElement("input"),i=document.createElement("input"),j=document.createElement("input"),k=document.createElement("tr");if(this.ctrls[e]=h,this.ctrls[f]=i,this.ctrls[g]=j,h.id=e,i.id=f,j.id=g,h.type=i.type=j.type="checkbox",h.checked=this.formState[e],i.checked=this.formState[f],j.checked=this.formState[g],h.addEventListener("change",function(a,b){b.enable(this.checked),a.disabled=!this.checked,a.checked&&a.disabled&&(a.checked=!1)}.bind(h,i,b)),i.addEventListener("change",function(a){a.transmit(this.checked)}.bind(i,b)),j.addEventListener("change",function(a){a.receive(this.checked)}.bind(j,b)),a.appendChild(k),d(k,c),d(k,h),d(k,i),d(k,j),b.zeroAxes){var l=c+"Zero",m=document.createElement("input");this.ctrls[l]=m,m.id=l,m.type="checkbox",m.checked=this.formState[l],m.addEventListener("click",b.zeroAxes.bind(b),!1),d(k,m)}else j.colspan=2;b.enable(h.checked),b.transmit(i.checked),b.receive(j.checked),i.disabled=!h.checked,i.checked&&i.disabled&&(i.checked=!1)};var z=0,A=null,B=null,C=0,D=new THREE.Quaternion,E=new THREE.Quaternion,F=new THREE.Quaternion,G=new THREE.Vector3,H=Primrose.Random.item(Primrose.SKIN_VALUES),I=!this.options.sceneModel,J=!this.options.button,K=!1;if(this.currentControl=null,this.avatarHeight=this.options.avatarHeight,this.walkSpeed=this.options.walkSpeed,this.listeners={ready:[],update:[],gazestart:[],gazecomplete:[],gazecancel:[],pointerstart:[],pointermove:[],pointerend:[]},this.audio=new Primrose.Output.Audio3D,this.music=new Primrose.Output.Music(this.audio.context),this.pickableObjects=[],this.projector=new Primrose.Workerize(Primrose.Projector),this.projector.ready=!0,this.player=new THREE.Object3D,this.player.velocity=new THREE.Vector3,this.player.position.set(0,this.avatarHeight,0),this.player.isOnGround=!0,this.pointer=textured(sphere(k,10,10),16711680),this.pointer.material.emissive.setRGB(.25,0,0),this.pointer.material.opacity=.75,this.nose=textured(sphere(.05,10,10),H),this.nose.name="Nose",this.nose.scale.set(.5,1,1),this.renderer=new THREE.WebGLRenderer({canvas:Primrose.DOM.cascadeElement(this.options.canvasElement,"canvas",HTMLCanvasElement),antialias:!isMobile,alpha:!isMobile,logarithmicDepthBuffer:!isMobile,DEBUG_WEBGL:this.options.DEBUG_WEBGL}),this.renderer.autoSortObjects=!isMobile,this.renderer.enableScissorTest(!0),this.renderer.setClearColor(this.options.backgroundColor),this.renderer.domElement.parentElement||document.body.appendChild(this.renderer.domElement),this.input=new Primrose.Input.FPSInput(this.renderer.domElement,this.options.nearPlane,this.options.drawDistance),this.scene=new THREE.Scene,this.options.useFog&&(this.scene.fog=new THREE.FogExp2(this.options.backgroundColor,2/this.options.drawDistance)),this.camera=new THREE.PerspectiveCamera(75,1,this.options.nearPlane,this.options.drawDistance),this.options.skyTexture&&(this.sky=textured(shell(this.options.drawDistance,18,9,2*Math.PI,Math.PI),this.options.skyTexture,!0),this.sky.name="Sky",this.scene.add(this.sky)),this.options.groundTexture){var L=2*this.options.drawDistance,M=new THREE.PlaneGeometry(L,L,L,L);this.ground=textured(M,this.options.groundTexture,!1,1,L,L),this.ground.rotation.x=Math.PI/2,this.ground.name="Ground",this.scene.add(this.ground),this.registerPickableObject(this.ground)}this.camera.add(this.nose),this.camera.add(light(16777215,1,2,.5)),this.player.add(this.camera),this.scene.add(this.player),this.scene.add(this.pointer),this.passthrough&&this.camera.add(this.passthrough.mesh),this.options.sceneModel&&Primrose.ModelLoader.loadScene(this.options.sceneModel,function(a){I=!0,this.scene.add.apply(this.scene,a.children),this.scene.traverse(function(a){a.name&&(this.scene[a.name]=a)}.bind(this)),a.Camera&&(this.camera.position.copy(a.Camera.position),this.camera.quaternion.copy(a.Camera.quaternion))}.bind(this)),this.options.button?this.buttonFactory=new Primrose.ButtonFactory(this.options.button.model,this.options.button.options,function(){J=!0}):this.buttonFactory=new Primrose.ButtonFactory(brick(16711680,1,1,1),{maxThrow:.1,minDeflection:10,colorUnpressed:8323072,colorPressed:32512,toggle:!0});var N=function(a){if(z=.001*a,I&&J){if(!K){K=!0,q();try{r("ready")}catch(b){console.error(b),console.warn("There was an error during setup, but we're going to continue anyway.")}}O(y)}else O(N)}.bind(this),O=function(a){this.inVR?this.timer=this.input.vr.currentDisplay.requestAnimationFrame(a):this.timer=requestAnimationFrame(a)}.bind(this);this.start=function(){this.timer||O(N)}.bind(this),this.stop=function(){this.inVR?this.input.vr.currentDisplay.cancelAnimationFrame(this.timer):cancelAnimationFrame(this.timer),this.timer=null}.bind(this);var P=function(a){var b;this.projector.ready=!0,A=B,B=a,A&&B&&A.objectID===B.objectID?(B.startTime=A.startTime,B.gazeFired=A.gazeFired,b=z-B.startTime,b>=this.options.gazeLength&&!B.gazeFired&&(B.gazeFired=!0,r("gazecomplete",B))):(A&&(b=z-A.startTime,b<this.options.gazeLength&&r("gazecancel",A)),B&&(B.startTime=z,B.gazeFired=!1,r("gazestart",B)))}.bind(this),Q=function(a){a.shiftKey||a.ctrlKey||a.altKey||a.metaKey||(this.inVR&&a.keyCode===Primrose.Keys.ESCAPE&&(this.stop(),this.input.vr.currentDisplay.exitPresent().then(R)["catch"](R)),s()||a.keyCode!==Primrose.Keys.F?219===a.keyCode&&n>.2?(n-=.1,q()):221===a.keyCode&&3>n&&(n+=.1,q()):this.goFullScreen(!0))}.bind(this),R=function(){q(),this.start()}.bind(this);this.goFullScreen=function(a){this.input.mouse.requestPointerLock(),e()||(a&&this.input.vr&&this.input.vr.currentDisplay?(console.log("requesting presentation mode"),this.stop(),this.input.vr.currentDisplay.requestPresent({source:this.renderer.domElement}).then(R)["catch"](R)):isiOS?q():f(this.renderer.domElement),history.pushState(null,document.title,"#fullscreen"))};var S=null;if(this.setFullScreenButton=function(a,b,c){var d=document.getElementById(a);if(d){var e=!c||isVR||isMobile;d.style.cursor=e?"pointer":"not-allowed",d.title=e?c?"Go Split-Screen":"Go Fullscreen":"VR is not available in your current browser.",d.addEventListener(b,this.goFullScreen.bind(this,c),!1),S||(S=d.parentElement)}},window.addEventListener("popstate",function(a){e()&&(this.inVR?(this.stop(),this.input.vr.exitPresent().then(R)["catch"](R)):g(),a.preventDefault())},!0),window.addEventListener("resize",q,!1),this.options.disableAutoFullScreen||(window.addEventListener("mousedown",this.goFullScreen.bind(this,!0),!1),window.addEventListener("touchstart",this.goFullScreen.bind(this,!0),!1)),window.addEventListener("keydown",Q,!1),this.input.addEventListener("jump",this.jump.bind(this),!1),this.input.addEventListener("zero",this.zero.bind(this),!1),this.projector.addEventListener("hit",P,!1),window.addEventListener("blur",this.stop,!1),window.addEventListener("focus",this.start,!1),this.renderer.domElement.addEventListener("webglcontextlost",this.stop,!1),this.renderer.domElement.addEventListener("webglcontextrestored",this.start,!1),Object.defineProperty(this,"inVR",{get:function(){return this.input.vr&&this.input.vr.currentDisplay&&this.input.vr.currentDisplay.isPresenting}}),window.alert.toString().indexOf("native code")>-1){var T=function(a,b){return b||(b=function(){}),function(){e()?b():a.apply(window,arguments)}.bind(this)}.bind(this);window.alert=T(window.alert),window.confirm=T(window.confirm),window.prompt=T(window.prompt)}this.start()}function b(a){for(var b={uuid:a.uuid,visible:a.visible,name:a.name},c=b,d=a;null!==d;)d.updateMatrix(),b.matrix=d.matrix.elements.subarray(0,d.matrix.elements.length),b.parent=d.parent?{}:null,b=b.parent,d=d.parent;return c}function c(a){var b=a.position.clone();for(a=a.parent;null!==a;)b.applyMatrix4(a.matrix),a=a.parent;return b.toArray()}function d(a,b){"string"==typeof b&&(b=document.createTextNode(b));var c=document.createElement("td");c.appendChild(b),a.appendChild(c)}function e(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function f(a,b){var c;"undefined"!=typeof HMDVRDevice&&b&&b instanceof HMDVRDevice&&(c={vrDisplay:b,vrDistortion:!0}),a.webkitRequestFullscreen?a.webkitRequestFullscreen(c||window.Element.ALLOW_KEYBOARD_INPUT):a.mozRequestFullScreen&&c?a.mozRequestFullScreen(c):a.mozRequestFullScreen&&!c?a.mozRequestFullScreen():a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function g(){e()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())}if("undefined"==typeof THREE)return function(){};var h=new THREE.Vector3(1,0,0),i=new THREE.Vector3(0,1,0),j=new THREE.Vector3(0,0,-1),k=.01,l=20,m=["keydown","keyup","keypress","mousedown","mouseup","mousemove","wheel","touchstart","touchend","touchmove"],n=1;return pliny["class"]("Primrose",{name:"VRApplication",description:"Make a Virtual Reality app in your web browser!"}),a.DEFAULT_USER_NAME="CURRENT_USER_OFFLINE",a.DEFAULTS={useLeap:!1,useFog:!1,avatarHeight:1.75,walkSpeed:2,gravity:9.8,jumpSpeed:3.13,disableAutoFullScreen:!1,backgroundColor:11517951,nearPlane:.1,drawDistance:100,defaultFOV:75,chatTextSize:.25,dtNetworkUpdate:.125,canvasElement:"frontBuffer",gazeLength:1},a}(),pliny.issue("Primrose.VRApplication",{name:"document VRApplication",type:"open",description:"Finish writing the documentation for the [Primrose.VRApplication](#Primrose_VRApplication) class in the  directory"}),pliny.issue("Primrose.VRApplication",{name:"scene FOV issues",type:"open",description:'Image appears "zoomed in" when in VR mode. See \n\r\n[VR mode seems "zoomed in" with DK2  Issue #72  capnmidnight/Primrose](https://github.com/capnmidnight/Primrose/issues/72) \n\r\nfor more information.'}),pliny.issue("Primrose.VRApplication",{name:"default light",type:"open",description:"When the user does not define a scene model file and opts to use the\n\r\ndefault scene, make sure a point light is added to the scene so the ground is visible."}),Primrose.WebRTCSocket=function(){function a(a,b){function c(a,b,c){c.fromIndex=a,c.toIndex=b,g[b].setLocalDescription(c,function(){f.emit(c.type,c)})}function d(a,b,c){if(b.fromIndex===a){var d=new RTCSessionDescription(b);g[a].setRemoteDescription(d,c)}}function e(a){function b(){h[a]=null,g[a]=null;var b=0===h.filter(function(a){return a}).length;if(b&&i.close)for(var c=0;c<i.close.length;++c){var d=i.close[c];d&&d.call(this)}}h[a].addEventListener("open",function(){if(i.open)for(var a=0;a<i.open.length;++a){var b=i.open[a];b&&b.call(this)}},!1),h[a].addEventListener("message",function(a){var b=JSON.parse(a.data),c=b.shift();if(i[c])for(var d=0;d<i[c].length;++d){
var e=i[c][d];e&&e.apply(this,b)}},!1),h[a].addEventListener("error",b,!1),h[a].addEventListener("close",b,!1)}var f,g=[],h=[],i={},j=null;if("string"==typeof a)f=io.connect(a,{reconnect:!0,"reconnection delay":1e3,"max reconnection attempts":60});else{if(!(a&&a.on&&a.emit))throw console.error("proxy error",f),new Error("need a socket");f=a}this.on=function(a,b){i[a]||(i[a]=[]),i[a].push(b)},this.emit=function(a){for(var b=JSON.stringify(a),c=0;c<h.length;++c){var d=h[c];d&&"open"===d.readyState&&d.send(b)}},this.close=function(){h.forEach(function(a){a&&"open"===a.readyState&&a.close()}),g.forEach(function(a){a&&a.close()})},window.addEventListener("unload",this.close.bind(this)),this.connect=function(a){f.emit("handshake","peer"),f.on("handshakeComplete",function(b){"peer"===b&&f.emit("joinRequest",a)})},f.on("user",function(a,i){try{if(null===j&&(j=a),!g[i]){var k=new RTCPeerConnection({iceServers:["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302"].map(function(a){return{url:"stun:"+a}})});if(g[i]=k,k.addEventListener("icecandidate",function(a){a.candidate&&(a.candidate.fromIndex=j,a.candidate.toIndex=i,f.emit("ice",a.candidate))},!1),f.on("ice",function(a){a.fromIndex===i&&g[i].addIceCandidate(new RTCIceCandidate(a))}),b===!0||void 0===b&&i>j){k.addEventListener("negotiationneeded",function(a){k.createOffer(c.bind(this,j,i),console.error.bind(console,"createOffer error"))});var l=k.createDataChannel("data-channel-"+j+"-to-"+i,{id:j,ordered:!1,maxRetransmits:0});h[i]=l,e(i),f.on("answer",function(a){a.fromIndex===i&&d(i,a)})}else(b===!1||void 0===b&&j>i)&&(k.addEventListener("datachannel",function(a){a.channel.id===i&&(h[a.channel.id]=a.channel,e(i))},!1),f.on("offer",function(a){a.fromIndex===i&&d(i,a,function(){g[i].createAnswer(c,console.error.bind(console,"createAnswer error"))})}))}}catch(m){console.error(m)}})}return Window.prototype.RTCPeerConnection=Window.prototype.RTCPeerConnection||Window.prototype.webkitRTCPeerConnection||Window.prototype.mozRTCPeerConnection||function(){},Window.prototype.RTCIceCandidate=Window.prototype.RTCIceCandidate||Window.prototype.mozRTCIceCandidate||function(){},Window.prototype.RTCSessionDescription=Window.prototype.RTCSessionDescription||Window.prototype.mozRTCSessionDescription||function(){},pliny["class"]("Primrose",{name:"WebRTCSocket",description:"<under construction>"}),a}(),pliny.issue("Primrose.WebRTCSocket",{name:"document WebRTCSocket",type:"open",description:"Finish writing the documentation for the [Primrose.WebRTCSocket](#Primrose_WebRTCSocket) class in the  directory"}),Primrose.Workerize=function(){function a(b){var c,d=b.toString(),e=d.match(/function\s+(\w+)\s*\(/),f=e[1];for(c in b.prototype)d+="\n\n"+f+".prototype."+c+" = "+b.prototype[c].toString()+";";d+="\n\n(function(){\n  var instance = new "+f+"(true);",d+="\n  if(instance.addEventListener){\n    self.args = [null, null];\n    for(var k in instance.listeners) {\n      instance.addEventListener(k, function(eventName, args){\n        self.args[0] = eventName;\n        self.args[1] = args;\n        postMessage(self.args);\n      }.bind(this, k));\n    }\n  }",d+="\n\n  onmessage = function(evt){\n    var f = evt.data[0],\n        t = instance[f];\n    if(t){\n      t.call(instance, evt.data[1]);\n    }\n  };\n\n})();",pliny.property({name:"worker",type:"WebWorker",description:"The worker thread containing our class."}),this.worker=a.createWorker(d,!1),pliny.property({name:"args",type:"Array",description:"Static allocation of an array to save on memory usage when piping commands to a worker."}),this.args=[null,null],pliny.property({name:"listeners",type:"Object",description:"A bag of arrays of callbacks for each of the class' events."}),this.listeners={},this.worker.onmessage=function(a){for(var b=a.data[0],c=this.listeners[b],d=0;c&&d<c.length;++c)c[d].call(this,a.data[1])}.bind(this),pliny.property({name:"&lt;mappings for each method in the original class&gt;",type:"Function",description:"Each mapped function causes a message to be posted to the worker thread with its arguments packed into an array."});for(c in b.prototype)"addEventListener"!==c&&"_"!==c[0]&&(this[c]=this.methodShim.bind(this,c))}return pliny["class"]("Primrose",{name:"Workerize",description:"Builds a WebWorker thread out of a JavaScript class's source code, and attempts to create a message interface that matches the message-passing interface that the class already uses.\n\r\n\n\r\nAutomatically workerized classes should have methods that take a single array for any parameters and return no values. All return results should come through an Event that the class emits.",parameters:[{name:"func",type:"Function",description:"The class function to workerize"}],examples:[{name:"Create a basic workerized class.",description:'Classes in JavaScript are created by adding new functions to the `prototype` of another function, then instantiating objects from that class with `new`. When creating such a class for automatic workerization, a few restrictions are required:\n\r\n* All methods in the class must be on the prototype. Any methods created and assigned in the constructor will not be available to the message passing interface.\n\r\n* All interaction with objects of the class must be through these publically accessible methods. This includes initialization.\n\r\n* All methods should take at most a single arguemnt. If you need multiple arguments, pack them into an array.\n\r\n* The methods cannot return any values. If a value must be returned to the calling context, it must be done through an event callback.\n\r\n* The class must assign handlers to events through an addEventListener method that mirrors the standard interface used in DOM. Workerize will not respect the 3rd `bubbles` parameter that is so often ommitted when programming against DOM.\n\r\n\n\r\nAssuming the following class:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    function MyClass(){\n\r\n      this.listeners = {\n\r\n        complete: []\n\r\n      };\n\r\n      this.objects = [];\n\r\n    }\n\r\n\n\r\n    MyClass.prototype.addEventListener = function(evt, handler){\n\r\n      if(this.listeners[evt]){\n\r\n        this.listeners[evt].push(handler);\n\r\n      }\n\r\n    };\n\r\n\n\r\n    MyClass.prototype.addObject = function(obj){\n\r\n      this.objects.push(obj);\n\r\n    };\n\r\n\n\r\n    MyClass.prototype.update = function(dt){\n\r\n      // we can make essentially arbitrarily small timeslice updates\n\r\n      var SLICE = 0.1;\n\r\n      for(var ddt = 0; ddt < dt; ddt += SLICE){\n\r\n        for(var i = 0; i < this.objects.length; ++i){\n\r\n          var o = this.objects[i];\n\r\n          o.x += o.vx * SLICE;\n\r\n          o.y += o.vy * SLICE;\n\r\n          o.z += o.vz * SLICE;\n\r\n        }\n\r\n      }\n\r\n      // prepare our return state for the UI thread.\n\r\n      var returnValue = [];\n\r\n      for(var i = 0; i < this.objects.length; ++i){\n\r\n        returnValue.push([o.x, o.y, o.z]);\n\r\n      }\n\r\n      // and emit the event to all of the listeners.\n\r\n      for(var i = 0; i < this.listeners.complete.length; ++i){\n\r\n        this.listeners.complete[i](returnValue);\n\r\n      }\n\r\n    };\n\r\n\n\r\nThen we can create and use an automatically workerized version of it as follows.\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var phys = new Primrose.Workerize(MyClass);\n\r\n    // we keep a local copy of the state so we can perform other operations on it.\n\r\n    var objects = [];\n\r\n    for(var i = 0; i < 10; ++i){\n\r\n      var obj = {\n\r\n        // random values between -1 and 1\n\r\n        x: 2 * Math.random() - 1,\n\r\n        y: 2 * Math.random() - 1,\n\r\n        z: 2 * Math.random() - 1,\n\r\n        vx: 2 * Math.random() - 1,\n\r\n        vy: 2 * Math.random() - 1,\n\r\n        vz: 2 * Math.random() - 1\n\r\n      };\n\r\n      objects.push(obj);\n\r\n      phys.addObject(obj);\n\r\n    }\n\r\n    \n\r\n    // this flag lets us keep track of whether or not we know that the worker is in the middle of an expensive operation.\n\r\n    phys.ready = true;\n\r\n    phys.addEventListener("complete", function(newPositions){\n\r\n      // We update the state in the UI thread with the expensively-computed values.\n\r\n      for(var i = 0; i < newPositions.length; ++i){\n\r\n        objects[i].x = newPositions[i][0];\n\r\n        objects[i].y = newPositions[i][1];\n\r\n        objects[i].z = newPositions[i][2];\n\r\n      }\n\r\n      phys.ready = true;\n\r\n    });\n\r\n    \n\r\n    var lt = null;\n\r\n    function paint(t){\n\r\n      requestAnimationFrame(paint);\n\r\n      if(lt === undefined || lt === null){\n\r\n        lt = t;\n\r\n      } else {\n\r\n        var dt = t - lt;\n\r\n        if(phys.ready){\n\r\n          phys.ready = false;\n\r\n          phys.update(dt);\n\r\n          lt = t;\n\r\n        }\n\r\n        for(var i = 0; i < objects.length; ++i){\n\r\n          var o = objects[i];\n\r\n          // We can even perform a much cheaper position update to smooth over the blips in the expensive update on the worker thread.\n\r\n          drawObjectAt(o.x + o.vx * dt, o.y + o.vy * dt, o.z + o.vz * dt);\n\r\n        }\n\r\n      }\n\r\n    }\n\r\n    requestAnimationFrame(paint);'}]}),pliny.method("Primrose.Workerize",{name:"methodShim",description:"Posts messages to the worker thread by packing arguments into an array. The worker will receive the array and interpret the first value as the name of the method to invoke and the second value as another array of parameters.",parameters:[{name:"methodName",type:"String",description:"The method inside the worker context that we want to invoke."},{name:"args",type:"Array",description:"The arguments that we want to pass to the method that we are calling in the worker context."}]}),a.prototype.methodShim=function(a,b){this.args[0]=a,this.args[1]=b,this.worker.postMessage(this.args)},pliny.method("Primrose.Workerize",{name:"addEventListener",description:"Adding an event listener just registers a function as being ready to receive events, it doesn't do anything with the worker thread yet.",parameters:[{name:"evt",type:"String",description:"The name of the event for which we are listening."},{name:"thunk",type:"Function",description:"The callback to fire when the event occurs."}]}),a.prototype.addEventListener=function(a,b){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},pliny["function"]("Primrose.Workerize",{name:"createWorker",description:"A static function that loads Plain Ol' JavaScript Functions into a WebWorker.",parameters:[{name:"script",type:"(String|Function)",description:"A String defining a script, or a Function that can be toString()'d to get it's script."},{name:"stripFunc",type:"Boolean",description:"Set to true if you want the function to strip the surround function block scope from the script."}],returns:"The WebWorker object."}),a.createWorker=function(a,b){if("function"==typeof a&&(a=a.toString()),b){a=a.trim();var c=a.indexOf("{");a=a.substring(c+1,a.length-1)}var d=new Blob([a],{type:"text/javascript"}),e=URL.createObjectURL(d);return new Worker(e)},a}(),pliny.issue("Primrose.Workerize",{name:"document Workerize",type:"closed",description:"Finish writing the documentation for the [Primrose.Workerize](#Primrose_Workerize) class in the  directory"}),pliny.issue("",{name:"document helpers/fmt.js",type:"closed",description:"Finish writing the documentation for the [fmt](#fmt) file in the helpers/ directory"}),pliny.issue("",{name:"document sigfig function",type:"closed",description:"Finish writing the documentation for the [sigfig](#sigfig) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"sigfig",description:"Formats a decimal number to a certain length of decimal points.",parameters:[{name:"x",type:"Number",description:"The number to format."},{name:"y",type:"Number",description:"The number of digits after the decimal point to show."}],returns:"String",examples:[{name:"A few examples.",description:'\r\n    grammar("JavaScript");\n\r\n    // Round a number to an integer.\n\r\n    console.assert(sigfig(12.345, 0) === "12");\n\r\n     \n\r\n    // sigfig respects rounding rules.\n\r\n    console.assert(sigfig(123.4567, 2) === "123.46");\n\r\n     \n\r\n    // sigfig will pad extra zeroes.\n\r\n    console.assert(sigfig(123.4, 3) === "123.400");'}]}),pliny.issue("",{name:"document fmt function",type:"closed",description:"Finish writing the documentation for the [fmt](#fmt) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"fmt",parameters:[{name:"template",type:"String",description:"The template string containing dollar-sign delimited value references."},{name:"varargs...",type:"Any",description:"The values to replace into the template. Generally speaking, the `toString()` method of the object will be called. However, dates have special handling. The precision count indicates the fields of the date to print.\n\r\n* $1.0 - prints just the 4-digit year.\n\r\n* $1.00 - prints the 2-digit month/4-digit year.\n\r\n* $1.000 - prints the result of calling `toLocaleDateString()` on the date value.\n\r\n* $1.0000 - prints the result of calling `toLocaleTimeString()` on the date value, plus additional milliseconds value.\n\r\n* $1.00000 - same as...\n\r\n* $1.000000 - prints the result of calling `toLocaleString()` on the date value.\n\r\n* $1.0000000 - prints the result of calling `toLocaleString()` on the date value, plus additional milliseconds value."}],returns:"A formatted string.",description:'Replaces 1-indexed place holders in a string with the subsequent \n\r\nparameters passed to the `fmt()` function, e.g. a \n template `"X: $1, Y: $2"`\n\r\nexpects to parameters following directly after the template.\n\r\n\n\r\nTemplate place holders start with a dollar sign ($) and are followed by a digit\n\r\nthat references the parameter position of the value to use in the text replacement.\n\r\nNote that the first position, position 0, would be the template itself. However, you\n\r\ncannot reference the first position, as zero digit characters are used to indicate\n\r\nthe width to which to pad values.\n\r\n\n\r\nNumerical precision, with zero-padding, is indicated with a period and trailing zeros.',examples:[{name:"Basic examples",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(fmt("a: $1, b: $2", 123, "Sean") === "a: 123, b: Sean");\n\r\n    console.assert(fmt("$001, $002, $003", 1, 23, 456) === "001, 023, 456");\n\r\n    console.assert(fmt("$1.000", Math.PI) === "3.142");\n\r\n    console.assert(fmt("$1.0000", Math.PI) === "3.1416");\n\r\n    console.assert(fmt("$1.00000", Math.PI) === "3.14159");\n\r\n    console.assert(fmt("$1.00 + $2.00 = $3.00", 0.1, 0.2, 0.1 + 0.2) === "0.10 + 0.20 = 0.30");\n\r\n    // Note that the following values were obtained evaluating the code in the US locale. They won\'t literally evaluate true.\n\r\n    console.assert(fmt("The current year is $1.0.", new Date() ) === "The current year is 2016.");\n\r\n    console.assert(fmt("The current month and year is $1.00.", new Date() ) === "The current month and year is 1/2016.");\n\r\n    console.assert(fmt("The current date is $1.000.", new Date() ) === "The current date is 1/25/2016.");\n\r\n    console.assert(fmt("The current time is $1.0000.", new Date() ) === "The current time is 10:05:28.772 PM.");\n\r\n    console.assert(fmt("The current date and time is $1.00000.", new Date() ) === "The current date and time is 1/25/2016, 10:06:06 PM.");\n\r\n    console.assert(fmt("The current date and time is $1.0000000.", new Date() ) === "The current date and time is 1/25/2016, 10:06:55.667 PM.");'}]});var fmt=function(){function a(a,b){return b.replace(/( AM| PM|$)/,function(b,c){return(a.getMilliseconds()/1e3).toString().substring(1)+c})}function b(b){var d=arguments;return"string"!=typeof b&&(b=b.toString()),b.replace(c,function(b,c,e,f){if(e=parseInt(e,10),e>=0&&e<d.length){var g=d[e];if(null!==g&&void 0!==g){if(g instanceof Date&&f){switch(f.length){case 1:g=g.getYear()+1900;break;case 2:g=g.getMonth()+1+"/"+(g.getYear()+1900);break;case 3:g=g.toLocaleDateString();break;case 4:g=a(g,g.toLocaleTimeString());break;case 5:case 6:g=g.toLocaleString();break;default:g=a(g,g.toLocaleString())}return g}if(g=f&&f.length>0?sigfig(g,f.length):g.toString(),c&&c.length>0)for(var h=new RegExp("^\\d{"+(c.length+1)+"}(\\.\\d+)?");!h.test(g);)g="0"+g;return g}}return void 0})}var c=/\$(0*)(\d+)(?:\.(0+))?/g;return b}();pliny.issue("",{name:"document px function",type:"closed",description:"Finish writing the documentation for the [px](#px) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"px",description:'Appends the string "px" to the end of a number. Useful for specifying CSS units.',parameters:[{name:"value",type:"Number",description:"The number to make into a CSS pixel-unit value."}],returns:'The number as a string, plus the text "px", with no intermediate whitespace.',examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(px(100.5) === "100.5px");'}]});var px=fmt.bind(this,"$1px");pliny.issue("",{name:"document pct function",type:"closed",description:"Finish writing the documentation for the [pct](#pct) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"pct",description:'Appends the string "%" to the end of a number. Useful for specifying CSS units.',parameters:[{name:"value",type:"Number",description:"The number to make into a CSS percentage-unit value."}],returns:'The number as a string, plus the text "%", with no intermediate whitespace.',examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(pct(100.5) === "100.5%");'}]});var pct=fmt.bind(this,"$1%");pliny.issue("",{name:"document ems function",type:"closed",description:"Finish writing the documentation for the [ems](#ems) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"ems",description:'Appends the string "em" to the end of a number. Useful for specifying CSS units.',parameters:[{name:"value",type:"Number",description:"The number to make into a CSS em-unit value."}],returns:'The number as a string, plus the text "em", with no intermediate whitespace.',examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(ems(100.5) === "100.5em");'}]});var ems=fmt.bind(this,"$1em");pliny["function"]("",{name:"rems",description:'Appends the string "rem" to the end of a number. Useful for specifying CSS units.',parameters:[{name:"value",type:"Number",description:"The number to make into a CSS rem-unit value."}],returns:'The number as a string, plus the text "em", with no intermediate whitespace.',examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(rems(100.5) === "100.5rem");'}]});var rems=fmt.bind(this,"$1rem");pliny["function"]("",{name:"vws",description:'Appends the string "vw" to the end of a number. Useful for specifying CSS units.',parameters:[{name:"value",type:"Number",description:"The number to make into a CSS view-width-unit value."}],returns:'The number as a string, plus the text "vw", with no intermediate whitespace.',examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(vws(100.5) === "100.5vw");'}]});var vws=fmt.bind(this,"$1vw");pliny.issue("",{name:"document rgb function",type:"closed",description:"Finish writing the documentation for the [rgb](#rgb) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"rgb",description:"Builds a CSS `rbg()` color-value string from three parameters.",parameters:[{name:"red",type:"Number",description:"The red component, on the range [0, 255]."},{name:"green",type:"Number",description:"The green component, on the range [0, 255]."},{name:"blue",type:"Number",description:"The blue component, on the range [0, 255]."}],returns:"The color-value string, e.g. `rgb(120, 230, 64)`.",examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(rgb(120, 230, 64) === "rgb(120, 230, 64)");'}]});var rgb=fmt.bind(this,"rgb($1, $2, $3)");pliny.issue("",{name:"document rgba function",type:"closed",description:"Finish writing the documentation for the [rgba](#rgba) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"rgba",description:"Builds a CSS `rbga()` color-value string from three parameters.",parameters:[{name:"red",type:"Number",description:"The red component, on the range [0, 255]."},{name:"green",type:"Number",description:"The green component, on the range [0, 255]."},{name:"blue",type:"Number",description:"The blue component, on the range [0, 255]."},{name:"alpha",type:"Number",description:"The alpha component, on the range [0, 1]."}],returns:"The color-value string, e.g. `rgba(120, 230, 64, 0.75)`.",examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(rgba(120, 230, 64, 0.75) === "rgba(120, 230, 64, 0.75)");'}]});var rgba=fmt.bind(this,"rgba($1, $2, $3, $4)");pliny.issue("",{name:"document hsl function",type:"closed",description:"Finish writing the documentation for the [hsl](#hsl) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"hsl",description:"Builds a CSS `hsl()` color-value string from three parameters.",parameters:[{name:"hue",type:"Number",description:"The hue angle, on the range [0, 360]. By definition, 0 = 360. Values also wrap-around, so -120 = 240."},{name:"saturation",type:"Number",description:"The saturation percentage, on the range [0, 100]."},{name:"lightness",type:"Number",description:"The lightness percentage, on the range [0, 100]."}],returns:"The color-value string, e.g. `hsl(120, 100, 50)`.",examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(hsl(120, 100, 50) === "hsl(120, 100%, 50%)");'}]});var hsl=fmt.bind(this,"hsl($1, $2%, $3%)");pliny.issue("",{name:"document hsla function",type:"closed",description:"Finish writing the documentation for the [hsla](#hsla) function in the helpers/fmt.js file."}),pliny["function"]("",{name:"hsla",description:"Builds a CSS `hsla()` color-value string from three parameters.",parameters:[{name:"hue",type:"Number",description:"The hue angle, on the range [0, 360]. By definition, 0 = 360. Values also wrap-around, so -120 = 240."},{name:"saturation",type:"Number",description:"The saturation percentage, on the range [0, 100]."},{name:"lightness",type:"Number",description:"The lightness percentage, on the range [0, 100]."},{name:"alpha",type:"Number",description:"The alpha component, on the range [0, 1]."}],returns:"The color-value string, e.g. `hsla(120, 100, 50, 0.25)`.",examples:[{name:"Basic usage",description:'\r\n    grammar("JavaScript");\n\r\n    console.assert(hsla(120, 100, 50) === "hsla(120, 100%, 50%, 0.25)");'}]});var hsla=fmt.bind(this,"hsla($1, $2%, $3%, $4)");pliny.issue("",{name:"document getSetting",type:"closed",description:"Finish writing the documentation for the `getSetting()` function in the helpers/forms.js file."}),pliny["function"]("",{name:"getSetting",parameters:[{name:" name",type:"string",description:"The name of the setting to read."},{name:"defValue",type:"Object",description:"The default value to return, if the setting is not present in `localStorage`."}],returns:"The Object stored in `localStorage` for the given name, or the default value provided if the setting doesn't exist in `localStorage`.",description:"Retrieves named values out of `localStorage`. The values should\n\r\nbe valid for passing to `JSON.parse()`. A default value can be specified in the\n\r\nfunction call that should be returned if the value does not exist, or causes an\n\r\nerror in parsing. Typically, you'd call this function at page-load time after having\n\r\ncalled the [`setSetting()`](#setSetting) function during a previous page session.",examples:[{name:"Basic usage",description:'Assuming a text input element with the id `text1`, the following\n\r\ncode should persist between reloads whatever the user writes in the text area:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var text1 = document.getElementById("text1");\n\r\n    document.addEventListener("unload", function(){\n\r\n      setSetting("text1-value", text1.value);\n\r\n    }, false);\n\r\n    document.addEventListener("load", function(){\n\r\n      text1.value = getSetting("text1-value", "My default value!");\n\r\n    }, false);'}]}),pliny.issue("",{name:"document setSetting",type:"closed",description:"Finish writing the documentation for the `setSetting()` function in the helpers/forms.js file."}),pliny["function"]("",{name:"setSetting",parameters:[{name:" name",type:"string",description:"The name of the setting to set."},{name:"val",type:"Object",description:"The value to write. It should be useable as a parameter to `JSON.stringify()`."}],description:"Writes named values to `localStorage`. The values should be valid\n\r\nfor passing to `JSON.stringify()`. Typically, you'd call this function at page-unload\n\r\ntime, then call the [`getSetting()`](#getSetting) function during a subsequent page load.",examples:[{name:"Basic usage",description:'Assuming a text input element with the id `text1`, the following\n\r\ncode should persist between reloads whatever the user writes in the text area:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var text1 = document.getElementById("text1");\n\r\n    document.addEventListener("unload", function(){\n\r\n      setSetting("text1-value", text1.value);\n\r\n    }, false);\n\r\n    document.addEventListener("load", function(){\n\r\n      text1.value = getSetting("text1-value", "My default value!");\n\r\n    }, false);'}]}),pliny.issue("",{name:"document deleteSetting",type:"closed",description:"Finish writing the documentation for the `deleteSetting()` function in the helpers/forms.js file."}),pliny["function"]("",{name:"deleteSetting",parameters:[{name:" name",type:"string",description:"The name of the setting to delete."}],description:"Removes an object from localStorage",examples:[{name:"Basic usage",description:'\r\n\n\r\n    grammar("JavaScript");\n\r\n    console.assert(getSetting("A", "default-A") === "default-A");\n\r\n    setSetting("A", "modified-A");\n\r\n    console.assert(getSetting("A", "default-A") === "modified-A");\n\r\n    deleteSetting("A");\n\r\n    console.assert(getSetting("A", "default-A") === "default-A");'}]}),pliny.issue("",{name:"document readForm",type:"closed",description:"Finish writing the documentation for the `readForm()` function in the helpers/forms.js file."}),pliny["function"]("",{name:"readForm",parameters:[{name:"ctrls",type:"Hash of Elements",description:"An array of HTML form elements, aka INPUT, TEXTAREA, SELECT, etc."}],returns:"Object",description:"Scans through an array of input elements and builds a state object that contains the values the input elements represent. Elements that do not have an ID attribute set, or have an attribute `data-skipcache` set, will not be included.",examples:[{name:"Basic usage",description:'Assuming the following HTML form:\n\r\n\n\r\n    grammar("HTML");\n\r\n    <form>\n\r\n      <input type="text" id="txt" value="hello">\n\r\n      <input type="number" id="num" value="5">\n\r\n    </form>\n\r\n\n\r\n##Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var ctrls = findEverything();\n\r\n    ctrls.txt.value = "world";\n\r\n    ctrls.num.value = "6"6;\n\r\n    var state = readForm(ctrls);\n\r\n    console.assert(state.txt === "world");\n\r\n    console.assert(state.num === "6");\n\r\n    state.txt = "mars";\n\r\n    state.num = 55;\n\r\n    writeForm(ctrls, state);\n\r\n    console.assert(ctrls.txt.value === "mars");\n\r\n    console.assert(ctrls.num.value === "55");'}]}),pliny.issue("",{name:"document writeForm",type:"closed",description:"Finish writing the documentation for the `writeForm()` function in the helpers/forms.js file."}),pliny["function"]("",{name:"writeForm",parameters:[{name:"ctrls",type:"Hash of Elements",description:"A hash-collection of HTML input elements that will have their values set."},{name:"state",type:"Hash object",description:"The values that will be set on the form. Hash keys should match IDs of the elements in the `ctrls` parameter."}],description:"Writes out a full set of state values to an HTML input form, wherever keys in the `ctrls` parameter match keys in the `state` parameter.",examples:[{name:"Basic usage",description:'Assuming the following HTML form:\n\r\n\n\r\n    grammar("HTML");\n\r\n    <form>\n\r\n      <input type="text" id="txt" value="hello">\n\r\n      <input type="number" id="num" value="5">\n\r\n    </form>\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var ctrls = findEverything();\n\r\n    ctrls.txt.value = "world";\n\r\n    ctrls.num.value = "6"6;\n\r\n    var state = readForm(ctrls);\n\r\n    console.assert(state.txt === "world");\n\r\n    console.assert(state.num === "6");\n\r\n    state.txt = "mars";\n\r\n    state.num = 55;\n\r\n    writeForm(ctrls, state);\n\r\n    console.assert(ctrls.txt.value === "mars");\n\r\n    console.assert(ctrls.num.value === "55");'}]}),pliny.issue("",{name:"document helpers/forms.js",type:"closed",description:"Finish writing the documentation for the [forms](#forms) file in the helpers/ directory."}),pliny.issue("",{name:"document InsideSphereGeometry",type:"closed",description:"Finish writing the documentation for the [`InsideSphereGeometry`](#InsideSphereGeometry) class\n\r\nin the helpers/graphics.js file."}),pliny["class"]("",{name:"InsideSphereGeometry",parameters:[{name:"radius",type:"Number",description:"How far the sphere should extend away from a center point."},{name:"widthSegments",type:"Number",description:"The number of faces wide in which to slice the geometry."},{name:"heightSegments",type:"Number",description:"The number of faces tall in which to slice the geometry."},{name:"phiStart",type:"Number",description:"The angle in radians around the Y-axis at which the sphere starts."},{name:"phiLength",type:"Number",description:"The change of angle in radians around the Y-axis to which the sphere ends."},{name:"thetaStart",type:"Number",description:"The angle in radians around the Z-axis at which the sphere starts."},{name:"thetaLength",type:"Number",description:"The change of angle in radians around the Z-axis to which the sphere ends."}],description:"The InsideSphereGeometry is basically an inside-out Sphere. Or\n\r\nmore accurately, it's a Sphere where the face winding order is reversed, so that\n\r\ntextures appear on the inside of the sphere, rather than the outside. I know, that's\n\r\nnote exactly helpful.\n\r\n\n\r\nSay you want a to model the sky as a sphere, or the inside of a helmet. You don't\n\r\ncare anything about the outside of this sphere, only the inside. You would use\n\r\nInsideSphereGeometry in this case. Or its alias, [`shell()`](#shell)."}),"undefined"!=typeof window.THREE&&(InsideSphereGeometry.prototype=Object.create(THREE.Geometry.prototype),InsideSphereGeometry.prototype.constructor=InsideSphereGeometry),pliny.issue("",{name:"document shell",type:"closed",description:"Finish writing the documentation for the [`shell`](#shell) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"shell",parameters:[{name:"radius",type:"Number",description:"How far the sphere should extend away from a center point."},{name:"widthSegments",type:"Number",description:"The number of faces wide in which to slice the geometry."},{name:"heightSegments",type:"Number",description:"The number of faces tall in which to slice the geometry."},{name:"phi",type:"Number",description:"The angle in radians around the Y-axis of the sphere."},{name:"thetaStart",type:"Number",description:"The angle in radians around the Z-axis of the sphere."}],description:"The shell is basically an inside-out sphere. Say you want a to model\n\r\nthe sky as a sphere, or the inside of a helmet. You don't care anything about the\n\r\noutside of this sphere, only the inside. You would use InsideSphereGeometry in this\n\r\ncase. It is mostly an alias for [`InsideSphereGeometry`](#InsideSphereGeometry).",
examples:[{name:"Create a sky sphere",description:"To create a sphere that hovers around the user at a\n\r\nfar distance, showing a sky of some kind, you can use the `shell()` function in\n\r\ncombination with the [`textured()`](#textured) function. Assuming you have an image\n\r\nfile to use as the texture, execute code as such:\n\r\n\n\r\n    grammar(\"JavaScript\");\n\r\n    var sky = textured(\n\r\n      shell(\n\r\n          // The radius value should be less than your draw distance.\n\r\n          1000,\n\r\n          // The number of slices defines how smooth the sphere will be in the\n\r\n          // horizontal direction. Think of it like lines of longitude.\n\r\n          18,\n\r\n          // The number of rinigs defines how smooth the sphere will be in the\n\r\n          // vertical direction. Think of it like lines of latitude.\n\r\n          9,\n\r\n          // The phi angle is the number or radians around the 'belt' of the sphere\n\r\n          // to sweep out the geometry. To make a full circle, you'll need 2 * PI\n\r\n          // radians.\n\r\n          Math.PI * 2,\n\r\n          // The theta angle is the number of radians above and below the 'belt'\n\r\n          // of the sphere to sweep out the geometry. Since the belt sweeps a full\n\r\n          // 360 degrees, theta only needs to sweep a half circle, or PI radians.\n\r\n          Math.PI ),\n\r\n      // Specify the texture image next.\n\r\n      \"skyTexture.jpg\",\n\r\n      // Specify that the material should be shadeless, i.e. no shadows. This\n\r\n      // works best for skymaps.\n\r\n      true );"}]}),pliny.issue("",{name:"document axis",type:"open",description:"Finish writing the documentation for the [`axis`](#axis) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"axis",description:"<under construction>"}),pliny.issue("",{name:"document box",type:"open",description:"Finish writing the documentation for the [`box`](#box) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"box",description:"<under construction>"}),pliny.issue("",{name:"document light",type:"open",description:"Finish writing the documentation for the [`light`](#light) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"light",description:"<under construction>"}),pliny.issue("",{name:"document v3",type:"open",description:"Finish writing the documentation for the [`v3`](#v3) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"v3",description:"<under construction>"}),pliny.issue("",{name:"document quad",type:"open",description:"Finish writing the documentation for the [`quad`](#quad) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"quad",description:"<under construction>"}),pliny.issue("",{name:"document hub",type:"open",description:"Finish writing the documentation for the [`hub`](#hub) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"hub",description:"<under construction>"}),pliny.issue("",{name:"document brick",type:"open",description:"Finish writing the documentation for the [`brick`](#brick) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"brick",description:"<under construction>"}),pliny.issue("",{name:"document put",type:"open",description:"Finish writing the documentation for the [`put`](#put) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"put",description:"<under construction>"}),pliny.issue("",{name:"document textured",type:"open",description:"Finish writing the documentation for the [`textured`](#textured) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"textured",description:"<under construction>"}),pliny.issue("",{name:"document sphere",type:"open",description:"Finish writing the documentation for the [`sphere`](#sphere) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"sphere",description:"<under construction>"}),pliny.issue("",{name:"document cylinder",type:"open",description:"Finish writing the documentation for the [`cylinder`](#cylinder) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"cylinder",description:"<under construction>"}),pliny.issue("",{name:"document cloud",type:"open",description:"Finish writing the documentation for the [`cloud`](#cloud) function\n\r\nin the helpers/graphics.js file."}),pliny["function"]("",{name:"cloud",description:"<under construction>"}),pliny.issue("",{name:"document helpers/graphics",type:"open",description:"Finish writing the documentation for the [graphics](#graphics) class in the helpers/ directory"}),pliny.issue("",{name:"document copyObject",type:"open",description:"Finish writing the documentation for the [`copyObject`](#copyObject) function\n\r\nin the helpers/oop.js file."}),pliny["function"]("",{name:"copyObject",description:"<under construction>"}),pliny.issue("",{name:"document inherit",type:"open",description:"Finish writing the documentation for the [`inherit`](#inherit) function\n\r\nin the helpers/oop.js file."}),pliny["function"]("",{name:"inherit",description:"<under construction>"}),pliny.issue("",{name:"document range",type:"open",description:"Finish writing the documentation for the [`range`](#range) function\n\r\nin the helpers/oop.js file."}),pliny["function"]("",{name:"range",description:"<under construction>"}),pliny.issue("",{name:"document emit",type:"open",description:"Finish writing the documentation for the [`emit`](#emit) function\n\r\nin the helpers/oop.js file."}),pliny["function"]("",{name:"emit",description:"<under construction>"}),pliny.issue("",{name:"document helpers/oop",type:"open",description:"Finish writing the documentation for the [oop](#oop) class in the helpers/ directory"}),pliny.issue("",{name:"document clearKeyOption",type:"open",description:"Finish writing the documentation for the [`clearKeyOption`](#clearKeyOption) function\n\r\nin the helpers/options.js file."}),pliny["function"]("",{name:"clearKeyOption",description:"<under construction>"}),pliny.issue("",{name:"document setKeyOption",type:"open",description:"Finish writing the documentation for the [`setKeyOption`](#setKeyOption) function\n\r\nin the helpers/options.js file."}),pliny["function"]("",{name:"setKeyOption",description:"<under construction>"}),pliny.issue("",{name:"document setupKeyOption",type:"open",description:"Finish writing the documentation for the [`setupKeyOption`](#setupKeyOption) function\n\r\nin the helpers/options.js file."}),pliny["function"]("",{name:"setupKeyOption",description:"<under construction>"}),pliny.issue("",{name:"document combineDefaults",type:"open",description:"Finish writing the documentation for the [`combineDefaults`](#combineDefaults) function\n\r\nin the helpers/options.js file."}),pliny["function"]("",{name:"combineDefaults",description:"<under construction>"}),pliny.issue("",{name:"document helpers/options",type:"open",description:"Finish writing the documentation for the [options](#options) class in the helpers/ directory"}),Primrose.Input.ButtonAndAxis=function(){function a(a,b,c,d){Primrose.NetworkedInput.call(this,a,b,c),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.inputState.axes",type:"open",description:""}),this.inputState.axes=[],pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.inputState.buttons",type:"open",description:""}),this.inputState.buttons=[],pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.axisNames",type:"open",description:""}),this.axisNames=d||[];for(var e=0;e<this.axisNames.length;++e)this.inputState.axes[e]=0;pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setDeadzone",type:"open",description:""}),this.setDeadzone=this.setProperty.bind(this,"deadzone"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setScale",type:"open",description:""}),this.setScale=this.setProperty.bind(this,"scale"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setDT",type:"open",description:""}),this.setDT=this.setProperty.bind(this,"dt"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setMin",type:"open",description:""}),this.setMin=this.setProperty.bind(this,"min"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setMax",type:"open",description:""}),this.setMax=this.setProperty.bind(this,"max"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.addMetaKey",type:"open",description:""}),this.addMetaKey=this.addToArray.bind(this,"metaKeys"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.addAxis",type:"open",description:""}),this.addAxis=this.addToArray.bind(this,"axes"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.addButton",type:"open",description:""}),this.addButton=this.addToArray.bind(this,"buttons"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.removeMetaKey",type:"open",description:""}),this.removeMetaKey=this.removeFromArray.bind(this,"metaKeys"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.removeAxis",type:"open",description:""}),this.removeAxis=this.removeFromArray.bind(this,"axes"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.removeButton",type:"open",description:""}),this.removeButton=this.removeFromArray.bind(this,"buttons"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.invertAxis",type:"open",description:""}),this.invertAxis=this.invertInArray.bind(this,"axes"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.invertButton",type:"open",description:""}),this.invertButton=this.invertInArray.bind(this,"buttons"),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.invertMetaKey",type:"open",description:""}),this.invertMetaKey=this.invertInArray.bind(this,"metaKeys")}return pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis",type:"open",description:"Finish writing the documentation for the [Primrose.Input.ButtonAndAxis](#Primrose_Input_ButtonAndAxis) class in the input/ directory."}),pliny["class"]("Primrose.Input",{name:"ButtonAndAxis",description:"<under construction>",parameters:[{name:"",type:"",description:""},{name:"",type:"",description:""},{name:"",type:"",description:""},{name:"",type:"",description:""}]}),inherit(a,Primrose.NetworkedInput),pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.inherit",type:"open",description:""}),a.inherit=function(b){inherit(b,a),b.AXES&&b.AXES.forEach(function(a,c){b[a]=c+1,Object.defineProperty(b.prototype,a,{get:function(){return this.getAxis(a)},set:function(b){this.setAxis(a,b)}})})},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.getAxis",type:"open",description:""}),a.prototype.getAxis=function(a){var b=this.axisNames.indexOf(a);if(b>-1){var c=this.inputState.axes[b]||0;return c}return null},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setAxis",type:"open",description:""}),a.prototype.setAxis=function(a,b){var c=this.axisNames.indexOf(a);c>-1&&(this.inPhysicalUse=!0,this.inputState.axes[c]=b)},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setButton",type:"open",description:""}),a.prototype.setButton=function(a,b){this.inPhysicalUse=!0,this.inputState.buttons[a]=b},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.getValue",type:"open",description:""}),a.prototype.getValue=function(a){return(this.enabled||this.receiving&&this.socketReady)&&this.isEnabled(a)&&this.commands[a].state.value||this.getAxis(a)||0},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.setValue",type:"open",description:""}),a.prototype.setValue=function(a,b){var c=this.axisNames.indexOf(a);!this.commands[a]&&c>-1?this.setAxis(a,b):this.commands[a]&&!this.commands[a].disabled&&(this.commands[a].state.value=b)},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.getVector3",type:"open",description:""}),a.prototype.getVector3=function(a,b,c,d){return d=d||new THREE.Vector3,d.set(this.getValue(a),this.getValue(b),this.getValue(c)),d},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.addVector3",type:"open",description:""}),a.prototype.addVector3=function(a,b,c,d){return d.x+=this.getValue(a),d.y+=this.getValue(b),d.z+=this.getValue(c),d},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.isDown",type:"open",description:""}),a.prototype.isDown=function(a){return(this.enabled||this.receiving&&this.socketReady)&&this.isEnabled(a)&&this.commands[a].state.pressed},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.isUp",type:"open",description:""}),a.prototype.isUp=function(a){return(this.enabled||this.receiving&&this.socketReady)&&this.isEnabled(a)&&this.commands[a].state.pressed},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.maybeClone",type:"open",description:""}),a.prototype.maybeClone=function(a){var b=[];if(a)for(var c=0;c<a.length;++c)b[c]={index:Math.abs(a[c])-1,toggle:a[c]<0,sign:a[c]<0?-1:1};return b},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.cloneCommand",type:"open",description:""}),a.prototype.cloneCommand=function(a){return{name:a.name,disabled:!!a.disabled,dt:a.dt||0,deadzone:a.deadzone||0,threshold:a.threshold||0,repetitions:a.repetitions||1,scale:a.scale,offset:a.offset,min:a.min,max:a.max,integrate:a.integrate||!1,delta:a.delta||!1,axes:this.maybeClone(a.axes),commands:a.commands&&a.commands.slice()||[],buttons:this.maybeClone(a.buttons),metaKeys:this.maybeClone(a.metaKeys&&a.metaKeys.map(function(a){for(var b=0;b<Primrose.Keys.MODIFIER_KEYS.length;++b){var c=Primrose.Keys.MODIFIER_KEYS[b];if(Math.abs(a)===Primrose.Keys[c.toLocaleUpperCase()])return Math.sign(a)*(b+1)}}.bind(this))),commandDown:a.commandDown,commandUp:a.commandUp}},pliny.issue("Primrose.Input.ButtonAndAxis",{name:"document ButtonAndAxis.evalCommand",type:"open",description:""}),a.prototype.evalCommand=function(a,b,c){if(b){var d,e,f=!0,g=0;if(a.buttons)for(d=0;d<a.buttons.length;++d){var h=a.buttons[d],i=!!this.inputState.buttons[h.index+1];e=i?h.sign:0,f=f&&(i&&!h.toggle||!i&&h.toggle),Math.abs(e)>Math.abs(g)&&(g=e)}if(a.axes)for(d=0;d<a.axes.length;++d){var j=a.axes[d];e=j.sign*this.inputState.axes[j.index],Math.abs(e)>Math.abs(g)&&(g=e)}for(d=0;d<a.commands.length;++d)e=this.getValue(a.commands[d]),Math.abs(e)>Math.abs(g)&&(g=e);if(void 0!==a.scale&&(g*=a.scale),void 0!==a.offset&&(g+=a.offset),a.deadzone&&Math.abs(g)<a.deadzone&&(g=0),a.integrate)g=this.getValue(a.name)+g*c;else if(a.delta){var k=g;void 0!==a.state.lv&&(g=(g-a.state.lv)/c),a.state.lv=k}void 0!==a.min&&(g=Math.max(a.min,g)),void 0!==a.max&&(g=Math.min(a.max,g)),a.threshold&&(f=f&&g>a.threshold),a.state.pressed=f,a.state.value=g}},a}(),Primrose.Input.Camera=function(){function a(b,c,d,e,f,g,h){MediaStreamTrack.getSources(function(a){var d=document.createElement("option");d.value="",d.innerHTML="-- select camera --",b.appendChild(d);for(var e=0;e<a.length;++e)"video"===a[e].kind&&(d=document.createElement("option"),d.value=a[e].id,d.innerHTML=fmt("[Facing: $1] [ID: $2...]",a[e].facing||"N/A",a[e].id.substring(0,8)),d.selected=a[e].id===c,b.appendChild(d))}),pliny.issue("Primrose.Input.Camera",{name:"document Camera.options",type:"open",description:""}),this.options=combineDefaults(h,a),pliny.issue("Primrose.Input.Camera",{name:"document Camera.videoElement",type:"open",description:""}),this.videoElement=document.createElement("video"),pliny.issue("Primrose.Input.Camera",{name:"document Camera.buffer",type:"open",description:""}),this.buffer=document.createElement("canvas"),pliny.issue("Primrose.Input.Camera",{name:"document Camera.gfx",type:"open",description:""}),this.gfx=this.buffer.getContext("2d"),pliny.issue("Primrose.Input.Camera",{name:"document Camera.texture",type:"open",description:""}),this.texture=new THREE.Texture(this.buffer);var i=new THREE.MeshBasicMaterial({map:this.texture,useScreenCoordinates:!1,color:16777215,shading:THREE.FlatShading});this.gfx.width=500,this.gfx.height=500,this.gfx.fillStyle="white",this.gfx.fillRect(0,0,500,500);var j=new THREE.PlaneGeometry(d,d);j.computeBoundingBox(),j.computeVertexNormals(),pliny.issue("Primrose.Input.Camera",{name:"document Camera.mesh",type:"open",description:""}),this.mesh=new THREE.Mesh(j,i),this.mesh.position.set(e,f,g),pliny.issue("Primrose.Input.Camera",{name:"document Camera.streaming",type:"open",description:""}),this.streaming=!1,this.videoElement.autoplay=1;var k=function(a,b,c){navigator.getUserMedia({video:a},function(a){streamURL=window.URL.createObjectURL(a),this.videoElement.src=streamURL,b()}.bind(this),c)}.bind(this),l=function(a,b,c){if(c=c||0,this.options.videoModes&&c<this.options.videoModes.length){var d=this.options.videoModes[c],e={optional:[{sourceId:a}]};"default"!==d&&(e.mandatory={minWidth:d.w,minHeight:d.h},d=fmt("[w:$1, h:$2]",d.w,d.h)),k(e,function(){console.log(fmt("Connected to camera at mode $1.",d))},function(b){console.error(fmt("Failed to connect at mode $1. Reason: $2",d,b)),l(a,b,c+1)})}else b("no video modes specified.")}.bind(this);this.videoElement.addEventListener("canplay",function(){this.streaming||(this.streaming=!0)}.bind(this),!1),this.videoElement.addEventListener("playing",function(){this.videoElement.height=this.buffer.height=this.videoElement.videoHeight,this.videoElement.width=this.buffer.width=this.videoElement.videoWidth;var a=this.videoElement.videoWidth/this.videoElement.videoHeight;this.mesh.scale.set(a,1,1)}.bind(this),!1),pliny.issue("Primrose.Input.Camera",{name:"document Camera.connect",type:"open",description:""}),this.connect=function(a){if(this.streaming)try{window.stream&&window.stream.stop(),this.videoElement.src=null,this.streaming=!1}catch(b){console.error("While stopping",b)}l(a,function(a){console.error(fmt("Couldn't connect at requested resolutions. Reason: $1",a)),k(!0,console.log.bind(console,"Connected to camera at default resolution"),console.error.bind(console,"Final connect attempt"))})}.bind(this),c&&this.connect(c)}return Navigator.prototype.getUserMedia=Navigator.prototype.getUserMedia||Navigator.prototype.webkitGetUserMedia||Navigator.prototype.mozGetUserMedia||Navigator.prototype.msGetUserMedia||Navigator.prototype.oGetUserMedia||function(){},pliny.issue("Primrose.Input.Camera",{name:"document Camera",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Camera](#Primrose_Input_Camera) class in the input/ directory"}),pliny["class"]("Primrose.Input",{name:"Camera",description:"<under construction>"}),pliny.issue("Primrose.Input.Camera",{name:"document Camera.DEFAULTS",type:"open",description:""}),a.DEFAULTS={videoModes:[{w:320,h:240},{w:640,h:480},"default"]},pliny.issue("Primrose.Input.Camera",{name:"document Camera.update",type:"open",description:""}),a.prototype.update=function(){this.gfx.drawImage(this.videoElement,0,0),this.texture.needsUpdate=!0},a}(),Primrose.Input.FPSInput=function(){function a(a,b,c){a=a||window,pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.listeners",type:"open",description:""}),this.listeners={jump:[],zero:[]},pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.managers",type:"open",description:""}),this.managers=[new Primrose.Input.Keyboard("keyboard",window,{strafeLeft:{buttons:[-Primrose.Keys.A,-Primrose.Keys.LEFTARROW]},strafeRight:{buttons:[Primrose.Keys.D,Primrose.Keys.RIGHTARROW]},strafe:{commands:["strafeLeft","strafeRight"]},driveForward:{buttons:[-Primrose.Keys.W,-Primrose.Keys.UPARROW]},driveBack:{buttons:[Primrose.Keys.S,Primrose.Keys.DOWNARROW]},drive:{commands:["driveForward","driveBack"]},select:{buttons:[Primrose.Keys.ENTER]},dSelect:{buttons:[Primrose.Keys.ENTER],delta:!0},jump:{buttons:[Primrose.Keys.SPACE],metaKeys:[-Primrose.Keys.SHIFT],commandDown:emit.bind(this,"jump"),dt:.5},zero:{buttons:[Primrose.Keys.Z],metaKeys:[-Primrose.Keys.CTRL,-Primrose.Keys.ALT,-Primrose.Keys.SHIFT,-Primrose.Keys.META],commandUp:emit.bind(this,"zero")}}),new Primrose.Input.Mouse("mouse",a,{buttons:{axes:[Primrose.Input.Mouse.BUTTONS]},dButtons:{axes:[Primrose.Input.Mouse.BUTTONS],delta:!0},dx:{axes:[-Primrose.Input.Mouse.X],delta:!0,scale:.005,min:-5,max:5},heading:{commands:["dx"],integrate:!0},dy:{axes:[-Primrose.Input.Mouse.Y],delta:!0,scale:.005,min:-5,max:5},pitch:{commands:["dy"],integrate:!0,min:.5*-Math.PI,max:.5*Math.PI},pointerPitch:{commands:["dy"],integrate:!0,min:.25*-Math.PI,max:.25*Math.PI}}),new Primrose.Input.Touch("touch",a,{buttons:{axes:[Primrose.Input.Touch.FINGERS]},dButtons:{axes:[Primrose.Input.Touch.FINGERS],delta:!0}}),new Primrose.Input.Gamepad("gamepad",{strafe:{axes:[Primrose.Input.Gamepad.LSX]},drive:{axes:[Primrose.Input.Gamepad.LSY]},heading:{axes:[-Primrose.Input.Gamepad.RSX],integrate:!0},dheading:{commands:["heading"],delta:!0},pitch:{axes:[Primrose.Input.Gamepad.RSY],integrate:!0}})],isVR?this.managers.push(new Primrose.Input.VR("vr",b,c)):isMobile&&this.managers.push(new Primrose.Input.Motion("motion",{headVX:{axes:[Primrose.Input.Motion.headAX],integrate:!0},headVY:{axes:[Primrose.Input.Motion.headAY],integrate:!0},headVZ:{axes:[Primrose.Input.Motion.headAZ],integrate:!0},headX:{commands:[Primrose.Input.Motion.headVX],integrate:!0},headY:{commands:[Primrose.Input.Motion.headVY],integrate:!0},headZ:{commands:[Primrose.Input.Motion.headVZ],integrate:!0}})),pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.keyboard",type:"open",description:""}),pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.mouse",type:"open",description:""}),pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.touch",type:"open",description:""}),pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.gamepad",type:"open",description:""}),pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.vr",type:"open",description:""}),pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.motion",type:"open",description:""}),this.managers.reduce(function(a,b){return a[b.name]=b,a},this),pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.connectGamepad",type:"open",description:""}),this.connectGamepad=function(a){!this.gamepad.isGamepadSet()&&confirm(fmt('Would you like to use this gamepad? "$1"',a))&&this.gamepad.setGamepad(a)},this.gamepad.addEventListener("gamepadconnected",this.connectGamepad.bind(this),!1)}pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput",type:"open",description:"Finish writing the documentation for the [Primrose.Input.FPSInput](#Primrose_Input_FPSInput) class in the input/ directory"}),pliny["class"]("Primrose.Input",{name:"FPSInput",description:"<under construction>"});var b=["heading","pitch","roll","pointerPitch","headX","headY","headZ"];if(pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.zero",type:"open",description:""}),a.prototype.zero=function(){this.vr&&this.vr.currentDisplay&&this.vr.currentDisplay.resetPose(),this.motion&&this.motion.zeroAxes();for(var a=0;a<this.managers.length;++a)for(var c=this.managers[a],d=0;c.enabled&&d<b.length;++d)c.setValue(b[d],0)},pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.update",type:"open",description:""}),a.prototype.update=function(a){for(var b=0;b<this.managers.length;++b){var c=this.managers[b];c.enabled&&c.update(a)}},pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.addEventListener",type:"open",description:""}),a.prototype.addEventListener=function(a,b,c){this.listeners[a]?this.listeners[a].push(b):this.managers.forEach(function(d){d.addEventListener&&d.addEventListener(a,b,c)})},pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.getValue",type:"open",description:""}),a.prototype.getValue=function(a){for(var b=0,c=0;c<this.managers.length;++c){var d=this.managers[c];d.enabled&&(b+=d.getValue(a))}return b},window.THREE){pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.getVector3",type:"open",description:""}),a.prototype.getVector3=function(a,b,c,d){d=d||new THREE.Vector3,d.set(0,0,0);for(var e=0;e<this.managers.length;++e){var f=this.managers[e];f.enabled&&f.addVector3(a,b,c,d)}return d},pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.getVector3s",type:"open",description:""}),a.prototype.getVector3s=function(a,b,c,d){d=d||[];for(var e=0;e<this.managers.length;++e){var f=this.managers[e];f.enabled&&(d[e]=f.getVector3(a,b,c,d[e]))}return d};var c=new THREE.Quaternion;return pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.getQuaternion",type:"open",description:""}),a.prototype.getQuaternion=function(a,b,d,e,f,g){f=f||new THREE.Quaternion,f.set(0,0,0,1);for(var h=0;h<this.managers.length;++h){var i=this.managers[h];if(i.enabled&&i.getQuaternion&&(i.getQuaternion(a,b,d,e,c),f.multiply(c),!g))break}return f},pliny.issue("Primrose.Input.FPSInput",{name:"document FPSInput.transforms",type:"open",description:""}),Object.defineProperties(a.prototype,{transforms:{get:function(){return this.vr&&this.vr.transforms?this.vr.transforms:Primrose.Input.Motion.DEFAULT_TRANSFORMS}}}),a}}(),Primrose.Input.Gamepad=function(){function a(b,c,d,e){function f(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)}function g(a,b){for(var c=0;c<a.length;++c)a[c](b)}function h(a){g(k.gamepadconnected,a)}function i(a){g(k.gamepaddisconnected,a)}Primrose.Input.ButtonAndAxis.call(this,b,c,d,a.AXES,!0);var j=[],k={gamepadconnected:[],gamepaddisconnected:[]};pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.superUpdate",type:"open",description:""}),this.superUpdate=this.update,pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.checkDevice",type:"open",description:""}),this.checkDevice=function(b){var c;for(c=0;c<b.buttons.length;++c)this.setButton(c,b.buttons[c].pressed);for(c=0;c<b.axes.length;++c)this.setAxis(a.AXES[c],b.axes[c])},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.update",type:"open",description:""}),this.update=function(a){var b,c,d=[];if(navigator.getGamepads?b=navigator.getGamepads():navigator.webkitGetGamepads&&(b=navigator.webkitGetGamepads()),b)for(c=0;c<b.length;++c){var f=b[c];f&&(-1===j.indexOf(f.id)&&(j.push(f.id),h(f.id)),f.id===e&&this.checkDevice(f),d.push(f.id))}for(c=j.length-1;c>=0;--c)-1===d.indexOf(j[c])&&(i(j[c]),j.splice(c,1));this.superUpdate(a)},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.getErrorMessage",type:"open",description:""}),this.getErrorMessage=function(){return errorMessage},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.setGamepad",type:"open",description:""}),this.setGamepad=function(a){e=a,this.inPhysicalUse=!0},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.clearGamepad",type:"open",description:""}),this.clearGamepad=function(){e=null,this.inPhysicalUse=!1},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.isGamepadSet",type:"open",description:""}),this.isGamepadSet=function(){return!!e},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.getConnectedGamepads",type:"open",description:""}),this.getConnectedGamepads=function(){return j.slice()},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.addEventListener",type:"open",description:""}),this.addEventListener=function(a,b,c){k[a]&&k[a].push(b),"gamepadconnected"===a&&j.forEach(h)},pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.removeEventListener",type:"open",description:""}),this.removeEventListener=function(a,b,c){k[a]&&f(k[a],b)};try{this.update(0),available=!0}catch(l){avaliable=!1,errorMessage=l}}return pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Gamepad](#Primrose_Input_Gamepad) class in the input/ directory"}),pliny["class"]("Primrose.Input",{name:"Gamepad",description:"<under construction>",parameters:[{name:"",type:"",description:""},{name:"",type:"",description:""},{name:"",type:"",description:""},{name:"",type:"",description:""}]}),pliny.issue("Primrose.Input.Gamepad",{name:"document Gamepad.AXES",type:"open",description:""}),a.AXES=["LSX","LSY","RSX","RSY"],Primrose.Input.ButtonAndAxis.inherit(a),a}(),Primrose.Input.Gamepad.XBOX_BUTTONS=pliny.enumeration("Primrose.Input.Gamepad",{name:"XBOX_BUTTONS",description:"Labeled names for each of the different control features of the Xbox 360 controller.",value:{A:1,B:2,X:3,Y:4,leftBumper:5,rightBumper:6,leftTrigger:7,rightTrigger:8,back:9,start:10,leftStick:11,rightStick:12,up:13,down:14,left:15,right:16}}),Primrose.Input.Keyboard=function(){function a(a,b,c,d){function e(a,b){this.setButton(b.keyCode,a)}b=b||window,Primrose.Input.ButtonAndAxis.call(this,a,c,d),b.addEventListener("keydown",e.bind(this,!0),!1),b.addEventListener("keyup",e.bind(this,!1),!1)}return pliny.issue("Primrose.Input.Keyboard",{name:"document Keyboard",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Keyboard](#Primrose_Input_Keyboard) class in the input/ directory"}),pliny["class"]("Primrose.Input",{name:"Keyboard",baseClass:"Primrose.Input.ButtonAndAxis",description:"<under construction>",parameters:[{name:"",type:"",description:""},{name:"",type:"",description:""},{name:"",type:"",description:""},{name:"",type:"",description:""}]}),Primrose.Input.ButtonAndAxis.inherit(a),a}(),Primrose.Input.LeapMotion=function(){function a(b,c,d){pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.isStreaming",type:"open",description:""}),this.isStreaming=!1,Primrose.Input.ButtonAndAxis.call(this,b,c,d,a.AXES),pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.controller",type:"open",description:""}),this.controller=new Leap.Controller({enableGestures:!0})}return pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion",type:"open",description:"Finish writing the documentation for the [Primrose.Input.LeapMotion](#Primrose_Input_LeapMotion) class in the input/ directory"}),pliny["class"]("Primrose.Input",{name:"LeapMotionInput",description:"<under construction>"}),pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.COMPONENTS",type:"open",description:""}),a.COMPONENTS=["X","Y","Z"],pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.NUM_HANDS",type:"open",description:""}),a.NUM_HANDS=2,pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.NUM_FINGERS",type:"open",description:""}),a.NUM_FINGERS=10,pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.FINGER_PARTS",type:"open",description:""}),a.FINGER_PARTS=["tip","dip","pip","mcp","carp"],pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.AXES",type:"open",description:""}),a.AXES=["X0","Y0","Z0","X1","Y1","Z1","FINGER0TIPX","FINGER0TIPY","FINGER0DIPX","FINGER0DIPY","FINGER0PIPX","FINGER0PIPY","FINGER0MCPX","FINGER0MCPY","FINGER0CARPX","FINGER0CARPY","FINGER1TIPX","FINGER1TIPY","FINGER1DIPX","FINGER1DIPY","FINGER1PIPX","FINGER1PIPY","FINGER1MCPX","FINGER1MCPY","FINGER1CARPX","FINGER1CARPY","FINGER2TIPX","FINGER2TIPY","FINGER2DIPX","FINGER2DIPY","FINGER2PIPX","FINGER2PIPY","FINGER2MCPX","FINGER2MCPY","FINGER2CARPX","FINGER2CARPY","FINGER3TIPX","FINGER3TIPY","FINGER3DIPX","FINGER3DIPY","FINGER3PIPX","FINGER3PIPY","FINGER3MCPX","FINGER3MCPY","FINGER3CARPX","FINGER3CARPY","FINGER4TIPX","FINGER4TIPY","FINGER4DIPX","FINGER4DIPY","FINGER4PIPX","FINGER4PIPY","FINGER4MCPX","FINGER4MCPY","FINGER4CARPX","FINGER4CARPY","FINGER5TIPX","FINGER5TIPY","FINGER5DIPX","FINGER5DIPY","FINGER5PIPX","FINGER5PIPY","FINGER5MCPX","FINGER5MCPY","FINGER5CARPX","FINGER5CARPY","FINGER6TIPX","FINGER6TIPY","FINGER6DIPX","FINGER6DIPY","FINGER6PIPX","FINGER6PIPY","FINGER6MCPX","FINGER6MCPY","FINGER6CARPX","FINGER6CARPY","FINGER7TIPX","FINGER7TIPY","FINGER7DIPX","FINGER7DIPY","FINGER7PIPX","FINGER7PIPY","FINGER7MCPX","FINGER7MCPY","FINGER7CARPX","FINGER7CARPY","FINGER8TIPX","FINGER8TIPY","FINGER8DIPX","FINGER8DIPY","FINGER8PIPX","FINGER8PIPY","FINGER8MCPX","FINGER8MCPY","FINGER8CARPX","FINGER8CARPY","FINGER9TIPX","FINGER9TIPY","FINGER9DIPX","FINGER9DIPY","FINGER9PIPX","FINGER9PIPY","FINGER9MCPX","FINGER9MCPY","FINGER9CARPX","FINGER9CARPY"],
Primrose.Input.ButtonAndAxis.inherit(a),pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.CONNECTION_TIMEOUT",type:"open",description:""}),a.CONNECTION_TIMEOUT=5e3,pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.E",type:"open",description:""}),a.prototype.E=function(a,b){b?this.controller.on(a,b):this.controller.on(a,console.log.bind(console,"Leap Motion Event: "+a))},pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.start",type:"open",description:""}),a.prototype.start=function(b){if(this.isEnabled()){var c=null,d=null;if(b){var e=function(a){requestAnimationFrame(e),b(a)};d=requestAnimationFrame.bind(window,e);var f=setTimeout(d,a.CONNECTION_TIMEOUT);c=function(){clearTimeout(f),this.isStreaming=!0}.bind(this),this.E("deviceStreaming",c),this.E("streamingStarted",c),this.E("streamingStopped",d)}this.E("connect"),this.E("deviceStopped"),this.E("disconnect"),this.E("frame",this.setState.bind(this,b)),this.controller.connect()}},pliny.issue("Primrose.Input.LeapMotion",{name:"document LeapMotion.setState",type:"open",description:""}),a.prototype.setState=function(b,c){var d,e,f=this.controller.history.get(1);if(!f||c.hands.length!==f.hands.length)for(d=0;d<this.commands.length;++d)this.enable(this.commands[d].name,c.hands.length>0);for(d=0;d<c.hands.length;++d){var g=c.hands[d].palmPosition,h="HAND"+d;for(e=0;e<a.COMPONENTS.length;++e)this.setAxis(h+a.COMPONENTS[e],g[e])}for(d=0;d<c.fingers.length;++d){var i=c.fingers[d],j="FINGER"+d;for(e=0;e<a.FINGER_PARTS.length;++e)for(var k=i[a.FINGER_PARTS[e]+"Position"],l=j+a.FINGER_PARTS[e].toUpperCase(),m=0;m<a.COMPONENTS.length;++m)this.setAxis(l+a.COMPONENTS[m],k[m])}b&&b(.001*c.timestamp)},a}(),Primrose.Input.Location=function(){function a(b,c,d,e){pliny.issue("Primrose.Input.Location",{name:"document Location.options",type:"open",description:""}),this.options=combineDefaults(e,a),Primrose.Input.ButtonAndAxis.call(this,b,c,d,a.AXES),pliny.issue("Primrose.Input.Location",{name:"document Location.available",type:"open",description:""}),this.available=!!navigator.geolocation,this.available&&navigator.geolocation.watchPosition(this.setState.bind(this),function(){this.available=!1}.bind(this),this.options)}return pliny.issue("Primrose.Input.Location",{name:"document Location",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Location](#Primrose_Input_Location) class in the input/ directory"}),pliny["class"]("Primrose.Input",{name:"Location",description:"<under construction>"}),pliny.issue("Primrose.Input.Location",{name:"document Location.AXES",type:"open",description:""}),a.AXES=["LONGITUDE","LATITUDE","ALTITUDE","HEADING","SPEED"],Primrose.Input.ButtonAndAxis.inherit(a),pliny.issue("Primrose.Input.Location",{name:"document Location.DEFAULTS",type:"open",description:""}),a.DEFAULTS={enableHighAccuracy:!0,maximumAge:3e4,timeout:25e3},pliny.issue("Primrose.Input.Location",{name:"document Location.setState",type:"open",description:""}),a.prototype.setState=function(b){for(var c in b.coords){var d=c.toUpperCase();a.AXES.indexOf(d)>-1&&this.setAxis(d,b.coords[c])}},a}(),Primrose.Input.Motion=function(){function a(){function b(a){for(;0>a;)a+=360;for(;a>=360;)a-=360;return a}function c(){d&&e&&(o=Math.abs(d.x),p=Math.abs(d.y),q=Math.abs(d.z),r=o>0?d.x/o:1,s=p>0?d.y/p:1,t=q>0?d.z/q:1,o>p&&o>q&&o>4.5?u=-1===r:p>q&&p>o&&p>4.5&&(u=1===s),v=isWebKit?u?e.gamma>0:e.gamma<0:1===t,f=isWebKit&&v^!u||!isWebKit&&u?270:90,u?v?(i=isiOS?90:-90,j=1,m=-1,l=0):(j=isWebKit?1:-1,i=isiOS?-90:90,m=1,l=180):v?(i=isiOS?90:-90,j=-1,m=1,l=0):(j=isWebKit?-1:1,i=isiOS?-90:90,m=-1,l=180),h=b(g*e.alpha+f-x.alpha),k=b(j*e.gamma+i-x.gamma)-360,-180>k&&(k+=360),n=b(m*e.beta+l-x.beta),n>180&&(n-=360))}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w={x:0,y:0,z:0},x={alpha:0,beta:0,gamma:0};g=-1,Object.defineProperties(this,{acceleration:{set:function(a){d=a,c()},get:function(){return d}},orientation:{set:function(a){e=a,c()},get:function(){return e}},heading:{get:function(){return h}},pitch:{get:function(){return k}},roll:{get:function(){return n}}}),this.zeroAxes=function(){d&&(w.x=d.x,w.y=d.y,w.z=d.z),e&&(x.alpha=e.alpha,x.beta=e.beta,x.gamma=e.gamma)},this.addEventListener=function(b,c,d){if("deviceorientation"!==b)throw new Error('The only event type that is supported is "deviceorientation". Type parameter was: '+b);if("function"!=typeof c)throw new Error("A function must be provided as a callback parameter. Callback parameter was: "+c);var e=null,f=null,g=null;this.onChange=function(){var a=this.acceleration;this.orientation&&a&&(null!==e?(e.degrees=-this.heading,f.degrees=this.pitch,g.degrees=this.roll):(e=new Primrose.Angle(-this.heading),f=new Primrose.Angle(this.pitch),g=new Primrose.Angle(this.roll)),c({HEADING:e.radians,PITCH:f.radians,ROLL:g.radians,headAX:a.y-w.y,headAY:a.x-w.x,headAZ:a.z-w.z}))},this.checkOrientation=function(a){this.orientation=null!==a.alpha&&a,this.onChange()},this.checkMotion=function(a){a&&a.accelerationIncludingGravity&&null!==a.accelerationIncludingGravity.x?(this.acceleration=a.accelerationIncludingGravity,this.onChange()):a&&a.acceleration&&null!==a.acceleration.x&&(this.acceleration=a.acceleration,this.onChange())},this.acceleration=a.ZERO_VECTOR,this.orientation=a.ZERO_EULER,window.addEventListener("deviceorientation",this.checkOrientation.bind(this),d),window.addEventListener("devicemotion",this.checkMotion.bind(this),d)}}function b(c,d,e){Primrose.Input.ButtonAndAxis.call(this,c,d,e,b.AXES);var f=new a,g=new THREE.Quaternion,h=new THREE.Quaternion,i=new THREE.Vector3(1,0,0),j=new THREE.Vector3(0,1,0),k=new THREE.Vector3(0,0,-1);f.addEventListener("deviceorientation",function(a){for(var c=0;c<b.AXES.length;++c){var d=b.AXES[c];this.setAxis(d,a[d])}g.set(0,0,0,1).multiply(h.setFromAxisAngle(j,a.HEADING)).multiply(h.setFromAxisAngle(i,a.PITCH)).multiply(h.setFromAxisAngle(k,a.ROLL)),this.headRX=g.x,this.headRY=g.y,this.headRZ=g.z,this.headRW=g.w}.bind(this)),this.zeroAxes=f.zeroAxes.bind(f)}function c(a,b){var c=Math.max(screen.width,screen.height),d=Math.min(screen.width,screen.height),e=Math.floor(c*devicePixelRatio/2),f=Math.floor(d*devicePixelRatio),g=(b+1)/2;a.transform=(new THREE.Matrix4).makeTranslation(.034*b,0,0),a.viewport={x:g*e,y:0,width:e,height:f,top:0,right:(g+1)*e,bottom:f,left:g*e},a.fov=75}return a.ZERO_VECTOR={x:-9.80665,y:0,z:0},a.ZERO_EULER={gamma:90,alpha:270,beta:0},pliny["class"]("Primrose.Input",{name:"Motion",description:"<under construction>"}),b.AXES=["HEADING","PITCH","ROLL","D_HEADING","D_PITCH","D_ROLL","headAX","headAY","headAZ","headRX","headRY","headRZ","headRW"],Primrose.Input.ButtonAndAxis.inherit(b),b.DEFAULT_TRANSFORMS=[{},{}],c(b.DEFAULT_TRANSFORMS[0],-1),c(b.DEFAULT_TRANSFORMS[1],1),b.prototype.getQuaternion=function(a,b,c,d,e){return e=e||new THREE.Quaternion,e.set(this.getValue(a),this.getValue(b),this.getValue(c),this.getValue(d)),e},b}(),pliny.issue("Primrose.Input.Motion",{name:"document Motion",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Motion](#Primrose_Input_Motion) class in the input/ directory"}),Primrose.Input.Mouse=function(){function a(b,c,d,e){c=c||window,Primrose.Input.ButtonAndAxis.call(this,b,d,e,a.AXES),this.setLocation=function(a,b){this.X=a,this.Y=b},this.setMovement=function(a,b){this.X+=a,this.Y+=b},this.readEvent=function(b){if(this.BUTTONS=b.buttons<<10,a.isPointerLocked()){var c=b.movementX,d=b.movementY;void 0===c&&(c=b.webkitMovementX||b.mozMovementX||0,d=b.webkitMovementY||b.mozMovementY||0),this.setMovement(c,d)}else this.setLocation(b.layerX,b.layerY)},c.addEventListener("mousedown",function(a){this.setButton(a.button,!0),this.BUTTONS=a.buttons<<10}.bind(this),!1),c.addEventListener("mouseup",function(a){this.setButton(a.button,!1),this.BUTTONS=a.buttons<<10}.bind(this),!1),c.addEventListener("mousemove",this.readEvent.bind(this),!1),c.addEventListener("wheel",function(a){isChrome?(this.W+=a.deltaX,this.Z+=a.deltaY):a.shiftKey?this.W+=a.deltaY:this.Z+=a.deltaY,a.preventDefault()}.bind(this),!1),this.addEventListener=function(a,b,c){"pointerlockchange"===a&&(document.exitPointerLock?document.addEventListener("pointerlockchange",b,c):document.mozExitPointerLock?document.addEventListener("mozpointerlockchange",b,c):document.webkitExitPointerLock&&document.addEventListener("webkitpointerlockchange",b,c))},this.removeEventListener=function(a,b,c){"pointerlockchange"===a&&(document.exitPointerLock?document.removeEventListener("pointerlockchange",b,c):document.mozExitPointerLock?document.removeEventListener("mozpointerlockchange",b,c):document.webkitExitPointerLock&&document.removeEventListener("webkitpointerlockchange",b,c))},c.requestPointerLock=c.requestPointerLock||c.webkitRequestPointerLock||c.mozRequestPointerLock||function(){},this.requestPointerLock=function(){a.isPointerLocked()||c.requestPointerLock()},this.exitPointerLock=(document.webkitExitPointerLock||document.mozExitPointerLock||document.exitPointerLock||function(){}).bind(document),this.togglePointerLock=function(){a.isPointerLocked()?this.exitPointerLock():this.requestPointerLock()}}return pliny["class"]("Primrose.Input",{name:"Mouse",description:"<under construction>"}),a.isPointerLocked=function(){return!!(document.pointerLockElement||document.webkitPointerLockElement||document.mozPointerLockElement)},a.AXES=["X","Y","Z","W","BUTTONS"],Primrose.Input.ButtonAndAxis.inherit(a),a}(),pliny.issue("Primrose.Input.Mouse",{name:"document Mouse",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Mouse](#Primrose_Input_Mouse) class in the input/ directory"}),Primrose.Input.Speech=function(){function a(a,b,c){function d(){var a=fmt("Failed to initialize speech engine. Reason: $1",i.message);return console.error(a),!1}function e(){return available?g?!1:(g=!0,h.start(),!0):d()}function f(){return available?g?(h.stop(),!0):!1:d()}Primrose.NetworkedInput.call(this,a,b,c);var g=!1,h=null,i=null;this.check=function(){this.enabled&&!g?e():!this.enabled&&g&&f()},this.getErrorMessage=function(){return i};try{h=window.SpeechRecognition?new SpeechRecognition:new webkitSpeechRecognition,h.continuous=!0,h.interimResults=!0,h.lang="en-US";var j=!1;h.addEventListener("start",function(){console.log("speech started"),command=""}.bind(this),!0),h.addEventListener("error",function(a){j=!0,console.log("speech error",a),g=!1,command="speech error"}.bind(this),!0),h.addEventListener("end",function(){console.log("speech ended",arguments),g=!1,command="speech ended",j&&(j=!1,this.enable(!0))}.bind(this),!0),h.addEventListener("result",function(a){var b=[],c=a.results[a.resultIndex],d=0,e=-1;if(c&&c.isFinal)for(var f=0;f<c.length;++f){var g=c[f];g.confidence>d&&(d=g.confidence,e=f)}d>.85&&b.push(c[e].transcript.trim()),b=b.join(" "),b!==this.inputState&&(this.inputState.text=b)}.bind(this),!0),available=!0}catch(k){i=k,available=!1}}return pliny["class"]("Primrose.Input",{name:"Speech",description:"<under construction>"}),inherit(a,Primrose.NetworkedInput),a.maybeClone=function(a){return a&&a.slice()||[]},a.prototype.cloneCommand=function(b){return{name:b.name,preamble:b.preamble,keywords:a.maybeClone(b.keywords),commandUp:b.commandUp,disabled:b.disabled}},a.prototype.evalCommand=function(a,b,c,d){if(c&&this.inputState.text)for(var e=0;e<a.keywords.length;++e)0!==this.inputState.text.indexOf(a.keywords[e])||!a.preamble&&a.keywords[e].length!==this.inputState.text.length||(b.pressed=!0,b.value=this.inputState.text.substring(a.keywords[e].length).trim(),this.inputState.text=null)},a.prototype.enable=function(a,b){Primrose.NetworkedInput.prototype.enable.call(this,a,b),this.check()},a.prototype.transmit=function(a){Primrose.NetworkedInput.prototype.transmit.call(this,a),this.check()},a}(),pliny.issue("Primrose.Input.Speech",{name:"document Speech",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Speech](#Primrose_Input_Speech) class in the input/ directory"}),Primrose.Input.Touch=function(){function a(b,c,d,e){function f(a,b,c){for(var d=c.changedTouches,e=0;e<d.length;++e){var f=d[e];b?(this.setAxis("X"+f.identifier,f.pageX),this.setAxis("Y"+f.identifier,f.pageY)):(this.setAxis("LX"+f.identifier,f.pageX),this.setAxis("LY"+f.identifier,f.pageY));var g=1<<f.identifier;a?this.FINGERS|=g:(g=~g,this.FINGERS&=g)}}c=c||window,Primrose.Input.ButtonAndAxis.call(this,b,d,e,a.AXES),c.addEventListener("touchstart",f.bind(this,!0,!1),!1),c.addEventListener("touchend",f.bind(this,!1,!0),!1),c.addEventListener("touchmove",f.bind(this,!0,!0),!1)}pliny["class"]("Primrose.Input",{name:"Touch",description:"<under construction>"}),a.NUM_FINGERS=10,a.AXES=["FINGERS"];for(var b=0;b<a.NUM_FINGERS;++b)a.AXES.push("X"+b),a.AXES.push("Y"+b);return Primrose.Input.ButtonAndAxis.inherit(a),a}(),pliny.issue("Primrose.Input.Touch",{name:"document Touch",type:"open",description:"Finish writing the documentation for the [Primrose.Input.Touch](#Primrose_Input_Touch) class in the input/ directory"}),Primrose.Input.VR=function(){function a(a){return new Promise(function(b,c){var d,e,f,g=function(){clearTimeout(f),window.removeEventListener("fullscreenchange",d),window.removeEventListener("webkitfullscreenchange",d),window.removeEventListener("mozfullscreenchange",d),window.removeEventListener("msfullscreenchange",d),window.removeEventListener("fullscreenerror",e),window.removeEventListener("webkitfullscreenerror",e),window.removeEventListener("mozfullscreenerror",e),window.removeEventListener("msfullscreenerror",e)};d=function(){g(),console.log("got fullscreen"),b(document.webkitFullscreenElement||document.fullscreenElement)},e=function(a){g(),console.error("no got fullscreen"),c(a)},window.addEventListener("fullscreenchange",d,!1),window.addEventListener("webkitfullscreenchange",d,!1),window.addEventListener("mozfullscreenchange",d,!1),window.addEventListener("msfullscreenchange",d,!1),window.addEventListener("fullscreenerror",e,!1),window.addEventListener("webkitfullscreenerror",e,!1),window.addEventListener("mozfullscreenerror",e,!1),window.addEventListener("msfullscreenerror",e,!1),a(),f=setTimeout(c,1e3)})}function b(b,c){return console.log("requesting fullscreen"),new Promise(function(d,e){a(function(){b.webkitRequestFullscreen?b.webkitRequestFullscreen(c||window.Element.ALLOW_KEYBOARD_INPUT):b.mozRequestFullScreen&&c?b.mozRequestFullScreen(c):b.mozRequestFullScreen&&!c?b.mozRequestFullScreen():b.requestFullScreen?b.requestFullScreen():e()}).then(d)["catch"](e)})}function c(){return console.log("Exiting fullscreen"),new Promise(function(b,c){a(function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():c()}).then(b)["catch"](c)})}function d(a){function d(a){var b={timestamp:a.timestamp,frameID:++h};return a.position&&(b.position=new Float32Array([a.position.x,a.position.y,a.position.z])),a.linearVelocity&&(b.linearVelocity=new Float32Array([a.linearVelocity.x,a.linearVelocity.y,a.linearVelocity.z])),a.linearAcceleration&&(b.linearAcceleration=new Float32Array([a.linearAcceleration.x,a.linearAcceleration.y,a.linearAcceleration.z])),a.orientation&&(b.orientation=new Float32Array([a.orientation.x,a.orientation.y,a.orientation.z,a.orientation.w])),a.angularVelocity&&(b.angularVelocity=new Float32Array([a.angularVelocity.x,a.angularVelocity.y,a.angularVelocity.z])),a.angularAcceleration&&(b.angularAcceleration=new Float32Array([a.angularAcceleration.x,a.angularAcceleration.y,a.angularAcceleration.z])),b}this.capabilities={canPresent:!!a.display,hasExternalDisplay:!!a.display&&!isMobile,hasOrientation:!!a.sensor,hasPosition:!!a.sensor&&!isMobile},this.displayId=a.display.hardwareUnitId,this.displayName="";for(var e=a.display.deviceName,f=a.sensor.deviceName,g=0;g<e.length&&g<f.length&&e[g]===f[g];++g)this.displayName+=e[g];for(;this.displayName.length>0&&!/\w/.test(this.displayName[this.displayName.length-1]);)this.displayName=this.displayName.substring(0,this.displayName.length-1);this.isConnected=!0,this.isPresenting=!1,this.stageParameters=null,this.getEyeParameters=function(b){console.log("getting eye parameters: ",b);var c=null;c=a.display.getEyeParameters?a.display.getEyeParameters(b):{renderRect:a.display.getRecommendedEyeRenderRect(b),eyeTranslation:a.display.getEyeTranslation(b),recommendedFieldOfView:a.display.getRecommendedEyeFieldOfView(b)},console.log("VR Eye Parameters"),console.log("old format",c);var d={renderWidth:c.renderRect.width,renderHeight:c.renderRect.height,offset:new Float32Array([c.eyeTranslation.x,c.eyeTranslation.y,c.eyeTranslation.z]),fieldOfView:c.recommendedFieldOfView};return console.log("new format",d),d};var h=0;this.getImmediatePose=function(){return d(a.sensor.getImmediateState())},this.getPose=function(){return d(a.sensor.getState())},this.resetPose=a.sensor.resetSensor.bind(a.sensor);var i=null;this.getLayers=function(){return[i]};var j={vrDisplay:a.display,vrDistortion:!0};this.requestPresent=function(a){var c=[];return i&&(console.log("need to exit the previous presentation mode, first."),c.push(this.exitPresent())),c.push(new Promise(function(c,d){this.capabilities.canPresent?a?a.source?b(a.source,j).then(function(b){this.isPresenting=b===a.source,i=a,isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary"),c()}.bind(this))["catch"](function(a){this.isPresenting=!1,d(a)}.bind(this)):d(new Error("No source on layer parameter.")):d(new Error("No layer provided to requestPresent")):d(new Error("This device cannot be used as a presentation display. DisplayID: "+this.displayId+". Name: "+this.displayName))}.bind(this))),Promise.all(c)}.bind(this),this.exitPresent=function(){return new Promise(function(a,b){if(this.isPresenting)if(i){var d=function(){this.isPresenting=!1,i=null}.bind(this);c().then(function(){d(),a()})["catch"](function(a){d(),b(a)})}else b(new Error("Not in control of presentation."));else b(new Error("Not presenting."))})}}function e(a,b,c,f,g,h,i){function j(a){for(var b=0;b<n.vrdeviceconnected.length;++b)n.vrdeviceconnected[b](a)}function k(a,d){if(console.log("Displays found:",d.length),console.log("Displays:",d),this.displays=d,a){console.log("Building chooser interface.",a),a.innerHTML="";for(var e=0;e<this.displays.length;++e){var f=document.createElement("option");f.value=e,f.innerHTML=this.displays[e].deviceName,f.selected=i===e,a.appendChild(f)}}this.displays.forEach(j),"number"!=typeof i&&1===this.displays.length&&(i=0),"number"==typeof i&&this.connect(i,b,c)}function l(a,b){console.log("Devices found:",b.length),console.log("Devices:",b);for(var c={},e=null,f=0;f<b.length;++f){var g=b[f];e=g.hardwareUnitId,c[e]||(c[e]={});var h=c[e];g instanceof HMDVRDevice?h.display=g:b[f]instanceof PositionSensorVRDevice&&(h.sensor=g)}var i=[];for(e in c)i.push(new d(c[e]));k.call(this,a,i)}function m(){console.log("Checking for VR Displays..."),navigator.getVRDisplays?(console.log("Using WebVR API 1"),navigator.getVRDisplays().then(k.bind(this,h))):navigator.getVRDevices?(console.log("Using Chromium Experimental WebVR API"),navigator.getVRDevices().then(l.bind(this,h))["catch"](console.error.bind(console,"Could not find VR devices"))):navigator.mozGetVRDevices?(console.log("Using Firefox Experimental WebVR API"),navigator.mozGetVRDevices(l.bind(this,h))):console.log("Your browser doesn't have WebVR capability. Check out http://mozvr.com/")}(void 0===f||null===f)&&(f=e.AXES.map(function(a){return{name:a,axes:[Primrose.Input.VR[a]]}})),Primrose.Input.ButtonAndAxis.call(this,a,f,g,e.AXES);var n={vrdeviceconnected:[],vrdevicelost:[]};this.addEventListener=function(a,b,c){n[a]&&n[a].push(b),"vrdeviceconnected"===a&&Object.keys(this.displays).forEach(b)},this.displays=[],this.currentDisplay=null,this.currentPose=null,this.params=null,this.transforms=null,m.call(this)}function f(a,b,c){var d=Math.tan(a.upDegrees*Math.PI/180),e=Math.tan(a.downDegrees*Math.PI/180),f=Math.tan(a.leftDegrees*Math.PI/180),g=Math.tan(a.rightDegrees*Math.PI/180),h=2/(f+g),i=2/(d+e),j=new THREE.Matrix4;return j.elements[0]=h,j.elements[1]=0,j.elements[2]=0,j.elements[3]=0,j.elements[4]=0,j.elements[5]=i,j.elements[6]=0,j.elements[7]=0,j.elements[8]=-((f-g)*h*.5),j.elements[9]=(d-e)*i*.5,j.elements[10]=-(b+c)/(c-b),j.elements[11]=-1,j.elements[12]=0,j.elements[13]=0,j.elements[14]=-(2*c*b)/(c-b),j.elements[15]=0,j}function g(a,b,c,d){var e=b.offset;a.translation=(new THREE.Matrix4).makeTranslation(e[0],e[1],e[2]),a.projection=f(b.fieldOfView,c,d),a.viewport={left:0,top:0,width:b.renderWidth,height:b.renderHeight}}return d.prototype.requestAnimationFrame=window.requestAnimationFrame.bind(window),d.prototype.cancelAnimationFrame=window.cancelAnimationFrame.bind(window),d.prototype.submitFrame=function(){},pliny["class"]("Primrose.Input",{name:"VR",description:"<under construction>"}),e.AXES=["headX","headY","headZ","headVX","headVY","headVZ","headAX","headAY","headAZ","headRX","headRY","headRZ","headRW","headRVX","headRVY","headRVZ","headRAX","headRAY","headRAZ"],Primrose.Input.ButtonAndAxis.inherit(e),e.prototype.submitFrame=function(){this.currentDisplay&&this.currentDisplay.submitFrame(this.currentPose)},e.prototype.update=function(a){if(this.currentDisplay){var b=this.currentDisplay.capabilities,c=this.currentDisplay.getPose();this.currentPose=c,b.hasPosition&&c.position&&(this.headX=c.position[0],this.headY=c.position[1],this.headZ=c.position[2]),c.linearVelocity&&(this.headVX=c.linearVelocity[0],this.headVY=c.linearVelocity[1],this.headVZ=c.linearVelocity[2]),c.linearAcceleration&&(this.headAX=c.linearAcceleration[0],this.headAY=c.linearAcceleration[1],this.headAZ=c.linearAcceleration[2]),b.hasOrientation&&c.orientation&&(this.headRX=c.orientation[0],this.headRY=c.orientation[1],this.headRZ=c.orientation[2],this.headRW=c.orientation[3]),c.angularVelocity&&(this.headRVX=c.angularVelocity[0],this.headRVY=c.angularVelocity[1],this.headRVZ=c.angularVelocity[2]),c.angularAcceleration&&(this.headRAX=c.angularAcceleration[0],this.headRAY=c.angularAcceleration[1],this.headRAZ=c.angularAcceleration[2])}Primrose.Input.ButtonAndAxis.prototype.update.call(this,a)},e.prototype.getQuaternion=function(a,b,c,d,e){return e=e||new THREE.Quaternion,e.set(this.getValue(a),this.getValue(b),this.getValue(c),this.getValue(d)),e},e.prototype.connect=function(a,b,c){if(this.currentDisplay=this.displays[a],this.currentDisplay){this.enabled=!0;var d={left:this.currentDisplay.getEyeParameters("left"),right:this.currentDisplay.getEyeParameters("right")};this.transforms=[{},{}],g(this.transforms[0],d.left,b,c),g(this.transforms[1],d.right,b,c),this.transforms[1].viewport.left=this.transforms[0].viewport.width,console.log("Transforms built",this.transforms)}},e}(),pliny.issue("Primrose.Input.VR",{name:"document VR",type:"open",description:"Finish writing the documentation for the [Primrose.Input.VR](#Primrose_Input_VR) class in the input/ directory"}),Primrose.Output.Audio3D=function(){function a(){try{this.context=new AudioContext,this.sampleRate=this.context.sampleRate,this.mainVolume=this.context.createGain(),this.mainVolume.connect(this.context.destination),this.setPosition=this.context.listener.setPosition.bind(this.context.listener),this.setVelocity=this.context.listener.setVelocity.bind(this.context.listener),this.setOrientation=this.context.listener.setOrientation.bind(this.context.listener),this.isAvailable=!0}catch(a){this.isAvailable=!1,this.setPosition=function(){},this.setVelocity=function(){},this.setOrientation=function(){},this.error=a,console.error("AudioContext not available. Reason: ",a.message)}}return Window.prototype.AudioContext=Window.prototype.AudioContext||Window.prototype.webkitAudioContext||function(){},pliny["class"]("Primrose.Output",{name:"Audio3D",description:"<under construction>"}),a.prototype.loadBuffer=function(a,b,c){if(!c)throw new Error("You need to provide a callback function for when the audio finishes loading");b||(b=function(){});var d=function(){b("error",a)};this.isAvailable?(b("loading",a),Primrose.HTTP.get("arraybuffer",a,function(c){b("intermediate",a,c.loaded)},d,function(e){b("success",a),this.context.decodeAudioData(e,c,d)})):d()},a.prototype.loadBufferCascadeSrcList=function(a,b,c,d){if(d=d||0,d===a.length)b&&a.forEach(function(a){b("error",a)});else{var e=c,f=b;c=function(b){if(f)for(var c=d+1;c<a.length;++c)console.log("Skipping loading alternate file ["+a[c]+"]. ["+a[d]+"] has already loaded."),f("skip",a[c],"["+a[d]+"] has already loaded.");e&&e(b)},b=function(b,c,g){f&&f(b,c,g),"error"===b&&(console.warn("Failed to decode "+a[d]),setTimeout(this.loadBufferCascadeSrcList.bind(this,a,f,e,d+1),0))},this.loadBuffer(a[d],b,c)}},a.prototype.createRawSound=function(a,b){if(1!==a.length&&2!==a.length)throw new Error("Incorrect number of channels. Expected 1 or 2, got "+a.length);var c=a[0].length;if(a.length>1&&a[1].length!==c)throw new Error("Second channel is not the same length as the first channel. Expected "+c+", but was "+a[1].length);for(var d=this.context.createBuffer(a.length,c,this.sampleRate),e=0;e<a.length;++e)for(var f=d.getChannelData(e),g=0;c>g;++g)f[g]=a[e][g];b(d)},a.prototype.createSound=function(a,b,c){var d={volume:this.context.createGain(),source:this.context.createBufferSource()};d.source.buffer=c,d.source.loop=a,d.source.connect(d.volume),b(d)},a.prototype.create3DSound=function(a,b,c,d,e){e.panner=this.context.createPanner(),e.panner.setPosition(a,b,c),e.panner.connect(this.mainVolume),e.volume.connect(e.panner),d(e)},a.prototype.createFixedSound=function(a,b){b.volume.connect(this.mainVolume),a(b)},a.prototype.loadSound=function(a,b,c,d){this.loadBuffer(a,c,this.createSound.bind(this,b,d))},a.prototype.loadSoundCascadeSrcList=function(a,b,c,d){this.loadBufferCascadeSrcList(a,c,this.createSound.bind(this,b,d))},a.prototype.load3DSound=function(a,b,c,d,e,f,g){this.loadSound(a,b,f,this.create3DSound.bind(this,c,d,e,g))},a.prototype.load3DSoundCascadeSrcList=function(a,b,c,d,e,f,g){this.loadSoundCascadeSrcList()(a,b,f,this.create3DSound.bind(this,c,d,e,g))},a.prototype.loadFixedSound=function(a,b,c,d){this.loadSound(a,b,c,this.createFixedSound.bind(this,d))},a.prototype.loadFixedSoundCascadeSrcList=function(a,b,c,d){this.loadSoundCascadeSrcList(a,b,c,this.createFixedSound.bind(this,d))},a.prototype.playBufferImmediate=function(a,b){this.createSound(!1,this.createFixedSound.bind(this,function(a){a.volume.gain.value=b,a.source.addEventListener("ended",function(b){a.volume.disconnect(this.mainVolume)}.bind(this)),a.source.start(0)}),a)},a}(),pliny.issue("Primrose.Output.Audio3D",{name:"document Audio3D",type:"open",description:"Finish writing the documentation for the [Primrose.Output.Audio3D](#Primrose_Output_Audio3D) class in the output/ directory"}),Primrose.Output.HapticGlove=function(){function a(b){function c(a){if(a.valid){d=a.hands.length>0;for(var c=0;c<b.hands&&c<a.hands.length;++c)for(var e=a.hands[c],f=0;f<b.fingers;++f)for(var h=e.fingers[f],i=0;i<b.joints;++i){var j=c*b.fingers*b.joints+f*b.joints+i;if(j<this.tips.length){var k=h[g[i]],l=this.tips[j];l.position.set(k[0],k[1],k[2])}}}}b.port=b.port||a.DEFAULT_PORT,b.addr=b.addr||a.DEFAULT_HOST,this.tips=[],this.numJoints=b.hands*b.fingers*b.joints;var d=!1,e=!1;Leap.loop(),this.setEnvironment=function(a){b.world=a.world,b.scene=a.scene,b.camera=a.camera,Leap.loopController.on("frame",c.bind(this))};var f,g=["tipPosition","dipPosition","pipPosition","mcpPosition","carpPosition"],h=0;80!==b.port&&(b.addr+=":"+b.port),f=io.connect(b.addr,{reconnect:!0,"reconnection delay":1e3,"max reconnection attempts":5}),f.on("connect",function(){e=!0,console.log("Connected!")}),f.on("disconnect",function(){e=!1,console.log("Disconnected!")}),this.readContacts=function(a){for(var c=0,e=0;d&&2>c&&e<a.length;++e)for(var f=a[e],g=0;g<b.hands&&2>c;++g)for(var h=0;h<b.fingers;++h){var i=this.tips[h],j=!1;f.bi===i&&f.bj.graphics&&f.bj.graphics.isSolid&&(this.setFingerState(h,!0),j=!0,++c),j||this.setFingerState(h,!1)}},this.setFingerState=function(a,b){var c=1<<a;b?h|=c:h=h&~c&31,e&&f.emit("data",h)}}return pliny["class"]("Primrose.Output",{name:"HapticGlove",description:"<under construction>"}),a.DEFAULT_PORT=8383,a.DEFAULT_HOST=document.location.hostname,a}(),pliny.issue("Primrose.Output.HapticGlove",{name:"document HapticGlove",type:"open",description:"Finish writing the documentation for the [Primrose.Output.HapticGlove](#Primrose_Output_HapticGlove) class in the output/ directory"}),Primrose.Output.Music=function(){function a(a){return 440*Math.pow(c,a-49)}function b(a,b,c){if(this.audio=a||new AudioContext,this.audio&&this.audio.createGain){void 0===c&&(c=d),void 0===b&&(b="sawtooth"),this.available=!0,this.mainVolume=this.audio.createGain(),this.mainVolume.connect(this.audio.destination),this.numNotes=c,this.oscillators=[];for(var e=0;e<this.numNotes;++e){var f=this.audio.createOscillator(),g=this.audio.createGain();f.type=b,f.frequency.value=0,f.connect(g),f.start(),g.connect(this.mainVolume),this.oscillators.push({osc:f,gn:g,timeout:null})}}else this.available=!1,IS_IN_GRID=!0}Window.prototype.AudioContext=Window.prototype.AudioContext||Window.prototype.webkitAudioContext||function(){};var c=Math.pow(2,1/12),d=(navigator.maxTouchPoints||10)+1;return pliny["class"]("Primrose.Output",{name:"Music",description:"<under construction>"}),b.prototype.noteOn=function(b,c,d){if(this.available){void 0===d&&(d=0);var e=this.oscillators[d%this.numNotes],f=a(parseFloat(c)+1);return e.gn.gain.value=b,e.osc.frequency.setValueAtTime(f,0),e}},b.prototype.noteOff=function(a){if(this.available){void 0===a&&(a=0);var b=this.oscillators[a%this.numNotes];b.osc.frequency.setValueAtTime(0,0)}},b.prototype.play=function(a,b,c,d){if(this.available){"number"!=typeof d&&(d=0);var e=this.noteOn(b,a,d);e.timeout&&(clearTimeout(e.timeout),e.timeout=null),e.timeout=setTimeout(function(a,b){this.noteOff(a),b.timeout=null}.bind(this,d,e),1e3*c)}},b}(),pliny.issue("Primrose.Output.Music",{name:"document Music",type:"open",description:"Finish writing the documentation for the [Primrose.Output.Music](#Primrose_Output_Music) class in the output/ directory"}),Primrose.Output.Speech=function(){function a(a,b,c,d){return void 0===a[b]?a[b]=c+(d-c)*Math.random():a[b]=Math.min(d,Math.max(c,a[b])),a[b]}try{return pliny["class"]("Primrose.Output",{name:"Speech",description:"<under construction>"}),function(b){b=b||{};var c=speechSynthesis.getVoices().filter(function(a){return a["default"]||a.localService}.bind(this)),d=c[Math.floor(a(b,"voice",0,c.length))];this.speak=function(c,e){var f=new SpeechSynthesisUtterance;f.voice=d,f.volume=a(b,"volume",1,1),f.rate=a(b,"rate",.1,5),f.pitch=a(b,"pitch",0,2),f.text=c,f.onend=e,speechSynthesis.speak(f)}}}catch(b){return pliny["class"]("Primrose.Output",{name:"Speech",description:"<under construction>"}),function(){this.speak=function(){}}}}(),pliny.issue("Primrose.Output.Speech",{name:"document Speech",type:"open",description:"Finish writing the documentation for the [Primrose.Output.Speech](#Primrose_Output_Speech) class in the output/ directory"}),Primrose.Text.CodePage=function(){"use strict";function a(a,b,c){this.name=a,this.language=b,copyObject(this,{NORMAL:{65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"},SHIFT:{65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z"}}),copyObject(this,c);for(var d=0;9>=d;++d){var e=Primrose.Keys["NUMPAD"+d];this.NORMAL[e]=d.toString()}this.NORMAL[Primrose.Keys.MULTIPLY]="*",this.NORMAL[Primrose.Keys.ADD]="+",this.NORMAL[Primrose.Keys.SUBTRACT]="-",
this.NORMAL[Primrose.Keys.DECIMALPOINT]=".",this.NORMAL[Primrose.Keys.DIVIDE]="/"}return pliny["class"]("Primrose.Text",{name:"CodePage",description:"<under construction>"}),a.DEAD=function(a){return function(b){b.setDeadKeyState("DEAD"+a)}},a}(),pliny.issue("Primrose.Text.CodePage",{name:"document CodePage",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CodePage](#Primrose_Text_CodePage) class in the text/ directory"}),Primrose.Text.CommandPack=function(){"use strict";function a(a,b){this.name=a,copyObject(this,b)}return pliny["class"]("Primrose.Text",{name:"CommandPack",description:"<under construction>"}),a}(),pliny.issue("Primrose.Text.CommandPack",{name:"document CommandPack",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CommandPack](#Primrose_Text_CommandPack) class in the text/ directory"}),pliny.issue("Primrose.Text.CommandPack",{name:"Merge controls and command packs",type:"open",description:"The concept of an individual command pack doesn't make sense outside of the context of any particular control that uses it. The two are fundamentally linked, so they should be a part of the same class."}),Primrose.Text.Cursor=function(){"use strict";function a(a,b,c){this.i=a||0,this.x=b||0,this.y=c||0,this.moved=!0}var b=function(){function a(d){d=d.replace(b,function(b,c,d){return a(d)+c}).replace(c,"$2$1");for(var e="",f=d.length-1;f>=0;--f)e+=d[f];return e}var b=/(<%= allExceptCombiningMarks %>)(<%= combiningMarks %>+)/g,c=/(<%= highSurrogates %>)(<%= lowSurrogates %>)/g;return a}();return pliny["class"]("Primrose.Text",{name:"Cursor",description:"<under construction>"}),a.min=function(a,b){return a.i<=b.i?a:b},a.max=function(a,b){return a.i>b.i?a:b},a.prototype.toString=function(){return"[i:"+this.i+" x:"+this.x+" y:"+this.y+"]"},a.prototype.copy=function(a){this.i=a.i,this.x=a.x,this.y=a.y,this.moved=!1},a.prototype.fullhome=function(){this.i=0,this.x=0,this.y=0,this.moved=!0},a.prototype.fullend=function(a){this.i=0;for(var b=0,c=0;c<a.length;++c){var d=a[c];b=d.length,this.i+=b}this.y=a.length-1,this.x=b,this.moved=!0},a.prototype.skipleft=function(a){if(0===this.x)this.left(a);else{var c=this.x-1,d=a[this.y],e=b(d.substring(0,c)),f=e.match(/(\s|\W)+/),g=f?f.index+f[0].length+1:e.length;this.i-=g,this.x-=g}this.moved=!0},a.prototype.left=function(a){if(this.i>0){if(--this.i,--this.x,this.x<0){--this.y;var b=a[this.y];this.x=b.length}this.reverseFromNewline(a)&&++this.i}this.moved=!0},a.prototype.skipright=function(a){var b=a[this.y];if(this.x===b.length||"\n"===b[this.x])this.right(a);else{var c=this.x+1;b=b.substring(c);var d=b.match(/(\s|\W)+/),e=d?d.index+d[0].length+1:b.length-this.x;this.i+=e,this.x+=e,this.reverseFromNewline(a)}this.moved=!0},a.prototype.fixCursor=function(a){this.x=this.i,this.y=0;for(var b=0,c=a[this.y];this.x>c.length;){if(this.x-=c.length,b+=c.length,this.y>=a.length-1){this.i=b,this.x=c.length,this.moved=!0;break}++this.y,c=a[this.y]}return this.moved},a.prototype.right=function(a){this.advanceN(a,1)},a.prototype.advanceN=function(a,b){var c=a[this.y];(this.y<a.length-1||this.x<c.length)&&(this.i+=b,this.fixCursor(a),c=a[this.y],this.x>0&&"\n"===c[this.x-1]&&(++this.y,this.x=0)),this.moved=!0},a.prototype.home=function(){this.i-=this.x,this.x=0,this.moved=!0},a.prototype.end=function(a){var b=a[this.y],c=b.length-this.x;this.i+=c,this.x+=c,this.reverseFromNewline(a),this.moved=!0},a.prototype.up=function(a){if(this.y>0){--this.y;var b=a[this.y],c=Math.min(0,b.length-this.x);this.x+=c,this.i-=b.length-c,this.reverseFromNewline(a)}this.moved=!0},a.prototype.down=function(a){if(this.y<a.length-1){++this.y;var b=a[this.y],c=a[this.y-1],d=Math.min(0,b.length-this.x);this.x+=d,this.i+=c.length+d,this.reverseFromNewline(a)}this.moved=!0},a.prototype.incY=function(a,b){this.y=Math.max(0,Math.min(b.length-1,this.y+a));var c=b[this.y];this.x=Math.max(0,Math.min(c.length,this.x)),this.i=this.x;for(var d=0;d<this.y;++d)this.i+=b[d].length;this.reverseFromNewline(b),this.moved=!0},a.prototype.setXY=function(a,b,c){this.y=Math.max(0,Math.min(c.length-1,b));var d=c[this.y];this.x=Math.max(0,Math.min(d.length,a)),this.i=this.x;for(var e=0;e<this.y;++e)this.i+=c[e].length;this.reverseFromNewline(c),this.moved=!0},a.prototype.setI=function(a,b){this.i=a,this.fixCursor(b),this.moved=!0},a.prototype.reverseFromNewline=function(a){var b=a[this.y];return this.x>0&&"\n"===b[this.x-1]?(--this.x,--this.i,!0):!1},a}(),pliny.issue("Primrose.Text.Cursor",{name:"document Cursor",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Cursor](#Primrose_Text_Cursor) class in the text/ directory"}),Primrose.Text.Grammar=function(){"use strict";function a(a,b){function c(a){var b,c,d=null,e=null,f=0;for(b=0;b<a.length;++b)c=a[b],c.line=f,"newlines"===c.type&&++f,e?("stringDelim"!==c.type||c.value!==e||0!==b&&"\\"===a[b-1].value[a[b-1].value.length-1]||(e=null),"newlines"!==c.type&&(c.type="strings")):d?(("startBlockComments"===d&&"endBlockComments"===c.type||"startLineComments"===d&&"newlines"===c.type)&&(d=null),"newlines"!==c.type&&(c.type="comments")):"stringDelim"===c.type?(e=c.value,c.type="strings"):("startBlockComments"===c.type||"startLineComments"===c.type)&&(d=c.type,c.type="comments");for(b=a.length-1;b>0;--b){var g=a[b-1];c=a[b],g.type===c.type&&"newlines"!==g.type&&(g.value+=c.value,a.splice(b,1))}}pliny.property({name:" name",type:"String",description:"A user-friendly name for the grammar, to be able to include it in an options listing."}),this.name=a,pliny.property({name:"grammar",type:"Array",description:"A collection of rules to apply to tokenize text. The rules should be an array of two-element arrays. The first element should be a token name (see [`Primrose.Text.Rule`](#Primrose_Text_Rule) for a list of valid token names), followed by a regular expression that selects the token out of the source code."}),this.grammar=b.map(function(a){return new Primrose.Text.Rule(a[0],a[1])}),pliny.method({name:"tokenize",parameters:[{name:"text",type:"String",description:"The text to tokenize."}],returns:"An array of tokens, ammounting to drawing instructions to the renderer. However, they still need to be layed out to fit the bounds of the text area.",description:"Breaks plain text up into a list of tokens that can later be rendered with color.",examples:[{name:"Tokenize some JavaScript",description:'Primrose comes with a grammar for JavaScript built in.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var tokens = new Primrose.Text.Grammars.JavaScript\n\r\n      .tokenize("var x = 3;\\n\\\n\r\n    var y = 2;\\n\\\n\r\n    console.log(x + y);");\n\r\n    console.log(JSON.stringify(tokens));\n\r\n\n\r\n## Result:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    [ \n\r\n      { "value": "var", "type": "keywords", "index": 0, "line": 0 },\n\r\n      { "value": " x = ", "type": "regular", "index": 3, "line": 0 },\n\r\n      { "value": "3", "type": "numbers", "index": 8, "line": 0 },\n\r\n      { "value": ";", "type": "regular", "index": 9, "line": 0 },\n\r\n      { "value": "\\n", "type": "newlines", "index": 10, "line": 0 },\n\r\n      { "value": " y = ", "type": "regular", "index": 11, "line": 1 },\n\r\n      { "value": "2", "type": "numbers", "index": 16, "line": 1 },\n\r\n      { "value": ";", "type": "regular", "index": 17, "line": 1 },\n\r\n      { "value": "\\n", "type": "newlines", "index": 18, "line": 1 },\n\r\n      { "value": "console", "type": "members", "index": 19, "line": 2 },\n\r\n      { "value": ".", "type": "regular", "index": 26, "line": 2 },\n\r\n      { "value": "log", "type": "functions", "index": 27, "line": 2 },\n\r\n      { "value": "(x + y);", "type": "regular", "index": 30, "line": 2 }\n\r\n    ]'}]}),this.tokenize=function(a){for(var b=[new Primrose.Text.Token(a,"regular",0)],d=0;d<this.grammar.length;++d)for(var e=this.grammar[d],f=0;f<b.length;++f)e.carveOutMatchedToken(b,f);return c(b),b}}return pliny["class"]("Primrose.Text",{name:"Grammar",parameters:[{name:"name",type:"String",description:"A user-friendly name for the grammar, to be able to include it in an options listing."},{name:"rules",type:"Array",description:"A collection of rules to apply to tokenize text. The rules should be an array of two-element arrays. The first element should be a token name (see [`Primrose.Text.Rule`](#Primrose_Text_Rule) for a list of valid token names), followed by a regular expression that selects the token out of the source code."}],description:"A Grammar is a collection of rules for processing text into tokens. Tokens are special characters that tell us about the structure of the text, things like keywords, curly braces, numbers, etc. After the text is tokenized, the tokens get a rough processing pass that groups them into larger elements that can be rendered in color on the screen.\n\r\n\n\r\nAs tokens are discovered, they are removed from the text being processed, so order is important. Grammar rules are applied in the order they are specified, and more than one rule can produce the same token type.\n\r\n\n\r\nSee [`Primrose.Text.Rule`](#Primrose_Text_Rule) for a list of valid token names.",examples:[{name:'A plain-text "grammar".',description:'Plain text does not actually have a grammar that needs to be processed. However, to get the text to work with the rendering system, a basic grammar is necessary to be able to break the text up into lines and prepare it for rendering.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var plainTextGrammar = new Primrose.Text.Grammar(\n\r\n      // The name is for displaying in options views.\n\r\n      "Plain-text", [\n\r\n      // Text needs at least the newlines token, or else every line will attempt to render as a single line and the line count won\'t work.\n\r\n      ["newlines", /(?:\\r\\n|\\r|\\n)/] \n\r\n    ] );'},{name:"A grammar for BASIC",description:'The BASIC programming language is now defunct, but a grammar for it to display in Primrose is quite easy to build.\n\r\n\n\r\n## Code:\n\r\n\n\r\n    grammar("JavaScript");\n\r\n    var basicGrammar = new Primrose.Text.Grammar( "BASIC",\n\r\n      // Grammar rules are applied in the order they are specified.\n\r\n      [\n\r\n        // Text needs at least the newlines token, or else every line will attempt to render as a single line and the line count won\'t work.\n\r\n        [ "newlines", /(?:\\r\\n|\\r|\\n)/ ],\n\r\n        // BASIC programs used to require the programmer type in her own line numbers. The start at the beginning of the line.\n\r\n        [ "lineNumbers", /^\\d+\\s+/ ],\n\r\n        // Comments were lines that started with the keyword "REM" (for REMARK) and ran to the end of the line. They did not have to be numbered, because they were not executable and were stripped out by the interpreter.\n\r\n        [ "startLineComments", /^REM\\s/ ],\n\r\n        // Both double-quoted and single-quoted strings were not always supported, but in this case, I\'m just demonstrating how it would be done for both.\n\r\n        [ "strings", /"(?:\\\\"|[^"])*"/ ],\n\r\n        [ "strings", /\'(?:\\\\\'|[^\'])*\'/ ],\n\r\n        // Numbers are an optional dash, followed by a optional digits, followed by optional period, followed by 1 or more required digits. This allows us to match both integers and decimal numbers, both positive and negative, with or without leading zeroes for decimal numbers between (-1, 1).\n\r\n        [ "numbers", /-?(?:(?:\\b\\d*)?\\.)?\\b\\d+\\b/ ],\n\r\n        // Keywords are really just a list of different words we want to match, surrounded by the "word boundary" selector "\\b".\n\r\n        [ "keywords",\n\r\n          /\\b(?:RESTORE|REPEAT|RETURN|LOAD|LABEL|DATA|READ|THEN|ELSE|FOR|DIM|LET|IF|TO|STEP|NEXT|WHILE|WEND|UNTIL|GOTO|GOSUB|ON|TAB|AT|END|STOP|PRINT|INPUT|RND|INT|CLS|CLK|LEN)\\b/\n\r\n        ],\n\r\n        // Sometimes things we want to treat as keywords have different meanings in different locations. We can specify rules for tokens more than once.\n\r\n        [ "keywords", /^DEF FN/ ],\n\r\n        // These are all treated as mathematical operations.\n\r\n        [ "operators",\n\r\n          /(?:\\+|;|,|-|\\*\\*|\\*|\\/|>=|<=|=|<>|<|>|OR|AND|NOT|MOD|\\(|\\)|\\[|\\])/\n\r\n        ],\n\r\n        // Once everything else has been matched, the left over blocks of words are treated as variable and function names.\n\r\n        [ "identifiers", /\\w+\\$?/ ]\n\r\n      ] );'}]}),a}(),pliny.issue("Primrose.Text.Grammar",{name:"document Grammar",type:"closed",description:"Finish writing the documentation for the [Primrose.Text.Grammar](#Primrose_Text_Grammar) class in the text/ directory"}),Primrose.Text.OperatingSystem=function(){"use strict";function a(a,b,c,d,e){var f=b+"_"+c;a[f]=function(a,b){a["cursor"+d](b,a[e+"Cursor"])}}function b(b,c,d,e){a(b,c||"NORMAL",d,e,"front"),a(b,c+"SHIFT",d,e,"back")}function c(a,c,d,e,f,g,h,i,j,k){this.name=a,this[c+"_a"]=function(a,b){a.frontCursor.fullhome(b),a.backCursor.fullend(b)},this[e]=function(a,b){a.redo(),a.scrollIntoView(a.frontCursor)},this[c+"_z"]=function(a,b){a.undo(),a.scrollIntoView(a.frontCursor)},c+"_DOWNARROW"!=i+"_"+k&&(this[c+"_DOWNARROW"]=function(a,b){a.scroll.y<b.length&&++a.scroll.y}),c+"_UPARROW"!=i+"_"+j&&(this[c+"_UPARROW"]=function(a,b){a.scroll.y>0&&--a.scroll.y}),this.isClipboardReadingEvent=function(a){return a[c.toLowerCase()+"Key"]&&(67===a.keyCode||88===a.keyCode)},b(this,"","LEFTARROW","Left"),b(this,"","RIGHTARROW","Right"),b(this,"","UPARROW","Up"),b(this,"","DOWNARROW","Down"),b(this,"","PAGEUP","PageUp"),b(this,"","PAGEDOWN","PageDown"),b(this,d,"LEFTARROW","SkipLeft"),b(this,d,"RIGHTARROW","SkipRight"),b(this,f,g,"Home"),b(this,f,h,"End"),b(this,i,j,"FullHome"),b(this,i,k,"FullEnd")}return pliny["class"]("Primrose.Text",{name:"OperatingSystem",description:"<under construction>"}),c}(),pliny.issue("Primrose.Text.OperatingSystem",{name:"document OperatingSystem",type:"open",description:"Finish writing the documentation for the [Primrose.Text.OperatingSystem](#Primrose_Text_OperatingSystem) class in the text/ directory"}),Primrose.Text.Point=function(){"use strict";function a(a,b){this.set(a||0,b||0)}return pliny["class"]("Primrose.Text",{name:"Point",description:"<under construction>"}),a.prototype.set=function(a,b){this.x=a,this.y=b},a.prototype.copy=function(a){a&&(this.x=a.x,this.y=a.y)},a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.toString=function(){return"(x:"+this.x+", y:"+this.y+")"},a}(),pliny.issue("Primrose.Text.Point",{name:"document Point",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Point](#Primrose_Text_Point) class in the text/ directory"}),Primrose.Text.Rectangle=function(){"use strict";function a(a,b,c,d){this.point=new Primrose.Text.Point(a,b),this.size=new Primrose.Text.Size(c,d),Object.defineProperties(this,{x:{get:function(){return this.point.x},set:function(a){this.point.x=a}},left:{get:function(){return this.point.x},set:function(a){this.point.x=a}},width:{get:function(){return this.size.width},set:function(a){this.size.width=a}},right:{get:function(){return this.point.x+this.size.width},set:function(a){this.point.x=a-this.size.width}},y:{get:function(){return this.point.y},set:function(a){this.point.y=a}},top:{get:function(){return this.point.y},set:function(a){this.point.y=a}},height:{get:function(){return this.size.height},set:function(a){this.size.height=a}},bottom:{get:function(){return this.point.y+this.size.height},set:function(a){this.point.y=a-this.size.height}}})}return pliny["class"]("Primrose.Text",{name:"Rectangle",description:"<under construction>"}),a.prototype.set=function(a,b,c,d){this.point.set(a,b),this.size.set(c,d)},a.prototype.copy=function(a){a&&(this.point.copy(a.point),this.size.copy(a.size))},a.prototype.clone=function(){return new a(this.point.x,this.point.y,this.size.width,this.size.height)},a.prototype.toString=function(){return"["+this.point.toString()+" x "+this.size.toString()+"]"},a}(),pliny.issue("Primrose.Text.Rectangle",{name:"document Rectangle",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Rectangle](#Primrose_Text_Rectangle) class in the text/ directory"}),Primrose.Text.Rule=function(){"use strict";function a(a,b){this.name=a,this.test=b}return pliny["class"]("Primrose.Text",{name:"Rule",description:"<under construction>"}),a.prototype.carveOutMatchedToken=function(a,b){var c=a[b];if("regular"===c.type){var d=this.test.exec(c.value);if(d){var e=d[d.length-1],f=d.input.indexOf(e),g=f+e.length;if(0===f){if(c.type=this.name,g<c.value.length){var h=c.splitAt(g);h.type="regular",a.splice(b+1,0,h)}}else{var i=c.splitAt(f);if(e.length<i.value.length){var j=i.splitAt(e.length);a.splice(b+1,0,j)}i.type=this.name,a.splice(b+1,0,i)}}}},a}(),pliny.issue("Primrose.Text.Rule",{name:"document Rule",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Rule](#Primrose_Text_Rule) class in the text/ directory"}),Primrose.Text.Size=function(){"use strict";function a(a,b){this.set(a||0,b||0)}return pliny["class"]("Primrose.Text",{name:"Size",description:"<under construction>"}),a.prototype.set=function(a,b){this.width=a,this.height=b},a.prototype.copy=function(a){a&&(this.width=a.width,this.height=a.height)},a.prototype.clone=function(){return new a(this.width,this.height)},a.prototype.toString=function(){return"<w:"+this.width+", h:"+this.height+">"},a}(),pliny.issue("Primrose.Text.Size",{name:"document Size",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Size](#Primrose_Text_Size) class in the text/ directory"}),pliny["class"]("Primrose.Text",{name:"Terminal",description:"<under construction>"}),Primrose.Text.Terminal=function(a,b){"use strict";function c(a){a.selectionStart=a.selectionEnd=a.value.length,a.scrollIntoView(a.frontCursor)}function d(){q.running&&(f(),q.running=!1,p&&(a.tokenizer=k,a.value=j),c(a))}function e(){return b.selectionStart=b.selectionEnd=0,b.value="",!0}function f(){if(o.length>0){for(var a=o.split("\n"),b=0;m>b&&a.length>0;++b)n.push(a.shift());a.length>0&&n.push(" ----- more -----"),o=a.join("\n")}}function g(a){i=a,q.waitingForInput=!0,f()}function h(a){o+=a}b=b||a;var i=null,j=null,k=null,l=0,m=40,n=[],o="",p=a===b,q=this;this.running=!1,this.waitingForInput=!1,this.sendInput=function(a){if(o.length>0)f();else{b.keyDown(a);var c=b.value.substring(l);i(c.trim()),i=null,this.waitingForInput=!1}},this.execute=function(c){if(m=c?10:40,k=a.tokenizer,k&&k.interpret){this.running=!0;var f,i=function(){q.running&&setTimeout(f,1)};j=a.value,f=k.interpret(j,g,h,h,i,e,this.loadFile.bind(this),d),b.tokenizer=Primrose.Text.Grammars.PlainText,e(),i()}},this.loadFile=function(b,c){Primrose.HTTP.get("text",b.toLowerCase(),function(b){isOSX&&(b=b.replace("CTRL+SHIFT+SPACE","CMD+OPT+E")),a.value=j=b,c&&c()})},this.update=function(){n.length>0&&(b.value+=n.shift()+"\n",c(b),l=b.selectionStart)}},pliny.issue("Primrose.Text.Terminal",{name:"document Terminal",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Terminal](#Primrose_Text_Terminal) class in the text/ directory"}),pliny.issue("Primrose.Text.Terminal",{name:"Move Terminal to Controls namespace",type:"open",description:"Terminal should be a type of control, like TextArea and Button."}),Primrose.Text.Token=function(){"use strict";function a(a,b,c,d){this.value=a,this.type=b,this.index=c,this.line=d}return pliny["class"]("Primrose.Text",{name:"Token",description:"<under construction>"}),a.prototype.clone=function(){return new a(this.value,this.type,this.index,this.line)},a.prototype.splitAt=function(b){var c=this.value.substring(b);return this.value=this.value.substring(0,b),new a(c,this.type,this.index+b,this.line)},a.prototype.toString=function(){return"["+this.type+": "+this.value+"]"},a}(),pliny.issue("Primrose.Text.Token",{name:"document Token",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Token](#Primrose_Text_Token) class in the text/ directory"}),Primrose.Text.CodePages.DE_QWERTZ=function(){"use strict";var a=Primrose.Text.CodePage;return pliny.record("Primrose.Text.CodePages",{name:"DE_QWERTZ",description:"<under construction>"}),new a("Deutsch: QWERTZ","de",{deadKeys:[220,221,160,192],NORMAL:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",60:"<",63:"",160:a.DEAD(3),163:"#",171:"+",173:"-",186:"",187:"+",188:",",189:"-",190:".",191:"#",192:a.DEAD(4),219:"",220:a.DEAD(1),221:a.DEAD(2),222:"",226:"<"},DEAD1NORMAL:{65:"",69:"",73:"",79:"",85:"",190:"."},DEAD2NORMAL:{65:"",69:"",73:"",79:"",83:"s",85:"",89:""},SHIFT:{48:"=",49:"!",50:'"',51:"",52:"$",53:"%",54:"&",55:"/",56:"(",57:")",60:">",63:"?",163:"'",171:"*",173:"_",186:"",187:"*",188:";",189:"_",190:":",191:"'",192:"",219:"?",222:"",226:">"},CTRLALT:{48:"}",50:"",51:"",55:"{",56:"[",57:"]",60:"|",63:"\\",69:"",77:"",81:"@",171:"~",187:"~",219:"\\",226:"|"},CTRLALTSHIFT:{63:"",219:""},DEAD3NORMAL:{65:"a",69:"e",73:"i",79:"o",85:"u",190:"."},DEAD4NORMAL:{65:"a",69:"e",73:"i",79:"o",83:"s",85:"u",89:"y"}})}(),pliny.issue("Primrose.Text.CodePages.DE_QWERTZ",{name:"document DE_QWERTZ",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CodePages.DE_QWERTZ](#Primrose_Text_CodePages_DE_QWERTZ) class in the code_pages/ directory"}),Primrose.Text.CodePages.EN_UKX=function(){"use strict";var a=Primrose.Text.CodePage;return pliny.record("Primrose.Text.CodePages",{name:"EN_UKX",description:"<under construction>"}),new a("English: UK Extended","en-GB",{CTRLALT:{52:"",65:"",69:"",73:"",79:"",85:"",163:"\\",192:"",222:"\\",223:""},CTRLALTSHIFT:{65:"",69:"",73:"",79:"",85:"",222:"|"},NORMAL:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",163:"#",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"'",219:"[",220:"\\",221:"]",222:"#",223:"`"},SHIFT:{48:")",49:"!",50:'"',51:"",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",163:"~",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"@",219:"{",220:"|",221:"}",222:"~",223:""}})}(),pliny.issue("Primrose.Text.CodePages.EN_UKX",{name:"document EN_UKX",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CodePages.EN_UKX](#Primrose_Text_CodePages_EN_UKX) class in the code_pages/ directory"}),Primrose.Text.CodePages.EN_US=function(){"use strict";var a=Primrose.Text.CodePage;return pliny.record("Primrose.Text.CodePages",{name:"EN_US",description:"<under construction>"}),new a("English: USA","en-US",{NORMAL:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},SHIFT:{48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",219:"{",220:"|",221:"}",222:'"'}})}(),pliny.issue("Primrose.Text.CodePages.EN_US",{name:"document EN_US",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CodePages.EN_US](#Primrose_Text_CodePages_EN_US) class in the code_pages/ directory"}),Primrose.Text.CodePages.FR_AZERTY=function(){"use strict";var a=Primrose.Text.CodePage;return pliny.record("Primrose.Text.CodePages",{name:"FR_AZERTY",description:"<under construction>"}),new a("Franais: AZERTY","fr",{deadKeys:[221,50,55],NORMAL:{48:"",49:"&",50:"",51:'"',52:"'",53:"(",54:"-",55:"",56:"_",57:"",186:"$",187:"=",188:",",190:";",191:":",192:"",219:")",220:"*",221:a.DEAD(1),222:"",223:"!",226:"<"},SHIFT:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",186:"",187:"+",188:"?",190:".",191:"/",192:"%",219:"",220:"",223:"",226:">"},CTRLALT:{48:"@",50:a.DEAD(2),51:"#",52:"{",53:"[",54:"|",55:a.DEAD(3),56:"\\",57:"^",69:"",186:"",187:"}",219:"]"},DEAD1NORMAL:{65:"",69:"",73:"",79:"",85:""},DEAD2NORMAL:{65:"",78:"",79:""},DEAD3NORMAL:{48:"",50:"",55:"",65:"",69:"",73:"",79:"",85:""}})}(),pliny.issue("Primrose.Text.CodePages.FR_AZERTY",{name:"document FR_AZERTY",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CodePages.FR_AZERTY](#Primrose_Text_CodePages_FR_AZERTY) class in the code_pages/ directory"}),Primrose.Text.CommandPacks.TestViewer=function(){"use strict";return pliny.record("Primrose.Text.CommandPacks",{name:"TestViewer",description:"<under construction>"}),{name:"Basic commands",NORMAL_SPACE:" ",SHIFT_SPACE:" ",NORMAL_BACKSPACE:function(a,b){a.frontCursor.i===a.backCursor.i&&a.frontCursor.left(b),a.selectedText="",a.scrollIntoView(a.frontCursor)},NORMAL_ENTER:function(a,b,c){var d="",e=b[a.frontCursor.y];e.length>0&&"whitespace"===e[0].type&&(d=e[0].value),a.selectedText="\n"+d,a.scrollIntoView(a.frontCursor)},NORMAL_DELETE:function(a,b){a.frontCursor.i===a.backCursor.i&&a.backCursor.right(b),a.selectedText="",a.scrollIntoView(a.frontCursor)},SHIFT_DELETE:function(a,b){a.frontCursor.i===a.backCursor.i&&(a.frontCursor.home(b),a.backCursor.end(b)),a.selectedText="",a.scrollIntoView(a.frontCursor)},NORMAL_TAB:function(a,b){a.selectedText=a.getTabString()}}}(),pliny.issue("Primrose.Text.CommandPacks.TestViewer",{name:"document TestViewer",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CommandPacks.TestViewer](#Primrose_Text_CommandPacks_TestViewer) class in the command_packs/ directory"}),Primrose.Text.CommandPacks.TextEditor=function(){"use strict";function a(a,b,c){function d(a,b){a.selectedText=b}var e={NORMAL_SPACE:" ",SHIFT_SPACE:" ",NORMAL_BACKSPACE:function(a,b){a.frontCursor.i===a.backCursor.i&&a.frontCursor.left(b),a.selectedText="",a.scrollIntoView(a.frontCursor)},NORMAL_ENTER:function(a,b,c){var d="",e=b[a.frontCursor.y];e.length>0&&"whitespace"===e[0].type&&(d=e[0].value),a.selectedText="\n"+d,a.scrollIntoView(a.frontCursor)},NORMAL_DELETE:function(a,b){a.frontCursor.i===a.backCursor.i&&a.backCursor.right(b),a.selectedText="",a.scrollIntoView(a.frontCursor)},SHIFT_DELETE:function(a,b){a.frontCursor.i===a.backCursor.i&&(a.frontCursor.home(b),a.backCursor.end(b)),a.selectedText="",a.scrollIntoView(a.frontCursor)},NORMAL_TAB:function(a,b){a.getTabString();a.selectedText=a.getTabString()}},f={};copyObject(f,b),copyObject(f,a),copyObject(f,e);for(var g in f)if(f.hasOwnProperty(g)){var h=f[g];"function"!=typeof h&&(h=d.bind(null,c,h)),f[g]=h}Primrose.Text.CommandPack.call(this,"Text editor commands",f)}return pliny.record("Primrose.Text.CommandPacks",{name:"TextEditor",description:"<under construction>"}),inherit(a,Primrose.Text.CommandPack),a}(),pliny.issue("Primrose.Text.CommandPacks.TextEditor",{name:"document TextEditor",type:"open",description:"Finish writing the documentation for the [Primrose.Text.CommandPacks.TextEditor](#Primrose_Text_CommandPacks_TextEditor) class in the command_packs/ directory"}),Primrose.Text.Controls.PlainText=function(){function a(a,b,c,d,e,f,g,h){a=a.replace(/\r\n/g,"\n");var i=a.split("\n");h=h||"center";var j=1e3*b,k=j*i.length,l=document.createElement("canvas"),m=l.getContext("2d");m.font=j+"px Arial";var n=m.measureText(a).width;l.width=n,l.height=k,m.font=.8*j+"px Arial","transparent"!==d&&(m.fillStyle=d,m.fillRect(0,0,l.width,l.height)),m.fillStyle=c,m.textBaseline="top";for(var o=0;o<i.length;++o)m.fillText(i[o],0,o*j);var p=new THREE.Texture(l);p.needsUpdate=!0;var q=new THREE.MeshBasicMaterial({map:p,transparent:"transparent"===d,useScreenCoordinates:!1,color:16777215,shading:THREE.FlatShading}),r=new THREE.PlaneGeometry(b*n/j,b*i.length);r.computeBoundingBox(),r.computeVertexNormals();var s=new THREE.Mesh(r,q);return"left"===h?e-=r.boundingBox.min.x:"right"===h&&(e+=r.boundingBox.min.x),s.position.set(e,f,g),s}return pliny["class"]("Primrose.Text.Controls",{name:"PlainText",description:"<under construction>"}),a}(),pliny.issue("Primrose.Text.Controls.PlainText",{name:"document PlainText",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Controls.PlainText](#Primrose_Text_Controls_PlainText) class in the controls/ directory"}),pliny.issue("Primrose.Text.Controls.PlainText",{name:"rename PlainText",type:"open",description:"The purpose of this control is to be an easier-to-use, simpler text area that doesn't support syntax highlighting or complex layout flows. It will probably be used most often in the single-line form."}),Primrose.Text.Controls.TextBox=function(){"use strict";function a(a,c){function d(){G=F.tokenize(y.value),y.update()}function e(){if(y.scroll.y<0)y.scroll.y=0;else for(;0<y.scroll.y&&y.scroll.y>J.length-V.height;)--y.scroll.y}function f(a,b,c){P.set(b,c),da.pixel2cell(P,y.scroll,V);var d=P.x-y.scroll.x,e=P.y-y.scroll.y,f=e>=V.height,g=0>d,h=P.x>=V.width;if(Z||f||g||h){if(Z||h&&!f){Z=!0;var i=J.length-V.height;if(e>=0&&i>=0){var j=e*i/V.height;y.scroll.y=Math.floor(j)}}else if(f&&!g){for(var k=0,l=0;l<J.length;++l)k=Math.max(k,J[l].length);var m=k-V.width;if(d>=0&&m>=0){var n=d*m/V.width;y.scroll.x=Math.floor(n)}}}else a.setXY(P.x,P.y,J),y.backCursor.copy(a);Q.copy(P)}function g(){var a=y.frontCursor.fixCursor(J)||y.backCursor.fixCursor(J);a&&y.render()}function h(a,b){if(c.pointerEventSource){y.focus();var d=c.pointerEventSource.getBoundingClientRect();y.startPointer(a-d.left,b-d.top)}}function i(a,b){if(c.pointerEventSource){var d=c.pointerEventSource.getBoundingClientRect();y.movePointer(a-d.left,b-d.top)}}function j(a){0===a.button&&(h(a.clientX,a.clientY),a.preventDefault())}function k(a){y.focused&&i(a.clientX,a.clientY)}function l(a){y.focused&&0===a.button&&y.endPointer()}function m(a){if(y.focused&&a.touches.length>0&&!Y){var b=a.touches[0];h(b.clientX,b.clientY),N=b.identifier}}function n(a){for(var b=0;b<a.changedTouches.length&&Y;++b){var c=a.changedTouches[b];if(c.identifier===N){i(c.clientX,c.clientY);break}}}function o(a){for(var b=0;b<a.changedTouches.length&&Y;++b){var c=a.changedTouches[b];c.identifier===N&&y.endPointer()}}function p(){D&&A&&C&&(E=new C(A,D,y))}function q(a){var b=a.toLowerCase();y["cursor"+a]=function(a,c){c[b](a),y.scrollIntoView(c)}}function r(){$?W.width=1:W.width=0,_?aa?X.set(da.VSCROLL_WIDTH,0):X.set(da.VSCROLL_WIDTH,1):X.set(0,0)}function s(){var a=0;$&&(a=Math.max(1,Math.ceil(Math.log(T[U].length)/Math.LN10)));var b=Math.floor(W.width+a+ca/da.character.width),c=Math.floor(ca/da.character.height),d=Math.floor((y.width-2*ca)/da.character.width)-b-X.width,e=Math.floor((y.height-2*ca)/da.character.height)-c-X.height;V.set(b,c,d,e),V.lineCountWidth=a}function t(){H=[[]],I=[""],J=[""];for(var a=0,b=G.slice(),c=0;c<b.length;++c){var d=b[c].clone(),e=V.width-a,f=aa&&"newlines"!==d.type&&d.value.length>e,g="newlines"===d.type||f;if(f){var h=d.value.length>V.width?e:0;b.splice(c+1,0,d.splitAt(h))}d.value.length>0&&(H[H.length-1].push(d),I[I.length-1]+=JSON.stringify(d),J[J.length-1]+=d.value,a+=d.value.length),g&&(H.push([]),I.push(""),J.push(""),a=0)}}function u(a){a.returnValue=!1}function v(a,b,c){var d=a-b,e=a-c+5,f=0;return(0>d||e>=0)&&(f=Math.abs(d)<Math.abs(e)?d:e),f}function w(a,b,c,d){var e=document.createElement("span"),f=document.createElement("input");f.type="checkbox",f.checked=b,f.id=a,e.appendChild(f);var g=document.createElement("label");return g.innerHTML=c+" ",g["for"]=a,e.appendChild(g),f.addEventListener("change",function(){y[d](f.checked)}),e}function x(a,b,c,d,e,f,g){var h=Primrose.DOM.cascadeElement(a,"select",window.HTMLSelectElement),i=[];for(var j in b)if(b.hasOwnProperty(j)){var k=b[j];if(!g||k instanceof g){k=k.name||j;var l=document.createElement("option");l.innerHTML=k,i.push(b[j]),k===c&&(l.selected="selected"),h.appendChild(l)}}"function"==typeof d[e]?h.addEventListener("change",function(){d[e](i[h.selectedIndex])}):h.addEventListener("change",function(){d[e]=i[h.selectedIndex]});var m=Primrose.DOM.cascadeElement("container -"+a,"div",window.HTMLDivElement),n=Primrose.DOM.cascadeElement("label-"+a,"span",window.HTMLSpanElement);

return n.innerHTML=f+": ",n["for"]=h,h.title=f,h.alt=f,m.appendChild(n),m.appendChild(h),m}var y=this;c=c||{},"string"==typeof c&&(c={file:c}),Primrose.BaseControl.call(this);var z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=c.renderer||Primrose.Text.Renderers.Canvas,P=new Primrose.Text.Point,Q=new Primrose.Text.Point,R="",S=[],T=[],U=-1,V=new Primrose.Text.Rectangle,W=new Primrose.Text.Size,X=new Primrose.Text.Size,Y=!1,Z=!1,$=!0,_=!0,aa=!1,ba=4,ca=1,da=new O(a,c),ea=null,fa=null;this.frontCursor=new Primrose.Text.Cursor,this.backCursor=new Primrose.Text.Cursor,this.scroll=new Primrose.Text.Point,["Left","Right","SkipLeft","SkipRight","Up","Down","Home","End","FullHome","FullEnd"].map(q.bind(this)),this.addEventListener=function(a,b){"keydown"===a?c.keyEventSource.addEventListener(a,b):Primrose.BaseControl.prototype.addEventListener.call(this,a,b)},this.cursorPageUp=function(a,b){b.incY(-V.height,a),this.scrollIntoView(b)},this.cursorPageDown=function(a,b){b.incY(V.height,a),this.scrollIntoView(b)},this.setDeadKeyState=function(a){R=a||""},this.setSize=function(a,b){da.setSize(a,b)},Object.defineProperties(this,{value:{get:function(){return T[U].join("\n")},set:function(a){a=a||"",a=a.replace(/\r\n/g,"\n");var b=a.split("\n");this.pushUndo(b),this.update()}},width:{get:function(){return da.width}},height:{get:function(){return da.height}},padding:{get:function(){return ca},set:function(a){ca=a,s(),y.render()}},wordWrap:{set:function(a){aa=a||!1,r()},get:function(){return aa}},showLineNumbers:{set:function(a){$=a,r()},get:function(){return $}},showScrollBars:{set:function(a){_=a,r()},get:function(){return _}},theme:{set:function(a){K=a||Primrose.Text.Themes.Default,da.theme=K,this.update()},get:function(){return K}},operatingSystem:{set:function(a){A=a||(isOSX?Primrose.Text.OperatingSystems.OSX:Primrose.Text.OperatingSystems.Windows),p()},get:function(){return A}},commandSystem:{set:function(a){C=a||Primrose.Text.CommandPacks.TextEditor,p()}},renderer:{get:function(){return da}},DOMElement:{get:function(){return da.DOMElement}},selectionStart:{get:function(){return this.frontCursor.i},set:function(a){this.frontCursor.setI(a,J)}},selectionEnd:{get:function(){return this.backCursor.i},set:function(a){this.backCursor.setI(a,J)}},selectionDirection:{get:function(){return this.frontCursor.i<=this.backCursor.i?"forward":"backward"}},tokenizer:{get:function(){return F},set:function(a){F=a||Primrose.Text.Grammars.JavaScript,T&&T.length>0&&(d(),this.update())}},codePage:{get:function(){return z},set:function(a){var b,c,d,e;if(z=a,!z){var f=navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage||navigator.browserLanguage;f&&"en"!==f||(f="en-US");for(b in Primrose.Text.CodePages)if(a=Primrose.Text.CodePages[b],a.language===f){z=a;break}z||(z=Primrose.Text.CodePages.EN_US)}S=[];for(b in Primrose.Keys)c=Primrose.Keys[b],isNaN(c)||(S[c]=b);D={};for(var g in z){var h=z[g];if("object"==typeof h)for(c in h){if(c.indexOf("_")>-1){var i=c.split(" "),j=i[0];c=i[1],d=z.NORMAL[c],e=j+"_"+g+" "+d}else d=z.NORMAL[c],e=g+"_"+d;S[c]=d,D[e]=h[c]}}p()}},tabWidth:{set:function(a){L=a||4,M="";for(var b=0;L>b;++b)M+=" "},get:function(){return L}},fontSize:{get:function(){return K.fontSize},set:function(a){a>0&&(K.fontSize=a,da.resize(),this.render())}},selectedText:{set:function(a){if(a=a||"",a=a.replace(/\r\n/g,"\n"),this.frontCursor.i!==this.backCursor.i||a.length>0){var b=Primrose.Text.Cursor.min(this.frontCursor,this.backCursor),c=Primrose.Text.Cursor.max(this.frontCursor,this.backCursor),f=this.value,g=f.substring(0,b.i),h=f.substring(c.i);this.value=g+a+h,d(),s(),t(),b.advanceN(J,Math.max(0,a.length)),this.scrollIntoView(c),e(),c.copy(b),this.render()}}},position:{get:function(){return this.mesh.position}},quaternion:{get:function(){return this.mesh.quaternion}}}),this.copyElement=function(a){Primrose.BaseControl.prototype.copyElement.call(this,a),this.value=a.value||a.innerHTML},this.pushUndo=function(a){U<T.length-1&&T.splice(U+1),T.push(a),U=T.length-1,d()},this.redo=function(){U<T.length-1&&++U,d(),g()},this.undo=function(){U>0&&--U,d(),g()},this.getTabString=function(){return M},this.scrollIntoView=function(a){this.scroll.y+=v(a.y,this.scroll.y,this.scroll.y+V.height),aa||(this.scroll.x+=v(a.x,this.scroll.x,this.scroll.x+V.width)),e()},this.readWheel=function(a){this.focused&&((a.shiftKey||isChrome)&&(this.fontSize+=a.deltaX/b),(!a.shiftKey||isChrome)&&(this.scroll.y+=Math.floor(a.deltaY*ba/b)),e(),a.preventDefault())},this.startPointer=function(a,b){f(this.frontCursor,a,b),Y=!0,this.update()},this.startUV=function(a){if(a){var b=da.mapUV(a);this.startPointer(b.x,b.y)}},this.movePointer=function(a,b){Y&&(f(this.backCursor,a,b),this.update())},this.moveUV=function(a){if(a){var b=da.mapUV(a);this.movePointer(b.x,b.y)}},this.endPointer=function(){Y=!1,Z=!1},this.bindEvents=function(a,b,c,d){b&&(c||b.addEventListener("wheel",this.readWheel.bind(this),!1),b.addEventListener("mousedown",j,!1),b.addEventListener("mousemove",k,!1),b.addEventListener("mouseup",l,!1),b.addEventListener("touchstart",m,!1),b.addEventListener("touchmove",n,!1),b.addEventListener("touchend",o,!1)),c&&c.addEventListener("wheel",this.readWheel.bind(this),!1),a&&(a instanceof HTMLCanvasElement&&!a.tabindex&&(a.tabindex=0),d&&(ea=Primrose.DOM.cascadeElement("primrose-surrogate-textarea-"+da.id,"textarea",window.HTMLTextAreaElement),fa=Primrose.DOM.makeHidingContainer("primrose-surrogate-textarea-container-"+da.id,ea),fa.style.position="absolute",fa.style.overflow="hidden",fa.style.width=0,fa.style.height=0,document.body.insertBefore(fa,document.body.children[0]),a.addEventListener("beforepaste",u,!1),a.addEventListener("paste",this.readClipboard.bind(this),!1),a.addEventListener("keydown",function(a){y.focused&&A.isClipboardReadingEvent(a)&&(ea.style.display="block",ea.focus())},!0),ea.addEventListener("beforecopy",u,!1),ea.addEventListener("copy",this.copySelectedText.bind(this),!1),ea.addEventListener("beforecut",u,!1),ea.addEventListener("cut",this.cutSelectedText.bind(this),!1)),a.addEventListener("keydown",this.keyDown.bind(this),!1))},this.getSelectedText=function(){var a=Primrose.Text.Cursor.min(this.frontCursor,this.backCursor),b=Primrose.Text.Cursor.max(this.frontCursor,this.backCursor);return this.value.substring(a.i,b.i)},this.copySelectedText=function(a){if(this.focused){if(a.returnValue=!1,this.frontCursor.i!==this.backCursor.i){var b=a.clipboardData||window.clipboardData;b.setData(window.clipboardData?"Text":"text/plain",this.getSelectedText())}a.preventDefault(),ea.style.display="none",c.keyEventSource.focus()}},this.cutSelectedText=function(a){this.focused&&(this.copySelectedText(a),this.readOnly||(this.selectedText="",this.update()))},this.readClipboard=function(a){if(this.focused&&!this.readOnly){a.returnValue=!1;var b=a.clipboardData||window.clipboardData,c=b.getData(window.clipboardData?"Text":"text/plain");c&&(this.selectedText=c)}},this.keyDown=function(a){if(this.focused){a=a||event;var b=a.keyCode;if(b!==Primrose.Keys.CTRL&&b!==Primrose.Keys.ALT&&b!==Primrose.Keys.META_L&&b!==Primrose.Keys.META_R&&b!==Primrose.Keys.SHIFT&&(!this.readOnly||b===Primrose.Keys.UPARROW||b===Primrose.Keys.DOWNARROW||b===Primrose.Keys.LEFTARROW||b===Primrose.Keys.RIGHTARROW||b===Primrose.Keys.PAGEUP||b===Primrose.Keys.PAGEDOWN||b===Primrose.Keys.END||b===Primrose.Keys.HOME)){var c=R,d=R;a.ctrlKey&&(d+="CTRL"),a.altKey&&(d+="ALT"),a.metaKey&&(d+="META"),a.shiftKey&&(d+="SHIFT"),d===R&&(d+="NORMAL"),d+="_"+S[b];var f=E[B+"_"+d]||E[d];f&&(this.frontCursor.moved=!1,this.backCursor.moved=!1,f(y,J),this.frontCursor.moved&&!this.backCursor.moved&&this.backCursor.copy(this.frontCursor),e(),a.preventDefault()),R===c&&(R="")}this.update()}},this.update=function(){da.resized&&da.resize()};var ga,ha,ia,ja,ka,la,ma;this.render=function(){if(G){s();var a=V.toString()!==la,b=ga!==this.value,c=da.character.width!==ha,d=da.character.height!==ia,e=ca!==ma,f=a||b||c||d||da.resized||e;la=V.toString(),ga=this.value,ha=da.character.width,ia=da.character.height,ja=this.width,ka=this.height,ma=ca,f&&t(V),da.render(H,I,this.frontCursor,this.backCursor,V,this.scroll,this.focused,$,_,aa,V.lineCountWidth,ca,f)}},this.appendControls=function(a){a.appendChild(this.lineNumberToggler),a.appendChild(this.wordWrapToggler),a.appendChild(this.scrollBarToggler),a.appendChild(this.operatingSystemSelect),a.appendChild(this.keyboardSelect),a.appendChild(this.commandSystemSelect),a.appendChild(this.tokenizerSelect),a.appendChild(this.themeSelect)},B=isChrome?"CHROMIUM":isFirefox?"FIREFOX":isIE?"IE":isOpera?"OPERA":isSafari?"SAFARI":"UNKNOWN",this.readOnly=!!c.readOnly,(c.autoBindEvents||da.autoBindEvents)&&(c.readOnly||void 0!==c.keyEventSource||(c.keyEventSource=this.DOMElement),void 0===c.pointerEventSource&&(c.pointerEventSource=this.DOMElement),void 0===c.wheelEventSource&&(c.wheelEventSource=this.DOMElement)),this.wordWrap=!c.disableWordWrap,this.showLineNumbers=!c.hideLineNumbers,this.showScrollBars=!c.hideScrollBars,this.tabWidth=c.tabWidth,this.theme=c.theme,this.fontSize=c.fontSize||16*devicePixelRatio,this.tokenizer=c.tokenizer,this.codePage=c.codePage,this.operatingSystem=c.os,this.commandSystem=c.commands,this.value=c.file,this.padding=c.padding||1,this.bindEvents(c.keyEventSource,c.pointerEventSource,c.wheelEventSource,!c.disableClipboard),this.lineNumberToggler=w("primrose-line-number-toggler-"+da.id,!c.hideLineNumbers,"Line numbers","showLineNumbers"),this.wordWrapToggler=w("primrose-word-wrap-toggler-"+da.id,!c.disableWordWrap,"Line wrap","wordWrap"),this.scrollBarToggler=w("primrose-scrollbar-toggler-"+da.id,!c.hideScrollBars,"Scroll bars","showScrollBars"),this.themeSelect=x("primrose-theme-selector-"+da.id,Primrose.Text.Themes,this.theme.name,y,"theme","theme"),this.commandSystemSelect=x("primrose-command-system-selector-"+da.id,Primrose.Text.Commands,C.name,y,"commandSystem","Command system"),this.tokenizerSelect=x("primrose-tokenizer-selector-"+da.id,Primrose.Text.Grammars,this.tokenizer.name,y,"tokenizer","Language syntax",Primrose.Text.Grammar),this.keyboardSelect=x("primrose-keyboard-selector-"+da.id,Primrose.Text.CodePages,this.codePage.name,y,"codePage","Localization",Primrose.Text.CodePage),this.operatingSystemSelect=x("primrose-operating-system-selector-"+da.id,Primrose.Text.OperatingSystems,this.operatingSystem.name,y,"operatingSystem","Shortcut style",Primrose.Text.OperatingSystem)}var b=isFirefox?3:100;return pliny["class"]("Primrose.Text.Controls",{name:"TextBox",description:"Syntax highlighting textbox control.",parameters:[{name:"renderToElementOrID",type:"String or Element",description:"Junk"},{name:"options",type:"Object",description:"More junk."}]}),inherit(a,Primrose.BaseControl),a}(),pliny.issue("Primrose.Text.Controls.TextBox",{name:"document TextBox",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Controls.TextBox](#Primrose_Text_Controls_TextBox)\n\r\nclass in the controls/ directory."}),pliny.issue("Primrose.Text.Controls.TextBox",{name:"TextBox does not render blank lines",type:"open",description:"If a line contains only a newline character, the line doesn't get\n\r\nrendered at all. The next line gets rendered instead, with the line number it *would*\n\r\nhave had, had the blank line been rendered. Adding whitespace to the line causes\n\r\nit to render. This seems to only happen for text that is loaded into the textbox,\n\r\nnot text that is entered by the keyboard."}),pliny.issue("Primrose.Text.Controls.TextBox",{name:"TextBox should re-render only on updates, not require an animation loop.",type:"open",description:"Currently, the TextBox knows quite a bit about when it needs to\n\r\nupdate, but it doesn't use this information to actually kick off a render. It first\n\r\nrequires us to ask it to render, and then it decides if it's time to render. Instead,\n\r\nthe invalidation that causes it to decide to render should just kick off a render."}),Primrose.Text.Grammars.Basic=function(){pliny.value("Primrose.Text.Grammars",{name:"Basic",description:"<under construction>"});var basicGrammar=new Primrose.Text.Grammar("BASIC",[["newlines",/(?:\r\n|\r|\n)/],["lineNumbers",/^\d+\s+/],["startLineComments",/^REM\s/],["strings",/"(?:\\"|[^"])*"/],["strings",/'(?:\\'|[^'])*'/],["numbers",/-?(?:(?:\b\d*)?\.)?\b\d+\b/],["keywords",/\b(?:RESTORE|REPEAT|RETURN|LOAD|LABEL|DATA|READ|THEN|ELSE|FOR|DIM|LET|IF|TO|STEP|NEXT|WHILE|WEND|UNTIL|GOTO|GOSUB|ON|TAB|AT|END|STOP|PRINT|INPUT|RND|INT|CLS|CLK|LEN)\b/],["keywords",/^DEF FN/],["operators",/(?:\+|;|,|-|\*\*|\*|\/|>=|<=|=|<>|<|>|OR|AND|NOT|MOD|\(|\)|\[|\])/],["identifiers",/\w+\$?/]]),oldTokenize=basicGrammar.tokenize;return basicGrammar.tokenize=function(a){return oldTokenize.call(this,a.toUpperCase())},basicGrammar.interpret=function(sourceCode,input,output,errorOut,next,clearScreen,loadFile,done){function toNum(a){return new Primrose.Text.Token(a.toString(),"numbers")}function toStr(a){return new Primrose.Text.Token('"'+a.replace("\n","\\n").replace('"','\\"')+'"',"strings")}function process(a){if(a&&a.length>0){var b=a.shift();if(b){if(commands.hasOwnProperty(b.value))return commands[b.value](a);if(!isNaN(b.value))return setProgramCounter([b]);if(state[b.value]||a.length>0&&"operators"===a[0].type&&"="===a[0].value)return a.unshift(b),translate(a);error("Unknown command. >>> "+b.value)}}return pauseBeforeComplete()}function error(a){errorOut("At line "+lineNumbers[counter]+": "+a)}function getLine(a){var b=lineNumbers[a],c=program[b];return c&&c.slice()}function evaluate(line){for(var script="",i=0;i<line.length;++i){var t=line[i],nest=0;if("identifiers"===t.type&&"function"!=typeof state[t.value]&&i<line.length-1&&"("===line[i+1].value)for(var j=i+1;j<line.length;++j){var t2=line[j];if("("===t2.value?(0===nest&&(t2.value="["),++nest):")"===t2.value?(--nest,0===nest&&(t2.value="]")):","===t2.value&&1===nest&&(t2.value="]["),0===nest)break}script+=t.value}with(state)try{return eval(script)}catch(exp){console.debug(line.join(", ")),console.error(exp),console.error(script),error(exp.message+": "+script)}}function declareVariable(a){var b,c=[],d=[c],e=0;for(b=0;b<a.length;++b){var f=a[b];"("===f.value?++e:")"===f.value&&--e,0===e&&","===f.value?(c=[],d.push(c)):c.push(f)}for(b=0;b<d.length;++b){c=d[b];var g=c.shift();if("identifiers"===g.type){var h,i=null;if(g=g.value,"("===c[0].value&&")"===c[c.length-1].value){var j=[];for(h=1;h<c.length-1;++h)"numbers"===c[h].type&&j.push(0|c[h].value);if(0===j.length)i=[];else{i=new Array(j[0]);var k=[i];for(h=1;h<j.length;++h)for(var l=j[h],m=0,n=k.length;n>m;++m)for(var o=k.shift(),p=0;p<o.length;++p)o[p]=new Array(l),h<j.length-1&&k.push(o[p])}}return state[g]=i,!0}error("Identifier expected: "+g.value)}}function print(a){var b="\n",c=0;a=a.map(function(d,e){return d=d.clone(),"operators"===d.type&&(","===d.value?0===c&&(d.value='+ ", " + '):";"===d.value?(d.value='+ " "',e<a.length-1?d.value+=" + ":b=""):"("===d.value?++c:")"===d.value&&--c),d});var d=evaluate(a);return void 0===d&&(d=""),output(d+b),!0}function setProgramCounter(a){var b=parseFloat(evaluate(a));for(counter=-1;counter<lineNumbers.length-1&&lineNumbers[counter+1]<b;)++counter;return!0}function checkConditional(a){var b,c=-1,d=-1;for(b=0;b<a.length;++b)"keywords"===a[b].type&&"THEN"===a[b].value?c=b:"keywords"===a[b].type&&"ELSE"===a[b].value&&(d=b);if(-1===c)error("Expected THEN clause.");else{var e=a.slice(0,c);for(b=0;b<e.length;++b){var f=e[b];"operators"===f.type&&"="===f.value&&(f.value="==")}var g,h;if(-1===d?g=a.slice(c+1):(g=a.slice(c+1,d),h=a.slice(d+1)),evaluate(e))return process(g);if(h)return process(h)}return!0}function pauseBeforeComplete(){return output("PROGRAM COMPLETE - PRESS RETURN TO FINISH."),input(function(){isDone=!0,done&&done()}),!1}function labelLine(a){return a.push(EQUAL_SIGN),a.push(toNum(lineNumbers[counter])),translate(a)}function waitForInput(a){var b=a.pop();return a.length>0&&print(a),input(function(a){a=a.toUpperCase();var c=null;c=isNaN(a)?toStr(a):toNum(a),evaluate([b,EQUAL_SIGN,c]),next&&next()}),!1}function onStatement(a){var b=[],c=null,d=[];try{for(;a.length>0&&("keywords"!==a[0].type||"GOTO"!==a[0].value);)b.push(a.shift());if(a.length>0){a.shift();for(var e=0;e<a.length;++e){var f=a[e];("operators"!==f.type||","!==f.value)&&d.push(f)}if(c=evaluate(b)-1,c>=0&&c<d.length)return setProgramCounter([d[c]])}}catch(g){console.error(g)}return!0}function gotoSubroutine(a){return returnStack.push(toNum(lineNumbers[counter+1])),setProgramCounter(a)}function setRepeat(){return returnStack.push(toNum(lineNumbers[counter])),!0}function conditionalReturn(a){var b=!0,c=returnStack.pop();return c&&a&&(b=setProgramCounter([c])),b}function untilLoop(a){var b=!evaluate(a);return conditionalReturn(b)}function findNext(a){for(i=counter+1;i<lineNumbers.length;++i){var b=getLine(i);if(b[0].value===a)return i}return lineNumbers.length}function whileLoop(a){var b=evaluate(a);return b?returnStack.push(toNum(lineNumbers[counter])):counter=findNext("WEND"),!0}function forLoop(a){var b=lineNumbers[counter],c=[],d=[],e=[],f=[],g=[c,d,e,f],h=0,i=0;for(i=0;i<a.length;++i){var j=a[i];j.value===FOR_LOOP_DELIMS[h]?(0===h&&c.push(j),++h):g[h].push(j)}var k=1;f.length>0&&(k=evaluate(f)),void 0===forLoopCounters[b]&&(forLoopCounters[b]=evaluate(d));var l=evaluate(e),m=forLoopCounters[b]<=l;return m?(c.push(toNum(forLoopCounters[b])),process(c),forLoopCounters[b]+=k,returnStack.push(toNum(lineNumbers[counter]))):(delete forLoopCounters[b],counter=findNext("NEXT")),!0}function stackReturn(){return conditionalReturn(!0)}function loadCodeFile(a){return loadFile(evaluate(a),function(){next&&next()}),!1}function noop(){return!0}function loadData(a){for(;a.length>0;){var b=a.shift();"operators"!==b.type&&data.push(b.value)}return!0}function readData(a){if(0===data.length){var b=findNext("DATA");process(getLine(b))}var c=data[dataCounter];return++dataCounter,a.push(EQUAL_SIGN),a.push(toNum(c)),translate(a)}function restoreData(){return dataCounter=0,!0}function defineFunction(line){for(var name=line.shift().value,signature="",body="",fillSig=!0,i=0;i<line.length;++i){var t=line[i];"operators"===t.type&&"="===t.value?fillSig=!1:fillSig?signature+=t.value:body+=t.value}name="FN"+name;var script="(function "+name+signature+"{ return "+body+"; })";return state[name]=eval(script),!0}function translate(a){return evaluate(a),!0}for(var tokens=this.tokenize(sourceCode),EQUAL_SIGN=new Primrose.Text.Token("=","operators"),counter=0,isDone=!1,program={},lineNumbers=[],currentLine=[],lines=[currentLine],data=[],returnStack=[],forLoopCounters={},dataCounter=0,state={INT:function(a){return 0|a},RND:function(){return Math.random()},CLK:function(){return Date.now()/36e5},LEN:function(a){return a.length},LINE:function(){return lineNumbers[counter]},TAB:function(a){for(var b="",c=0;a>c;++c)b+=" ";return b},POW:function(a,b){return Math.pow(a,b)}},tokenMap={OR:"||",AND:"&&",NOT:"!",MOD:"%","<>":"!="};tokens.length>0;){var token=tokens.shift();"newlines"===token.type?(currentLine=[],lines.push(currentLine)):"regular"!==token.type&&"comments"!==token.type&&(token.value=tokenMap[token.value]||token.value,currentLine.push(token))}for(var i=0;i<lines.length;++i){var line=lines[i];if(line.length>0){var lastLine=lineNumbers[lineNumbers.length-1],lineNumber=line.shift();if("lineNumbers"!==lineNumber.type&&(line.unshift(lineNumber),void 0===lastLine&&(lastLine=-1),lineNumber=toNum(lastLine+1)),lineNumber=parseFloat(lineNumber.value),lastLine&&lastLine>=lineNumber)throw new Error("expected line number greater than "+lastLine+", but received "+lineNumber+".");line.length>0&&(lineNumbers.push(lineNumber),program[lineNumber]=line)}}var FOR_LOOP_DELIMS=["=","TO","STEP"],commands={DIM:declareVariable,LET:translate,PRINT:print,GOTO:setProgramCounter,IF:checkConditional,INPUT:waitForInput,END:pauseBeforeComplete,STOP:pauseBeforeComplete,REM:noop,"'":noop,CLS:clearScreen,ON:onStatement,GOSUB:gotoSubroutine,RETURN:stackReturn,LOAD:loadCodeFile,DATA:loadData,READ:readData,RESTORE:restoreData,REPEAT:setRepeat,UNTIL:untilLoop,"DEF FN":defineFunction,WHILE:whileLoop,WEND:stackReturn,FOR:forLoop,NEXT:stackReturn,LABEL:labelLine};return function(){if(!isDone)for(var a=!0;a;){var b=getLine(counter);a=process(b),++counter}}},basicGrammar}(),pliny.issue("Primrose.Text.Grammars.Basic",{name:"document Basic",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Grammars.Basic](#Primrose_Text_Grammars_Basic) class in the grammars/ directory"}),Primrose.Text.Grammars.JavaScript=function(){"use strict";return pliny.value("Primrose.Text.Grammars",{name:"JavaScript",description:"<under construction>"}),new Primrose.Text.Grammar("JavaScript",[["newlines",/(?:\r\n|\r|\n)/],["startBlockComments",/\/\*/],["endBlockComments",/\*\//],["regexes",/(?:^|,|;|\(|\[|\{)(?:\s*)(\/(?:\\\/|[^\n\/])+\/)/],["stringDelim",/("|')/],["startLineComments",/\/\/.*$/m],["numbers",/-?(?:(?:\b\d*)?\.)?\b\d+\b/],["keywords",/\b(?:break|case|catch|const|continue|debugger|default|delete|do|else|export|finally|for|function|if|import|in|instanceof|let|new|return|super|switch|this|throw|try|typeof|var|void|while|with)\b/],["functions",/(\w+)(?:\s*\()/],["members",/(\w+)\./],["members",/((\w+\.)+)(\w+)/]])}(),pliny.issue("Primrose.Text.Grammars.JavaScript",{name:"document JavaScript",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Grammars.JavaScript](#Primrose_Text_Grammars_JavaScript) class in the grammars/ directory"}),Primrose.Text.Grammars.PlainText=function(){"use strict";return pliny.value("Primrose.Text.Grammars",{name:"PlainText",description:"<under construction>"}),new Primrose.Text.Grammar("PlainText",[["newlines",/(?:\r\n|\r|\n)/]])}(),pliny.issue("Primrose.Text.Grammars.PlainText",{name:"document PlainText",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Grammars.PlainText](#Primrose_Text_Grammars_PlainText) class in the grammars/ directory"}),Primrose.Text.Grammars.TestResults=function(){"use strict";return pliny.value("Primrose.Text.Grammars",{name:"TestResults",description:"<under construction>"}),new Primrose.Text.Grammar("TestResults",[["newlines",/(?:\r\n|\r|\n)/,!0],["numbers",/(\[)(o+)/,!0],["numbers",/(\d+ succeeded), 0 failed/,!0],["numbers",/^    Successes:/,!0],["functions",/(x+)\]/,!0],["functions",/[1-9]\d* failed/,!0],["functions",/^    Failures:/,!0],["comments",/(\d+ms:)(.*)/,!0],["keywords",/(Test results for )(\w+):/,!0],["strings",/        \w+/,!0]])}(),pliny.issue("Primrose.Text.Grammars.TestResults",{name:"document TestResults",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Grammars.TestResults](#Primrose_Text_Grammars_TestResults) class in the grammars/ directory"}),Primrose.Text.OperatingSystems.OSX=function(){"use strict";return pliny.value("Primrose.Text.OperatingSystems",{name:"OSX",description:"<under construction>"}),new Primrose.Text.OperatingSystem("OS X","META","ALT","METASHIFT_z","META","LEFTARROW","RIGHTARROW","META","UPARROW","DOWNARROW")}(),pliny.issue("Primrose.Text.OperatingSystems.OSX",{name:"document OSX",type:"open",description:"Finish writing the documentation for the [Primrose.Text.OperatingSystems.OSX](#Primrose_Text_OperatingSystems_OSX) class in the operating_systems/ directory"}),Primrose.Text.OperatingSystems.Windows=function(){"use strict";return pliny.value("Primrose.Text.OperatingSystems",{name:"OSX",description:"<under construction>"}),new Primrose.Text.OperatingSystem("Windows","CTRL","CTRL","CTRL_y","","HOME","END","CTRL","HOME","END")}(),pliny.issue("Primrose.Text.OperatingSystems.Windows",{name:"document Windows",type:"open",description:"Finish writing the documentation for the [Primrose.Text.OperatingSystems.Windows](#Primrose_Text_OperatingSystems_Windows) class in the operating_systems/ directory"}),Primrose.Text.Renderers.Canvas=function(){"use strict";function a(a,b){function c(a,b,c,d,e,f){a.fillStyle=b,a.fillRect(c*h.character.width,d*h.character.height,e*h.character.width+1,f*h.character.height+1)}function d(a,b,c,d,e,f){a.strokeStyle=b,a.strokeRect(c*h.character.width,d*h.character.height,e*h.character.width+1,f*h.character.height+1)}function e(a,b,d,e,f,g,j){var k=Primrose.Text.Cursor.min(f,g),l=Primrose.Text.Cursor.max(f,g),m=new Primrose.Text.Cursor,n=new Primrose.Text.Cursor,p=q.regular.backColor?"fillRect":"clearRect";q.regular.backColor&&(o.fillStyle=q.regular.backColor),o[p](0,0,i.width,i.height),o.save(),o.translate((b.x-e.x)*h.character.width+d,-e.y*h.character.height+d),j&&c(o,q.regular.currentRowBackColor||Primrose.Text.Themes.Default.regular.currentRowBackColor,0,k.y,b.width,l.y-k.y+1);for(var r=0;r<a.length;++r){for(var s=a[r],t=0;t<s.length;++t){var u=s[t];if(n.x+=u.value.length,n.i+=u.value.length,e.y<=r&&r<e.y+b.height&&e.x<=n.x&&m.x<e.x+b.width){var v=k.i<=n.i&&m.i<l.i;if(v){var w=Primrose.Text.Cursor.max(k,m),x=Primrose.Text.Cursor.min(l,n),y=x.i-w.i;c(o,q.regular.selectedBackColor||Primrose.Text.Themes.Default.regular.selectedBackColor,w.x,w.y,y,1)}}m.copy(n)}m.x=0,++m.y,n.copy(m)}if(j){var z=q.cursorColor||"black",A=1/h.character.width;c(o,z,k.x,k.y,A,1),c(o,z,l.x,l.y,A,1)}o.restore()}function f(a,b,c,d,e){var f,g=new Primrose.Text.Cursor,j=new Primrose.Text.Cursor,l=Math.ceil(.2*h.character.height);n.clearRect(0,0,i.width,i.height),n.save(),n.translate((b.x-d.x)*h.character.width+c,c);for(var m=0;m<a.length;++m){var o=e[m]+c,p=a[m],r=!1,s=(m+.8-d.y)*h.character.height,u=(m-d.y-.2)*h.character.height+l;for(f=0;f<p.length;++f){var v=p[f];if(j.x+=v.value.length,j.i+=v.value.length,d.y<=m&&m<d.y+b.height&&d.x<=j.x&&g.x<d.x+b.width)if(void 0!==t[o])0===f&&n.putImageData(t[o],c,u+c);else{var w=q[v.type]||{},x=(w.fontWeight||q.regular.fontWeight||"")+" "+(w.fontStyle||q.regular.fontStyle||"")+" "+h.character.height+"px "+q.fontFamily;n.font=x.trim(),n.fillStyle=w.foreColor||q.regular.foreColor,n.fillText(v.value,g.x*h.character.width,s),r=!0}g.copy(j)}g.x=0,++g.y,j.copy(g),r&&void 0===t[o]&&(t[o]=n.getImageData(c,u+c,k.width-2*c,h.character.height))}n.restore()}function g(a,b,e,f,g,j,k,l,m){var n,o=new Primrose.Text.Cursor,r=new Primrose.Text.Cursor,s=0;p.clearRect(0,0,i.width,i.height),p.save(),p.translate(e,e),p.save(),p.lineWidth=2,p.translate(0,-f.y*h.character.height);for(var t=0,u=-1;t<a.length;++t){var v=a[t];for(n=0;n<v.length;++n){var w=v[n];r.x+=w.value.length,r.i+=w.value.length,o.copy(r)}if(s=Math.max(s,r.x),o.x=0,++o.y,r.copy(o),g&&f.y<=t&&t<f.y+b.height){for(var x=v.length>0?v[0].line:u+1,y=x.toString();y.length<l;)y=" "+y;c(p,q.regular.selectedBackColor||Primrose.Text.Themes.Default.regular.selectedBackColor,0,t,b.x,1),p.font="bold "+h.character.height+"px "+q.fontFamily,x>u&&(p.fillStyle=q.regular.foreColor,p.fillText(y,0,(t+.8)*h.character.height)),u=x}}if(p.restore(),g&&d(p,q.regular.foreColor||Primrose.Text.Themes.Default.regular.foreColor,0,0,b.x,b.height),j){var z=b.width*h.character.width-e,A=b.height*h.character.height,B=f.x*z/s+b.x*h.character.width,C=f.y*A/a.length;p.fillStyle=q.regular.selectedBackColor||Primrose.Text.Themes.Default.regular.selectedBackColor;var D;if(!k&&s>b.width){var E=z*(b.width/s),F=b.height*h.character.height;D=Math.max(h.character.width,E),p.fillRect(B,F,D,h.character.height),p.strokeRect(B,F,D,h.character.height)}if(a.length>b.height){var G=A*(b.height/a.length),H=i.width-h.VSCROLL_WIDTH*h.character.width-2*e,I=Math.max(h.character.height,G);D=h.VSCROLL_WIDTH*h.character.width,p.fillRect(H,C,D,I),p.strokeRect(H,C,D,I)}}d(p,q.regular.foreColor||Primrose.Text.Themes.Default.regular.foreColor,b.x,0,b.width,b.height),p.strokeRect(0,0,i.width-2*e,i.height-2*e),p.restore(),m||(p.fillStyle=q.regular.unfocused||Primrose.Text.Themes.Default.regular.unfocused,p.fillRect(0,0,i.width,i.height))}var h=this,i=Primrose.DOM.cascadeElement(a,"canvas",HTMLCanvasElement),j=Primrose.DOM.cascadeElement(i.id+"-back","canvas",HTMLCanvasElement),k=Primrose.DOM.cascadeElement(i.id+"-front","canvas",HTMLCanvasElement),l=Primrose.DOM.cascadeElement(i.id+"-trim","canvas",HTMLCanvasElement),m=i.getContext("2d"),n=k.getContext("2d"),o=j.getContext("2d"),p=l.getContext("2d"),q=null,r=null,s=b.size,t={},u=!1,v=-1,w=-1,x=-1,y=-1,z=-1,A=-1,B=null;i.style.imageRendering=j.style.imageRendering=k.style.imageRendering=l.style.imageRendering=isChrome?"pixelated":"optimizespeed",m.imageSmoothingEnabled=p.imageSmoothingEnabled=o.imageSmoothingEnabled=p.imageSmoothingEnabled=!1,this.VSCROLL_WIDTH=2,this.character=new Primrose.Text.Size,this.id=i.id,this.autoBindEvents=!0,this.pixel2cell=function(a,b,c){var d=a.x*i.width/i.clientWidth,e=a.y*i.height/i.clientHeight;a.set(Math.round(d/this.character.width)+b.x-c.x,Math.floor(e/this.character.height-.25)+b.y)},this.resize=function(){q&&(this.character.height=q.fontSize,m.font=this.character.height+"px "+q.fontFamily,this.character.width=m.measureText("MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM").width/100,(x!==this.elementWidth||y!==this.elementHeight)&&this.elementWidth>0&&this.elementHeight>0&&(x=j.width=k.width=l.width=i.width=this.elementWidth,y=j.height=k.height=l.height=i.height=this.elementHeight))},this.setSize=function(a,b){return i.style.width=Math.round(a)+"px",i.style.height=Math.round(b)+"px",this.resize()},Object.defineProperties(this,{elementWidth:{get:function(){return s&&s.width||i.clientWidth*devicePixelRatio}},elementHeight:{get:function(){return s&&s.height||i.clientHeight*devicePixelRatio}},width:{get:function(){return i.width}},height:{get:function(){return i.height}},resized:{get:function(){return this.width!==this.elementWidth||this.height!==this.elementHeight}},theme:{set:function(a){q=a,this.resize()}},DOMElement:{get:function(){return i}},texture:{get:function(){return"undefined"==typeof window.THREE||r||(r=new THREE.Texture(i),r.needsUpdate=!0),r}}}),this.mapUV=function(a){return a?{x:Math.floor(i.width*a[0]),y:Math.floor(i.height*(1-a[1]))}:void 0},this.render=function(a,b,c,d,h,n,o,p,s,x,y,C,D){if(q){var E=c.i!==v||w!==d.i,F=n.x!==z||n.y!==A,G=m.font!==B,H=o!==u;v=c.i,w=d.i,u=o,B=m.font,z=n.x,A=n.y,D&&(t={},this.resized&&this.resize());var I=D||G||F,J=I||H||E;(I||J)&&(e(a,h,C,n,c,d,o),(I||H)&&(I&&f(a,h,C,n,b),g(a,h,C,n,p,s,x,y,o)),m.clearRect(0,0,i.width,i.height),m.drawImage(j,0,0),m.drawImage(k,0,0),m.drawImage(l,0,0),r&&(r.needsUpdate=!0))}},a instanceof window.HTMLCanvasElement||!s||(i.style.position="absolute",i.style.width=s.width,i.style.height=s.height),i.parentElement||(this.autoBindEvents=!1,document.body.appendChild(Primrose.DOM.makeHidingContainer("primrose-container-"+i.id,i)))}return pliny["class"]("Primrose.Text.Renderers",{name:"Canvas",description:"<under construction>"}),a}(),pliny.issue("Primrose.Text.Renderers.Canvas",{name:"document Canvas",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Renderers.Canvas](#Primrose_Text_Renderers_Canvas) class in the renderers/ directory"}),Primrose.Text.Renderers.DOM=function(){"use strict";function a(a){function c(a){a.style.font=d.font,a.style.lineHeight=px(parseInt(d.font,10)),a.style.padding="0",a.style.margin="0"}var d=this;this.font=null,this.fillStyle=null;var e=[new Point];this.measureText=function(a){var d=document.createElement("div");c(d),d.style.position="absolute",d.style.visibility="hidden",d.innerHTML=a,document.body.appendChild(d);var e=new b(d.clientWidth,d.clientHeight);return document.body.removeChild(d),e},this.clearRect=function(){a.innerHTML=""},this.drawImage=function(b,c,d){var f=e[e.length-1];b.style.position="absolute",b.style.left=px(c+f.x),b.style.top=px(d+f.y),a.appendChild(b)},this.fillRect=function(b,c,d,f){var g=e[e.length-1],h=document.createElement("div");h.style.position="absolute",h.style.left=px(b+g.x),h.style.top=px(c+g.y),h.style.width=px(d),h.style.height=px(f),h.style.backgroundColor=this.fillStyle,a.appendChild(h)},this.fillText=function(b,d,f){
var g=e[e.length-1],h=document.createElement("span");h.style.position="absolute",h.style.left=px(d+g.x),h.style.top=px(f+g.y),h.style.whiteSpace="pre",c(h),h.style.color=this.fillStyle,h.appendChild(document.createTextNode(b)),a.appendChild(h)},this.save=function(){var a=e[e.length-1];e.push(a.clone())},this.restore=function(){e.pop()},this.translate=function(a,b){var c=e[e.length-1];c.x+=a,c.y+=b}}var b=Primrose.Text.Size,c=Primrose.Text.Cursor,d=Primrose.Text.Themes.Default;return window.HTMLDivElement.prototype.getContext=function(b){if("2d"!==b)throw new Exception("type parameter needs to be '2d'.");return this.style.width=pct(100),this.style.height=pct(100),new a(this)},pliny["class"]("Primrose.Text.Renderers",{name:"DOM",description:"<under construction>"}),function(a,e){function f(a,b,c,d,e,f){a.fillStyle=b,a.fillRect(c*j.character.width,d*j.character.height,e*j.character.width+1,f*j.character.height+1)}function g(a,b,e,g,h,i){var k=c.min(b,e),m=c.max(b,e),n=new c,o=new c;s.regular.backColor&&(q.fillStyle=s.regular.backColor,l.style.backgroundColor=s.regular.backColor),q.clearRect(0,0,t,u),q.save(),q.translate((g.x-h.x)*j.character.width,-h.y*j.character.height),i&&f(q,s.regular.currentRowBackColor||d.regular.currentRowBackColor,0,k.y+.2,g.width,m.y-k.y+1);for(var p=0;p<a.length;++p){for(var r=a[p],v=0;v<r.length;++v){var w=r[v];if(o.x+=w.value.length,o.i+=w.value.length,h.y<=p&&p<h.y+g.height&&h.x<=o.x&&n.x<h.x+g.width){var x=k.i<=o.i&&n.i<m.i;if(x){var y=c.max(k,n),z=c.min(m,o),A=z.i-y.i;f(q,s.regular.selectedBackColor||d.regular.selectedBackColor,y.x,y.y+.2,A,1)}}n.copy(o)}n.x=0,++n.y,o.copy(n)}if(i){var B=s.cursorColor||"black",C=1/j.character.width;f(q,B,k.x,k.y,C,1),f(q,B,m.x,m.y,C,1)}q.restore()}function h(a,b,d){var e=new c,f=new c,g=0;p.clearRect(0,0,t,u),p.save(),p.translate((b.x-d.x)*j.character.width,-d.y*j.character.height);for(var h=0;h<a.length;++h){for(var i=a[h],k=0;k<i.length;++k){var l=i[k];if(f.x+=l.value.length,f.i+=l.value.length,d.y<=h&&h<d.y+b.height&&d.x<=f.x&&e.x<d.x+b.width){var m=s[l.type]||{},n=(m.fontWeight||s.regular.fontWeight||"")+" "+(m.fontStyle||s.regular.fontStyle||"")+" "+j.character.height+"px "+s.fontFamily;p.font=n.trim(),p.fillStyle=m.foreColor||s.regular.foreColor,p.fillText(l.value,e.x*j.character.width,h*j.character.height)}e.copy(f)}g=Math.max(g,f.x),e.x=0,++e.y,f.copy(e)}return p.restore(),g}function i(a,b,c,e,g,h,i,k){if(r.clearRect(0,0,t,u),r.save(),r.translate(0,-c.y*j.character.height),e)for(var l=c.y,m=-1;l<c.y+b.height&&l<a.length;++l){for(var n=a[l],o=n.length>0?n[0].line:m+1,p=o.toString();p.length<i;)p=" "+p;f(r,s.regular.selectedBackColor||d.regular.selectedBackColor,0,l+.2,b.x,1),r.font="bold "+j.character.height+"px "+s.fontFamily,o>m&&(r.fillStyle=s.regular.foreColor,r.fillText(p,0,l*j.character.height)),m=o}if(r.restore(),g){var q=b.width*j.character.width,v=b.height*j.character.height,w=c.x*q/k+b.x*j.character.width,x=c.y*v/a.length+b.y*j.character.height;if(r.fillStyle=s.regular.selectedBackColor||d.regular.selectedBackColor,!h&&k>b.width){var y=q*(b.width/k);r.fillRect(w,(b.height+.25)*j.character.height,Math.max(j.character.width,y),j.character.height)}if(a.length>b.height){var z=v*(b.height/a.length);r.fillRect(t-j.VSCROLL_WIDTH*j.character.width,x,j.VSCROLL_WIDTH*j.character.width,Math.max(j.character.height,z))}}}var j=this,k=Primrose.DOM.cascadeElement(a,"div",HTMLDivElement),l=Primrose.DOM.cascadeElement(k.id+"-back","div",HTMLDivElement),m=Primrose.DOM.cascadeElement(k.id+"-front","div",HTMLDivElement),n=Primrose.DOM.cascadeElement(k.id+"-trim","div",HTMLDivElement),o=k.getContext("2d"),p=m.getContext("2d"),q=l.getContext("2d"),r=n.getContext("2d"),s=null,t=null,u=null;this.VSCROLL_WIDTH=2,this.character=new b,this.id=k.id,this.autoBindEvents=!0,this.pixel2cell=function(a,b,c){a.set(Math.round(a.x/this.character.width)+b.x-c.x,Math.floor(a.y/this.character.height-.25)+b.y)},this.resize=function(){var a=!1;if(s){var b=this.character.width,c=this.character.height,d=k.clientWidth,e=k.clientHeight,f=o.font;this.character.height=s.fontSize,o.font=px(this.character.height)+" "+s.fontFamily,this.character.width=o.measureText("MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM").width/100,a=b!==this.character.width||c!==this.character.height||f!==o.font,d>0&&e>0&&(l.width=m.width=n.width=d,l.height=m.height=n.height=e,a=a||t!==d||u!==d,t=d,u=e)}return a},this.setSize=function(a,b){return k.style.width=px(a),k.style.height=px(b),this.resize()},Object.defineProperties({width:{get:function(){return t}},height:{get:function(){return u}},resized:{get:function(){var a=k.clientWidth,b=k.clientHeight;return t!==a||u!==b}},theme:{set:function(a){s=a,this.resize()}},DOMElement:{get:function(){return k}}}),this.render=function(a,b,c,d,e,f,j,k,p,q,r){var s=0;g(a,c,d,e,f,j),s=h(a,e,f),i(a,e,f,k,p,q,r,s),o.clearRect(0,0,t,u),o.drawImage(l,0,0),o.drawImage(m,0,0),o.drawImage(n,0,0)},a instanceof window.HTMLDivElement||!e.width||!e.height||(k.style.position="absolute",k.style.width=e.width,k.style.height=e.height),k.parentElement||(this.autoBindEvents=!1,document.body.appendChild(Primrose.DOM.makeHidingContainer("primrose-container-"+k.id,k)))}},pliny.issue("Primrose.Text.Renderers.DOM",{name:"document DOM",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Renderers.DOM](#Primrose_Text_Renderers_DOM) class in the renderers/ directory"}),pliny.issue("Primrose.Text.Renderers.DOM",{name:"fix DOM renderer",type:"open",description:"Trying to use this renderer causes an infinite loop somewhere that completely degrades system performance."}),Primrose.Text.Themes.Dark=function(){"use strict";return pliny.record("Primrose.Text.Themes",{name:"Dark",description:"<under construction>"}),{name:"Dark",fontFamily:"'Droid Sans Mono', 'Consolas', 'Lucida Console', 'Courier New', 'Courier', monospace",cursorColor:"white",fontSize:16,lineNumbers:{foreColor:"white"},regular:{backColor:"black",foreColor:"#c0c0c0",currentRowBackColor:"#202020",selectedBackColor:"#404040",unfocused:"rgba(0, 0, 255, 0.25)"},strings:{foreColor:"#aa9900",fontStyle:"italic"},regexes:{foreColor:"#aa0099",fontStyle:"italic"},numbers:{foreColor:"green"},comments:{foreColor:"yellow",fontStyle:"italic"},keywords:{foreColor:"cyan"},functions:{foreColor:"brown",fontWeight:"bold"},members:{foreColor:"green"},error:{foreColor:"red",fontStyle:"underline italic"}}}(),pliny.issue("Primrose.Text.Themes.Dark",{name:"document Dark",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Themes.Dark](#Primrose_Text_Themes_Dark) class in the themes/ directory"}),Primrose.Text.Themes.Default=function(){"use strict";return pliny.record("Primrose.Text.Themes",{name:"Default",description:"<under construction>"}),{name:"Light",fontFamily:"'Droid Sans Mono', 'Consolas', 'Lucida Console', 'Courier New', 'Courier', monospace",cursorColor:"black",fontSize:16,lineNumbers:{foreColor:"black"},regular:{backColor:"white",foreColor:"black",currentRowBackColor:"#f0f0f0",selectedBackColor:"#c0c0c0",unfocused:"rgba(0, 0, 255, 0.25)"},strings:{foreColor:"#aa9900",fontStyle:"italic"},regexes:{foreColor:"#aa0099",fontStyle:"italic"},numbers:{foreColor:"green"},comments:{foreColor:"grey",fontStyle:"italic"},keywords:{foreColor:"blue"},functions:{foreColor:"brown",fontWeight:"bold"},members:{foreColor:"green"},error:{foreColor:"red",fontStyle:"underline italic"}}}(),pliny.issue("Primrose.Text.Themes.Default",{name:"document Default",type:"open",description:"Finish writing the documentation for the [Primrose.Text.Themes.Default](#Primrose_Text_Themes_Default) class in the themes/ directory"}),Primrose.VERSION="v0.21.1",console.log("Using Primrose v0.21.1. Find out more at http://www.primrosevr.com");