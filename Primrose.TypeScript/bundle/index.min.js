function Q(o,t,e){return typeof o===t||o instanceof e}function C(o){return Q(o,"function",Function)}function V(o){return Q(o,"string",String)}function tt(o){return Q(o,"boolean",Boolean)}function F(o){return g(o)&&Q(o,"object",Object)}function A(o){return o==null}function g(o){return!A(o)}function O(o){return o.splice(0)}function gt(o,t){let e=o.indexOf(t);return e>-1?(vt(o,e),!0):!1}function vt(o,t){return o.splice(t,1)[0]}function zt(o,...t){o.splice(0,o.length,...t)}var Wt=new Map,et=class{constructor(t,e,n,...r){this.key=t,this.value=e,this.bySetAttribute=n,this.tags=r.map(i=>i.toLocaleUpperCase()),Object.freeze(this)}applyToElement(t){if(this.tags.length>0&&this.tags.indexOf(t.tagName)===-1){let e=Wt.get(t.tagName);e||Wt.set(t.tagName,e=new Set),e.has(this.key)||(e.add(this.key),console.warn(`Element ${t.tagName} does not support Attribute ${this.key}`))}this.bySetAttribute?t.setAttribute(this.key,this.value.toString()):this.key in t?t[this.key]=this.value:this.value===!1?t.removeAttribute(this.key):this.value===!0?t.setAttribute(this.key,""):C(this.value)?this.value(t):t.setAttribute(this.key,this.value.toString())}};function ot(o,t,e,...n){return new et(o,t,e,...n)}function Nt(o){return o instanceof et}function Ut(o){return ot("height",o,!1,"canvas","embed","iframe","img","input","object","video")}function Ht(o){return ot("id",o,!1)}function Gt(o){return V(o)||(o=o.value),ot("type",o,!1,"button","input","command","embed","link","object","script","source","style","menu")}function $t(o){return ot("width",o,!1,"canvas","embed","iframe","img","input","object","video")}var nt=class{constructor(t=!0){this.autoStart=t,this.onThens=new Array,this.onCatches=new Array,this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",this.resolve=e=>{if(this.running){this._result=e,this._resultState="resolved";for(let n of this.onThens)n(e);this.clear(),this._executionState="finished"}},this.reject=e=>{if(this.running){this._error=e,this._resultState="errored";for(let n of this.onCatches)n(e);this.clear(),this._executionState="finished"}},this.autoStart&&this.start()}clear(){O(this.onThens),O(this.onCatches)}start(){this._executionState="running"}resolver(t){return()=>this.resolve(t)}resolveOn(t,e,n){let r=this.resolver(n);t.addEventListener(e,r),this.finally(()=>t.removeEventListener(e,r))}get result(){if(g(this.error))throw this.error;return this._result}get error(){return this._error}get executionState(){return this._executionState}get waiting(){return this.executionState==="waiting"}get started(){return this.executionState!=="waiting"}get running(){return this.executionState==="running"}get finished(){return this.executionState==="finished"}get resultState(){return this._resultState}get resolved(){return this.resultState==="resolved"}get errored(){return this.resultState==="errored"}get[Symbol.toStringTag](){return this.toString()}project(){return new Promise((t,e)=>{this.finished?this.errored?e(this.error):t(this.result):(this.onThens.push(t),this.onCatches.push(e))})}then(t,e){return this.project().then(t,e)}catch(t){return this.project().catch(t)}finally(t){return this.project().finally(t)}reset(){this._reset(this.autoStart)}restart(){this._reset(!0)}_reset(t){this.running&&this.reject("Resetting previous invocation"),this.clear(),this._result=void 0,this._error=void 0,this._executionState="waiting",this._resultState="none",t&&this.start()}};var z=class{constructor(){this.listeners=new Map,this.listenerOptions=new Map,this.bubblers=new Set,this.scopes=new WeakMap}addBubbler(t){this.bubblers.add(t)}removeBubbler(t){this.bubblers.delete(t)}addScopedEventListener(t,e,n,r){this.scopes.has(t)||this.scopes.set(t,[]),this.scopes.get(t).push([e,n]),this.addEventListener(e,n,r)}removeScope(t){let e=this.scopes.get(t);if(e){this.scopes.delete(t);for(let[n,r]of e)this.removeEventListener(n,r)}}addEventListener(t,e,n){let r=this.listeners.get(t);r||(r=new Array,this.listeners.set(t,r)),r.find(i=>i===e)||(r.push(e),n&&this.listenerOptions.set(e,n))}removeEventListener(t,e){let n=this.listeners.get(t);n&&this.removeListener(n,e)}clearEventListeners(t){for(let[e,n]of this.listeners)if(A(t)||t===e){for(let r of n)this.removeEventListener(t,r);O(n),this.listeners.delete(e)}}removeListener(t,e){let n=t.findIndex(r=>r===e);n>=0&&(vt(t,n),this.listenerOptions.has(e)&&this.listenerOptions.delete(e))}dispatchEvent(t){let e=this.listeners.get(t.type);if(e)for(let n of e){let r=this.listenerOptions.get(n);g(r)&&!tt(r)&&r.once&&this.removeListener(e,n),C(n)?n.call(this,t):n.handleEvent(t)}if(t.defaultPrevented)return!1;for(let n of this.bubblers)if(!n.dispatchEvent(t))return!1;return!0}};function Vt(o){return`${o}%`}function yt(){return"ui-monospace, 'Droid Sans Mono', 'Cascadia Mono', 'Segoe UI Mono', 'Ubuntu Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace"}function Jt(){return We(yt())}var At=class{constructor(t){this._value=t}get value(){return this._value}toString(){return this.value}};var bt=class extends At{constructor(t,e,n){super(n),this._name=t,this.sep=e}get name(){return this._name}toString(){return this.name+this.sep+this.value+";"}};var wt=class extends bt{constructor(t,e){super(t,": ",e)}},v=class extends wt{constructor(t,e){super(t.replace(/[A-Z]/g,n=>`-${n.toLocaleLowerCase()}`),e.toString()),this.key=t,this.priority=""}applyToElement(t){t.style[this.key]=this.value+this.priority}important(){return this.priority=" !important",this}get value(){return super.value+this.priority}};function qt(o){return new v("backgroundColor",o)}function Kt(o){return new v("border",o)}function Yt(o){return new v("color",o)}function kt(o){return new v("display",o)}function We(o){return new v("fontFamily",o)}function Zt(o){return new v("fontStyle",o)}function Qt(o){return new v("fontWeight",o)}function te(o){return new v("height",o)}function ee(...o){return new v("overflow",o.join(" "))}function oe(...o){return new v("padding",o.join(" "))}function ne(o){return new v("width",o)}function re(o){return F(o)?o.element instanceof Element:!1}function ie(o){return re(o)?o.element:V(o)?Ct(o):o}function Ue(o){return F(o)&&"applyToElement"in o&&C(o.applyToElement)}function S(o,...t){let e=o instanceof Element||o instanceof ShadowRoot?o:V(o)?document.querySelector(o):o.element,n=e instanceof HTMLTemplateElement?e.content:e;for(let r of t)g(r)&&(r instanceof Node?n.appendChild(r):re(r)?n.appendChild(ie(r)):Ue(r)?e instanceof ShadowRoot||r.applyToElement(e):n.appendChild(document.createTextNode(r.toLocaleString())));return e}function Ct(o){return document.querySelector(o)}function L(o,...t){let e=null,n=t.filter(Nt).filter(r=>r.key==="id"||r.key==="query");for(let r of n)r.key==="query"?(e=r.value,gt(t,r)):r.key==="id"&&(e=document.getElementById(r.value),e&&gt(t,r));return e&&e.tagName!==o.toUpperCase()&&console.warn(`Expected a "${o.toUpperCase()}" element but found a "${e.tagName}".`),e||(e=document.createElement(o)),S(e,...t),e}function se(o){for(o=ie(o);o.lastChild;)o.lastChild.remove()}function pe(){return L("br")}function rt(...o){return L("canvas",...o)}function ce(...o){return L("div",...o)}function He(...o){return L("input",...o)}function ae(...o){return L("span",...o)}function le(...o){return L("textarea",...o)}function de(...o){return He(Gt("text"),...o)}var xe="HTMLCanvasElement"in globalThis,Zn="HTMLImageElement"in globalThis,me=!1,St=!me&&"OffscreenCanvas"in globalThis,Qn=!me&&"createImageBitmap"in globalThis;function X(o){return xe&&o instanceof HTMLCanvasElement}function Ge(o){return St&&o instanceof OffscreenCanvas}function Mt(o){return X(o)||Ge(o)}function $e(){try{return new OffscreenCanvas(1,1).getContext("2d")!=null}catch{return!1}}var Je=St&&$e(),W=Je&&Ke||xe&&Ye||null;function qe(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!=null}catch{return!1}}var tr=St&&qe();function Ke(o,t){return new OffscreenCanvas(o,t)}function Ye(o,t){return rt($t(o),Ut(t))}function ue(o,t,e,n=1){return t=Math.floor(t*n),e=Math.floor(e*n),o.width!=t||o.height!=e?(o.width=t,o.height=e,!0):!1}function Ze(o){return g(o.textBaseline)}function Qe(o,t,e,n=1){let r=o.imageSmoothingEnabled,i=o.textBaseline,s=o.textAlign,c=o.font,p=ue(o.canvas,t,e,n);return p&&(o.imageSmoothingEnabled=r,o.textBaseline=i,o.textAlign=s,o.font=c),p}function j(o,t,e,n=1){return Ze(o)?Qe(o,t,e,n):ue(o.canvas,t,e,n)}function _e(o,t=1){return j(o,o.canvas.clientWidth,o.canvas.clientHeight,t)}var k=class extends Event{get type(){return super.type}constructor(t,e){super(t,e)}},I=class extends z{addBubbler(t){super.addBubbler(t)}removeBubbler(t){super.removeBubbler(t)}addScopedEventListener(t,e,n,r){super.addScopedEventListener(t,e,n,r)}addEventListener(t,e,n){super.addEventListener(t,e,n)}removeEventListener(t,e){super.removeEventListener(t,e)}clearEventListeners(t){return super.clearEventListeners(t)}};var Tt=class{constructor(t,e,n){if(this.name=t,this.callback=e,!C(e))throw new Error("A function instance is required for this parameter");this.opts=n,Object.freeze(this)}applyToElement(t){this.add(t)}add(t){t.addEventListener(this.name,this.callback,this.opts)}remove(t){t.removeEventListener(this.name,this.callback)}};function T(o,t,e){return new Tt(o,t,e)}function fe(o,t){return T("mousedown",o,t)}function he(o,t){return T("mousemove",o,t)}function ge(o,t){return T("mouseout",o,t)}function ve(o,t){return T("mouseover",o,t)}function Ae(o,t){return T("mouseup",o,t)}function be(o,t){return T("touchend",o,t)}function we(o,t){return T("touchmove",o,t)}function Ve(o,t){return T("touchstart",o,t)}function ye(){return"InstallTrigger"in globalThis}function ke(){return/^mac/i.test(navigator.platform)}function to(){return/iP(ad|hone|od)/.test(navigator.platform)||/Macintosh(.*?) FxiOS(.*?)\//.test(navigator.platform)||ke()&&"maxTouchPoints"in navigator&&navigator.maxTouchPoints>2}function N(){return to()||ke()}var eo=/OculusBrowser\/(\d+)\.(\d+)\.(\d+)/i,it=navigator.userAgent.match(eo),st=!!it,xr=st&&{major:parseFloat(it[1]),minor:parseFloat(it[2]),patch:parseFloat(it[3])},mr=st&&/pacific/i.test(navigator.userAgent),ur=st&&/quest/i.test(navigator.userAgent),_r=st&&/quest 2/i.test(navigator.userAgent);var fr="Worker"in globalThis;var oo=/(<%= allExceptCombiningMarks %>)(<%= combiningMarks %>+)/g,no=/(<%= highSurrogates %>)(<%= lowSurrogates %>)/g;function Xt(o){o=o.replace(oo,function(e,n,r){return Xt(r)+n}).replace(no,"$2$1");let t="";for(let e=o.length-1;e>=0;--e)t+=o[e];return t}var l=class o{static min(t,e){return t.i<=e.i?t:e}static max(t,e){return t.i>e.i?t:e}i;x;y;constructor(t,e,n){this.i=t||0,this.x=e||0,this.y=n||0,Object.seal(this)}clone(){return new o(this.i,this.x,this.y)}toString(){return`[i:${this.i} x:${this.x} y:${this.y}]`}copy(t){this.i=t.i,this.x=t.x,this.y=t.y}fullHome(){this.i=0,this.x=0,this.y=0}fullEnd(t){this.i=0;let e=0;for(let n=0;n<t.length;++n)e=t[n].stringLength,this.i+=e;this.y=t.length-1,this.x=e}left(t,e=!1){if(this.i>0)if(--this.i,--this.x,this.x<0){--this.y;let n=t[this.y];this.x=n.stringLength-1}else e||t[this.y].adjust(this,-1)}skipLeft(t){if(this.x<=1)this.left(t);else{let e=this.x-1,n=t[this.y],r=Xt(n.substring(0,e)),i=r.match(/\w+/),s=i?i.index+i[0].length+1:this.x;this.i-=s,this.x-=s,t[this.y].adjust(this,-1)}}right(t,e=!1){let n=t[this.y];(this.y<t.length-1||this.x<n.stringLength)&&(++this.i,++this.x,this.y<t.length-1&&this.x===n.stringLength?(this.x=0,++this.y):e||t[this.y].adjust(this,1))}skipRight(t){let e=t[this.y];if(this.x<e.stringLength-1){let n=this.x+1,r=e.substring(n),i=r.match(/\w+/),s=i?i.index+i[0].length+1:e.stringLength-this.x;this.i+=s,this.x+=s,this.x>0&&this.x===e.stringLength&&this.y<t.length-1&&(--this.x,--this.i),t[this.y].adjust(this,1)}else this.y<t.length-1&&this.right(t)}home(){this.i-=this.x,this.x=0}end(t){let n=t[this.y].stringLength-this.x;this.y<t.length-1&&--n,this.i+=n,this.x+=n}up(t,e=!1){if(this.y>0){--this.y;let n=t[this.y],r=Math.min(0,n.stringLength-this.x-1);this.x+=r,this.i-=n.stringLength-r,e||t[this.y].adjust(this,1)}}down(t,e=!1){if(this.y<t.length-1){let n=t[this.y];++this.y,this.i+=n.stringLength;let r=t[this.y];if(this.x>=r.stringLength){let i=this.x-r.stringLength;this.y<t.length-1&&++i,this.i-=i,this.x-=i}e||t[this.y].adjust(this,1)}}incX(t,e){let n=Math.sign(e);if(e=Math.abs(e),n===-1){for(let r=0;r<e;++r)this.left(t,!0);t[this.y].adjust(this,-1)}else if(n===1){for(let r=0;r<e;++r)this.right(t,!0);t[this.y].adjust(this,1)}}incY(t,e){let n=Math.sign(e);if(e=Math.abs(e),n===-1)for(let r=0;r<e;++r)this.up(t,!0);else if(n===1)for(let r=0;r<e;++r)this.down(t,!0);t[this.y].adjust(this,1)}setXY(t,e,n){e=Math.floor(e),n=Math.floor(n),this.y=Math.max(0,Math.min(t.length-1,n));let r=t[this.y];this.x=Math.max(0,Math.min(r.stringLength,e)),this.i=this.x;for(let i=0;i<this.y;++i)this.i+=t[i].stringLength;this.x>0&&this.x===r.stringLength&&this.y<t.length-1&&(--this.x,--this.i),t[this.y].adjust(this,1)}setI(t,e){let n=this.i-e,r=Math.sign(n);this.x=this.i=e,this.y=0;let i=0,s=t[this.y];for(;this.x>s.stringLength;){if(this.x-=s.stringLength,i+=s.stringLength,this.y>=t.length-1){this.i=i,this.x=s.stringLength;break}++this.y,s=t[this.y]}this.y<t.length-1&&this.x===s.stringLength&&(this.x=0,++this.y),t[this.y].adjust(this,r)}};var pt=class extends I{constructor(e){super();this.timeout=e;let n=new k("tick");this.tick=()=>{this.cancel(),this.dispatchEvent(n)},Object.seal(this)}timer=null;tick;get isRunning(){return this.timer!==null}cancel(){let e=this.isRunning;return e&&(clearTimeout(this.timer),this.timer=null),e}start(){this.cancel(),this.timer=setInterval(this.tick,this.timeout)}};var b={name:"Dark",cursorColor:"white",unfocused:"rgba(0, 0, 255, 0.25)",currentRowBackColor:"#202020",selectedBackColor:"#404040",lineNumbers:{foreColor:"white"},regular:{backColor:"black",foreColor:"#c0c0c0"},strings:{foreColor:"#aa9900",fontStyle:"italic"},regexes:{foreColor:"#aa0099",fontStyle:"italic"},numbers:{foreColor:"green"},comments:{foreColor:"yellow",fontStyle:"italic"},keywords:{foreColor:"cyan"},functions:{foreColor:"brown",fontWeight:"bold"},members:{foreColor:"green"},error:{foreColor:"red",fontStyle:"underline italic"}},It={name:"Light",cursorColor:"black",unfocused:"rgba(0, 0, 255, 0.25)",currentRowBackColor:"#f0f0f0",selectedBackColor:"#c0c0c0",lineNumbers:{foreColor:"black"},regular:{backColor:"white",foreColor:"black"},strings:{foreColor:"#aa9900",fontStyle:"italic"},regexes:{foreColor:"#aa0099",fontStyle:"italic"},numbers:{foreColor:"green"},comments:{foreColor:"grey",fontStyle:"italic"},keywords:{foreColor:"blue"},functions:{foreColor:"brown",fontWeight:"bold"},members:{foreColor:"green"},error:{foreColor:"red",fontStyle:"underline italic"}},Vr=Object.freeze(new Map([["light",It],["dark",b]]));var ct=class{constructor(t,e){this.name=t;this.test=e;this.name=t,this.test=e,Object.freeze(this)}carveOutMatchedToken(t,e){let n=t[e];if(n.type==="regular"){let r=this.test.exec(n.value);if(r){let i=r[r.length-1],s=r.input.indexOf(i),c=s+i.length;if(s===0){if(n.type=this.name,c<n.length){let p=n.splitAt(c);p.type="regular",t.splice(e+1,0,p)}}else{let p=n.splitAt(s);if(i.length<p.length){let a=p.splitAt(i.length);t.splice(e+1,0,a)}p.type=this.name,t.splice(e+1,0,p)}}}}};var at=class o{constructor(t,e,n){this.value=t;this.type=e;this.startStringIndex=n;Object.seal(this)}get length(){return this.value.length}get endStringIndex(){return this.startStringIndex+this.length}clone(){return new o(this.value,this.type,this.startStringIndex)}splitAt(t){let e=this.value.substring(t);return this.value=this.value.substring(0,t),new o(e,this.type,this.startStringIndex+t)}toString(){return`[${this.type}: ${this.value}]`}};function ro(o){let t=null,e=null;for(let n=0;n<o.length;++n){let r=o[n];e?(r.type==="stringDelim"&&r.value===e&&(n===0||o[n-1].value[o[n-1].value.length-1]!=="\\")&&(e=null),r.type!=="newlines"&&(r.type="strings")):t?((t==="startBlockComments"&&r.type==="endBlockComments"||t==="startLineComments"&&r.type==="newlines")&&(t=null),r.type!=="newlines"&&(r.type="comments")):r.type==="stringDelim"?(e=r.value,r.type="strings"):(r.type==="startBlockComments"||r.type==="startLineComments")&&(t=r.type,r.type="comments")}for(let n=o.length-1;n>0;--n){let r=o[n-1],i=o[n];r.type===i.type&&r.type!=="newlines"&&(r.value+=i.value,o.splice(n,1))}for(let n=o.length-1;n>=0;--n)o[n].length===0&&o.splice(n,1)}var w=class{constructor(t,e){this.name=t;e=e||[],this.grammar=e.map(n=>new ct(n[0],n[1])),Object.freeze(this)}grammar;tokenize(t){let e=[new at(t,"regular",0)];for(let n of this.grammar)for(let r=0;r<e.length;++r)n.carveOutMatchedToken(e,r);return ro(e),e}toHTML(t,e,n,r){n===void 0&&(n=It);let i=this.tokenize(e),s=ce();for(let c=0;c<i.length;++c){let p=i[c];if(p.type==="newlines")s.appendChild(pe());else{let a=n[p.type]||{},x=ae(Qt(a.fontWeight||n.regular.fontWeight),Zt(a.fontStyle||n.regular.fontStyle||""),Yt(a.foreColor||n.regular.foreColor),qt(a.backColor||n.regular.backColor),Jt());S(x,p.value),s.appendChild(x)}}t.innerHTML=s.innerHTML,Object.assign(t.style,{backgroundColor:n.regular.backColor,fontSize:`${r}px`,lineHeight:`${r}px`})}};var Et=class extends w{constructor(){super("BASIC",[["newlines",/(?:\r\n|\r|\n)/],["lineNumbers",/^\d+\s+/],["whitespace",/(?:\s+)/],["startLineComments",/^REM\s/],["stringDelim",/("|')/],["numbers",/-?(?:(?:\b\d*)?\.)?\b\d+\b/],["keywords",/\b(?:RESTORE|REPEAT|RETURN|LOAD|LABEL|DATA|READ|THEN|ELSE|FOR|DIM|LET|IF|TO|STEP|NEXT|WHILE|WEND|UNTIL|GOTO|GOSUB|ON|TAB|AT|END|STOP|PRINT|INPUT|RND|INT|CLS|CLK|LEN)\b/],["keywords",/^DEF FN/],["operators",/(?:\+|;|,|-|\*\*|\*|\/|>=|<=|=|<>|<|>|OR|AND|NOT|MOD|\(|\)|\[|\])/],["members",/\w+\$?/]])}tokenize(t){return super.tokenize(t.toUpperCase())}},Pt=new Et;var Ce=new w("HTML",[["newlines",/(?:\r\n|\r|\n)/],["whitespace",/(?:\s+)/],["startBlockComments",/(?:<|&lt;)!--/],["endBlockComments",/--(?:>|&gt;)/],["stringDelim",/("|')/],["numbers",/-?(?:(?:\b\d*)?\.)?\b\d+\b/],["keywords",/(?:<|&lt;)\/?(html|base|head|link|meta|style|title|address|article|aside|footer|header|h1|h2|h3|h4|h5|h6|hgroup|nav|section|dd|div|dl|dt|figcaption|figure|hr|li|main|ol|p|pre|ul|a|abbr|b|bdi|bdo|br|cite|code|data|dfn|em|i|kbd|mark|q|rp|rt|rtc|ruby|s|samp|small|span|strong|sub|sup|time|u|var|wbr|area|audio|img|map|track|video|embed|object|param|source|canvas|noscript|script|del|ins|caption|col|colgroup|table|tbody|td|tfoot|th|thead|tr|button|datalist|fieldset|form|input|label|legend|meter|optgroup|option|output|progress|select|textarea|details|dialog|menu|menuitem|summary|content|element|shadow|template|acronym|applet|basefont|big|blink|center|command|content|dir|font|frame|frameset|isindex|keygen|listing|marquee|multicol|nextid|noembed|plaintext|spacer|strike|tt|xmp)\b/],["members",/(\w+)=/]]);var U=new w("JavaScript",[["newlines",/(?:\r\n|\r|\n)/],["whitespace",/(?:\s+)/],["startBlockComments",/\/\*/],["endBlockComments",/\*\//],["regexes",/(?:^|,|;|\(|\[|\{)(?:\s*)(\/(?:\\\/|[^\n/])+\/)/],["stringDelim",/("|'|`)/],["startLineComments",/\/\/.*$/m],["numbers",/-?(?:(?:\b\d*)?\.)?\b\d+\b/],["keywords",/\b(?:break|case|catch|class|const|continue|debugger|default|delete|do|else|export|finally|for|function|if|import|in|instanceof|let|new|return|super|switch|this|throw|try|typeof|var|void|while|with)\b/],["functions",/(\w+)(?:\s*\()/],["members",/(\w+)\./],["members",/((\w+\.)+)(\w+)/]]);var Dt=new w("PlainText",[["newlines",/(?:\r\n|\r|\n)/],["whitespace",/(?:\s+)/]]);var Rt=Object.freeze(new Map([["basic",Pt],["bas",Pt],["html",Ce],["javascript",U],["js",U],["plaintext",Dt],["txt",Dt]]));var E=class o{constructor(t=0,e=0){this.x=t;this.y=e;Object.seal(this)}set(t,e){this.x=t,this.y=e}copy(t){t&&(this.x=t.x,this.y=t.y)}toCell(t,e,n){this.x=Math.round(this.x/t.width)+e.x-n.x,this.y=Math.floor(this.y/t.height-.25)+e.y}inBounds(t){return t.left<=this.x&&this.x<t.right&&t.top<=this.y&&this.y<t.bottom}clone(){return new o(this.x,this.y)}toString(){return`(x:${this.x}, y:${this.y})`}};var P=class o{constructor(t=0,e=0){this.width=t;this.height=e;Object.seal(this)}set(t,e){this.width=t,this.height=e}copy(t){t&&(this.width=t.width,this.height=t.height)}clone(){return new o(this.width,this.height)}toString(){return`<w:${this.width}, h:${this.height}>`}};var lt=class o{point;size;constructor(t,e,n,r){this.point=new E(t,e),this.size=new P(n,r),Object.freeze(this)}get x(){return this.point.x}set x(t){this.point.x=t}get left(){return this.point.x}set left(t){this.point.x=t}get width(){return this.size.width}set width(t){this.size.width=t}get right(){return this.point.x+this.size.width}set right(t){this.point.x=t-this.size.width}get y(){return this.point.y}set y(t){this.point.y=t}get top(){return this.point.y}set top(t){this.point.y=t}get height(){return this.size.height}set height(t){this.size.height=t}get bottom(){return this.point.y+this.size.height}set bottom(t){this.point.y=t-this.size.height}get area(){return this.width*this.height}set(t,e,n,r){this.point.set(t,e),this.size.set(n,r)}copy(t){t&&(this.point.copy(t.point),this.size.copy(t.size))}clone(){return new o(this.point.x,this.point.y,this.size.width,this.size.height)}overlap(t){let e=Math.max(this.left,t.left),n=Math.max(this.top,t.top),r=Math.min(this.right,t.right),i=Math.min(this.bottom,t.bottom);return r>e&&i>n?new o(e,n,r-e,i-n):null}toString(){return`[${this.point.toString()} x ${this.size.toString()}]`}};var D=class o{constructor(t,e,n,r,i){this.text=t;this.tokens=e;this.startStringIndex=n;this.startTokenIndex=r;this.lineNumber=i;let s=Object.freeze([...t]);this.leftCorrections=new Array(t.length),this.rightCorrections=new Array(t.length);let c=0;for(let p of s){this.leftCorrections[c]=0,this.rightCorrections[c]=0;for(let a=1;a<p.length;++a)this.leftCorrections[c+a]=-a,this.rightCorrections[c+a]=p.length-a;c+=p.length}Object.seal(this)}static emptyRow(t,e,n){return new o("",[],t,e,n)}leftCorrections;rightCorrections;toString(){return this.text}substring(t,e){return this.text.substring(t,e)}adjust(t,e){let n=e===-1?this.leftCorrections:this.rightCorrections;if(t.x<n.length){let r=n[t.x];t.x+=r,t.i+=r}else e===1&&this.text[this.text.length-1]===`
`&&this.adjust(t,-1)}get stringLength(){return this.text.length}get endStringIndex(){return this.startStringIndex+this.stringLength}get numTokens(){return this.tokens.length}get endTokenIndex(){return this.startTokenIndex+this.numTokens}};var H=Object.freeze(["CursorLeft","CursorRight","CursorSkipLeft","CursorSkipRight","CursorHome","CursorEnd","CursorFullHome","CursorFullEnd","SelectLeft","SelectRight","SelectSkipLeft","SelectSkipRight","SelectHome","SelectEnd","SelectFullHome","SelectFullEnd","SelectAll"]),Ot=Object.freeze(H.concat(["CursorDown","CursorUp","CursorPageDown","CursorPageUp","SelectDown","SelectUp","SelectPageDown","SelectPageUp","ScrollDown","ScrollUp"])),Se=["Backspace","Delete","DeleteWordLeft","DeleteWordRight","DeleteLine","Undo","Redo"],Me=Object.freeze(H.concat(Se)),Te=Object.freeze(Ot.concat(Se).concat(["AppendNewline","PrependNewline"]));var io=Object.freeze(new Map([["special",["Unidentified"]],["modifier",["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Hyper","Meta","NumLock","ScrollLock","Shift","Super","Symbol","SymbolLock"]],["whitespace",["Enter","Tab"]],["navigation",["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Home","PageDown","PageUp"]],["editing",["Backspace","Clear","Copy","CrSel","Cut","Delete","EraseEof","ExSel","Insert","Paste","Redo","Undo"]],["ui",["Accept","Again","Attn","Cancel","ContextMenu","Escape","Execute","Find","Finish","Help","Pause","Play","Props","Select","ZoomIn","ZoomOut"]],["device",["BrightnessDown","BrightnessUp","Eject","LogOff","Power","PowerOff","PrintScreen","Hibernate","Standby","WakeUp"]],["ime",["AllCandidates","Alphanumeric","CodeInput","Compose","Convert","Dead","FinalMode","GroupFirst","GroupNext","GroupPrevious","ModeChange","NextCandidate","NonConvert","PreviousCandidate","Process","SingleCandidate"]],["korean",["HangulMode","HanjaMode","JunjaMode"]],["japanese",["Eisu","Hankaku","Hiragana","HiraganaKatakana","KanaMode","KanjiMode","Katakana","Romaji","Zenkaku","ZenkakuHanaku"]],["function",["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","Soft1","Soft2","Soft3","Soft4"]],["phone",["AppSwitch","Call","Camera","CameraFocus","EndCall","GoBack","GoHome","HeadsetHook","LastNumberRedial","Notification","MannerMode","VoiceDial"]],["multimedia",["ChannelDown","ChannelUp","MediaFastForward","MediaPause","MediaPlay","MediaPlayPause","MediaRecord","MediaRewind","MediaStop","MediaTrackNext","MediaTrackPrevious"]],["audio",["AudioBalanceLeft","AudioBalanceRight","AudioBassDown","AudioBassBoostDown","AudioBassBoostToggle","AudioBassBoostUp","AudioBassUp","AudioFaderFront","AudioFaderRear","AudioSurroundModeNext","AudioTrebleDown","AudioTrebleUp","AudioVolumeDown","AudioVolumeMute","AudioVolumeUp","MicrophoneToggle","MicrophoneVolumeDown","MicrophoneVolumeMute","MicrophoneVolumeUp"]],["tv",["TV","TV3DMode","TVAntennaCable","TVAudioDescription","TVAudioDescriptionMixDown","TVAudioDescriptionMixUp","TVContentsMenu","TVDataService","TVInput","TVInputComponent1","TVInputComponent2","TVInputComposite1","TVInputComposite2","TVInputHDMI1","TVInputHDMI2","TVInputHDMI3","TVInputHDMI4","TVInputVGA1","TVMediaContext","TVNetwork","TVNumberEntry","TVPower","TVRadioService","TVSatellite","TVSatelliteBS","TVSatelliteCS","TVSatelliteToggle","TVTerrestrialAnalog","TVTerrestrialDigital","TVTimer"]],["mediaController",["AVRInput","AVRPower","ColorF0Red","ColorF1Green","ColorF2Yellow","ColorF3Blue","ColorF4Grey","ColorF5Brown","ClosedCaptionToggle","Dimmer","DisplaySwap","DVR","Exit","FavoriteClear0","FavoriteClear1","FavoriteClear2","FavoriteClear3","FavoriteRecall0","FavoriteRecall1","FavoriteRecall2","FavoriteRecall3","FavoriteStore0","FavoriteStore1","FavoriteStore2","FavoriteStore3","Guide","GuideNextDay","GuidePreviousDay","Info","InstantReplay","Link","ListProgram","LiveContent","Lock","MediaApps","MediaAudioTrack","MediaLast","MediaSkipBackward","MediaSkipForward","MediaStepBackward","MediaStepForward","MediaTopMenu","NavigateIn","NavigateNext","NavigateOut","NavigatePrevious","NextFavoriteChannel","NextUserProfile","OnDemand","Pairing","PinPDown","PinPMove","PinPToggle","PinPUp","PlaySpeedDown","PlaySpeedReset","PlaySpeedUp","RandomToggle","RcLowBattery","RecordSpeedNext","RfBypass","ScanChannelsToggle","ScreenModeNext","Settings","SplitScreenToggle","STBInput","STBPower","Subtitle","Teletext","VideoModeNext","Wink","ZoomToggle"]],["speechRecognition",["SpeechCorrectionList","SpeechInputToggle"]],["document",["Close","New","Open","Print","Save","SpellCheck","MailForward","MailReply","MailSend"]],["applicationSelector",["LaunchCalculator","LaunchCalendar","LaunchContacts","LaunchMail","LaunchMediaPlayer","LaunchMusicPlayer","LaunchMyComputer","LaunchPhone","LaunchScreenSaver","LaunchSpreadsheet","LaunchWebBrowser","LaunchWebCam","LaunchWordProcessor","LaunchApplication1","LaunchApplication2","LaunchApplication3","LaunchApplication4","LaunchApplication5","LaunchApplication6","LaunchApplication7","LaunchApplication8","LaunchApplication9"]],["browserControl",["BrowserBack","BrowserFavorites","BrowserForward","BrowserHome","BrowserRefresh","BrowserSearch","BrowserStop"]],["numericKeypad",["Clear"]]])),G=new Map;for(let o of io)for(let t of o[1])G.set(t,o[0]);Object.freeze(G);var Lt=!1;N()&&(window.addEventListener("keydown",o=>{o.key==="Fn"&&(Lt=!0)}),window.addEventListener("keyup",o=>{o.key==="Fn"&&(Lt=!1)}));function Xe(o){return o.key==="OS"&&(o.code==="OSLeft"||o.code==="OSRight")?"Meta":o.key==="Scroll"?"ScrollLock":o.key==="Win"?"Meta":o.key==="Spacebar"?" ":o.key===`
`?"Enter":o.key==="Down"?"ArrowDown":o.key==="Left"?"ArrowLeft":o.key==="Right"?"ArrowRight":o.key==="Up"?"ArrowUp":o.key==="Del"?"Delete":o.key==="Delete"&&N()&&Lt?"Backspace":o.key==="Crsel"?"CrSel":o.key==="Exsel"?"ExSel":o.key==="Esc"?"Escape":o.key==="Apps"?"ContextMenu":o.key==="Multi"?"Compose":o.key==="Nonconvert"?"NonConvert":o.key==="RomanCharacters"?"Eisu":o.key==="HalfWidth"?"Hankaku":o.key==="FullWidth"?"Zenkaku":o.key==="Exit"||o.key==="MozHomeScreen"?"GoHome":o.key==="MediaNextTrack"?"MediaTrackNext":o.key==="MediaPreviousTrack"?"MediaTrackPrevious":o.key==="FastFwd"?"MedaiFastFwd":o.key==="VolumeDown"?"AudioVolumeDown":o.key==="VolumeMute"?"AudioVolumeMute":o.key==="VolumeUp"?"AudioVolumeUp":o.key==="Live"?"TV":o.key==="Zoom"?"ZoomToggle":o.key==="SelectMedia"||o.key==="MediaSelect"?"LaunchMediaPlayer":o.key==="Add"?"+":o.key==="Divide"?"/":o.key==="Decimal"?".":o.key==="Key11"?"11":o.key==="Key12"?"12":o.key==="Multiply"?"*":o.key==="Subtract"?"-":o.key==="Separator"?",":o.key}var d=Object.seal({type:"",text:"",command:""}),dt=class{constructor(t,e,n,r,i,s,c,p,a,x){this.name=t;let h=i;i.length===0&&(i="Normal");let _=Object.freeze(new Map([["Normal_ArrowDown","CursorDown"],["Normal_ArrowLeft","CursorLeft"],["Normal_ArrowRight","CursorRight"],["Normal_ArrowUp","CursorUp"],["Normal_PageDown","CursorPageDown"],["Normal_PageUp","CursorPageUp"],[`${n}_ArrowLeft`,"CursorSkipLeft"],[`${n}_ArrowRight`,"CursorSkipRight"],[`${i}_${s}`,"CursorHome"],[`${i}_${c}`,"CursorEnd"],[`${p}_${a}`,"CursorFullHome"],[`${p}_${x}`,"CursorFullEnd"],["Shift_ArrowDown","SelectDown"],["Shift_ArrowLeft","SelectLeft"],["Shift_ArrowRight","SelectRight"],["Shift_ArrowUp","SelectUp"],["Shift_PageDown","SelectPageDown"],["Shift_PageUp","SelectPageUp"],[`${n}Shift_ArrowLeft`,"SelectSkipLeft"],[`${n}Shift_ArrowRight`,"SelectSkipRight"],[`${h}Shift_${s}`,"SelectHome"],[`${h}Shift_${c}`,"SelectEnd"],[`${p}Shift_${a}`,"SelectFullHome"],[`${p}Shift_${x}`,"SelectFullEnd"],[`${e}_a`,"SelectAll"],[`${e}_ArrowDown`,"ScrollDown"],[`${e}_ArrowUp`,"ScrollUp"],["Normal_Backspace","DeleteLetterLeft"],["Normal_Delete","DeleteLetterRight"],[`${n}_Backspace`,"DeleteWordLeft"],[`${n}_Delete`,"DeleteWordRight"],["Shift_Delete","DeleteLine"],["Normal_Enter","AppendNewline"],[`${n}_Enter`,"PrependNewline"],["Normal_Tab","InsertTab"],["Shift_Tab","RemoveTab"],[`${e}_z`,"Undo"],[r,"Redo"]]));this.makeCommand=m=>(d.text=Xe(m),d.type=G.has(d.text)?G.get(d.text):"printable",d.command="",(m.ctrlKey||m.altKey||m.metaKey)&&((d.type==="printable"||d.type==="whitespace")&&(d.type="special"),m.ctrlKey&&(d.command+="Control"),m.altKey&&(d.command+="Alt"),m.metaKey&&(d.command+="Meta")),m.shiftKey&&(d.command+="Shift"),d.command===""&&(d.command+="Normal"),d.command+="_"+d.text,_.has(d.command)&&(d.command=_.get(d.command)),d.command==="PrependNewline"&&(d.type="whitespace"),d),Object.freeze(this)}makeCommand},Ie=new dt("Windows","Control","Control","Control_y","","Home","End","Control","Home","End"),Ee=new dt("macOS","Meta","Alt","MetaShift_z","Meta","ArrowLeft","ArrowRight","Meta","ArrowUp","ArrowDown");function Pe(o,t,e){let n=o-t,r=o-e+5,i=0;return(n<0||r>=0)&&(i=Math.abs(n)<Math.abs(r)?n:r),i}var M=null,ut=null,De=[],jt=[],so=4,xt=2,Re=ye()?3:100,po=Object.freeze({readOnly:!1,multiLine:!0,wordWrap:!0,scrollBars:!0,lineNumbers:!0,padding:0,fontSize:16,language:"JavaScript",scaleFactor:devicePixelRatio}),mt=new WeakMap,co=(document.readyState==="complete"?Promise.resolve("already"):new Promise(o=>{document.addEventListener("readystatechange",()=>{document.readyState==="complete"&&o("had to wait for it")},!1)})).then(()=>{for(let o of document.getElementsByTagName("primrose"))new _t({element:o})}),_t=class o extends I{static add(t,e){t!==null&&mt.set(t,e),jt.indexOf(e)===-1&&(jt.push(e),zt(De,...jt.slice()),e.addEventListener("blur",()=>{M=null}),e.addEventListener("focus",()=>{M!==null&&(!M.isInDocument||!e.isInDocument)&&M.blur(),M=e}),e.addEventListener("over",()=>{ut=e}),e.addEventListener("out",()=>{ut=null}))}static has(t){return mt.has(t)}static get(t){return mt.has(t)?mt.get(t):null}static get hoveredControl(){return ut}static get focusedControl(){return M}static get editors(){return De}static get ready(){return co}_unlocked=!1;_value="";_padding=0;_fontSize=null;_scaleFactor=2;_readOnly=!1;_wordWrap=!1;_multiLine=!1;_language=U;_showScrollBars=!1;_showLineNumbers=!1;_hovered=!1;_focused=!1;_element=null;_theme=b;_tabWidth=2;currentTouchID=null;vibX=0;vibY=0;tx=0;ty=0;canv=null;resized=!1;pressed=!1;tabString="  ";dragging=!1;historyIndex=-1;scrolling=!1;tabPressed=!1;lineCount=1;lineCountWidth=0;controlType=H;maxVerticalScroll=0;currentValue="";currentTabIndex=-1;lastCharacterHeight=null;lastCharacterWidth=null;lastFrontCursor=null;lastGridBounds=null;lastBackCursor=null;lastThemeName=null;lastPadding=null;lastFocused=null;lastScrollX=null;lastScrollY=null;lastScrollDX=null;lastScrollDY=null;lastFont=null;lastText=null;history=[];tokens=new Array;rows=[D.emptyRow(0,0,0)];scroll=new E;pointer=new E;character=new P;bottomRightGutter=new P;gridBounds=new lt;tokenBack=new l;tokenFront=new l;backCursor=new l;frontCursor=new l;outEvt=new k("out");overEvt=new k("over");blurEvt=new k("blur");focusEvt=new k("focus");changeEvt=new k("change");updateEvt=new k("update");os=N()?Ee:Ie;longPress=new pt(1e3);keyPressCommands;keyDownCommands;_mouse;_touch;surrogate;context;fg;fgfx;bg;bgfx;tg;tgfx;constructor(t){if(super(),this.surrogate=Ct("#primroseSurrogate"),A(this.surrogate)&&S(document.body,this.surrogate=le(Ht("primroseSurrogate"),kt("none"))),t=t||{},t.element===void 0&&(t.element=null),t.element!==null&&!(t.element instanceof HTMLElement))throw new Error("element must be null, an instance of HTMLElement, an instance of HTMLCanvaseElement, or an instance of OffscreenCanvas");if(t=Object.assign({},po,t),this.keyDownCommands=Object.freeze(new Map([["CursorUp",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);n.up(this.rows),r.copy(n),this.scrollIntoView(this.frontCursor)}],["CursorDown",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);r.down(this.rows),n.copy(r),this.scrollIntoView(this.frontCursor)}],["CursorLeft",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);n.i===r.i&&n.left(this.rows),r.copy(n),this.scrollIntoView(this.frontCursor)}],["CursorRight",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);n.i===r.i&&r.right(this.rows),n.copy(r),this.scrollIntoView(this.frontCursor)}],["CursorPageUp",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);n.incY(this.rows,-this.gridBounds.height),r.copy(n),this.scrollIntoView(this.frontCursor)}],["CursorPageDown",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);r.incY(this.rows,this.gridBounds.height),n.copy(r),this.scrollIntoView(this.frontCursor)}],["CursorSkipLeft",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);n.i===r.i&&n.skipLeft(this.rows),r.copy(n),this.scrollIntoView(this.frontCursor)}],["CursorSkipRight",()=>{let n=l.min(this.frontCursor,this.backCursor),r=l.max(this.frontCursor,this.backCursor);n.i===r.i&&r.skipRight(this.rows),n.copy(r),this.scrollIntoView(this.frontCursor)}],["CursorHome",()=>{this.frontCursor.home(),this.backCursor.copy(this.frontCursor),this.scrollIntoView(this.frontCursor)}],["CursorEnd",()=>{this.frontCursor.end(this.rows),this.backCursor.copy(this.frontCursor),this.scrollIntoView(this.frontCursor)}],["CursorFullHome",()=>{this.frontCursor.fullHome(),this.backCursor.copy(this.frontCursor),this.scrollIntoView(this.frontCursor)}],["CursorFullEnd",()=>{this.frontCursor.fullEnd(this.rows),this.backCursor.copy(this.frontCursor),this.scrollIntoView(this.frontCursor)}],["SelectDown",()=>{this.backCursor.down(this.rows),this.scrollIntoView(this.frontCursor)}],["SelectLeft",()=>{this.backCursor.left(this.rows),this.scrollIntoView(this.backCursor)}],["SelectRight",()=>{this.backCursor.right(this.rows),this.scrollIntoView(this.backCursor)}],["SelectUp",()=>{this.backCursor.up(this.rows),this.scrollIntoView(this.backCursor)}],["SelectPageDown",()=>{this.backCursor.incY(this.rows,this.gridBounds.height),this.scrollIntoView(this.backCursor)}],["SelectPageUp",()=>{this.backCursor.incY(this.rows,-this.gridBounds.height),this.scrollIntoView(this.backCursor)}],["SelectSkipLeft",()=>{this.backCursor.skipLeft(this.rows),this.scrollIntoView(this.backCursor)}],["SelectSkipRight",()=>{this.backCursor.skipRight(this.rows),this.scrollIntoView(this.backCursor)}],["SelectHome",()=>{this.backCursor.home(),this.scrollIntoView(this.backCursor)}],["SelectEnd",()=>{this.backCursor.end(this.rows),this.scrollIntoView(this.backCursor)}],["SelectFullHome",()=>{this.backCursor.fullHome(),this.scrollIntoView(this.backCursor)}],["SelectFullEnd",()=>{this.backCursor.fullEnd(this.rows),this.scrollIntoView(this.backCursor)}],["SelectAll",()=>{this.frontCursor.fullHome(),this.backCursor.fullEnd(this.rows),this.render()}],["ScrollDown",()=>{this.scroll.y<this.rows.length-this.gridBounds.height&&this.scrollBy(0,1)}],["ScrollUp",()=>{this.scroll.y>0&&this.scrollBy(0,-1)}],["DeleteLetterLeft",()=>{this.frontCursor.i===this.backCursor.i&&this.backCursor.left(this.rows),this.setSelectedText("")}],["DeleteLetterRight",()=>{this.frontCursor.i===this.backCursor.i&&this.backCursor.right(this.rows),this.setSelectedText("")}],["DeleteWordLeft",()=>{this.frontCursor.i===this.backCursor.i&&this.frontCursor.skipLeft(this.rows),this.setSelectedText("")}],["DeleteWordRight",()=>{this.frontCursor.i===this.backCursor.i&&this.backCursor.skipRight(this.rows),this.setSelectedText("")}],["DeleteLine",()=>{this.frontCursor.i===this.backCursor.i&&(this.frontCursor.home(),this.backCursor.end(this.rows),this.backCursor.right(this.rows)),this.setSelectedText("")}],["Undo",()=>{this.moveInHistory(-1)}],["Redo",()=>{this.moveInHistory(1)}],["InsertTab",()=>{this.tabPressed=!0,this.setSelectedText(this.tabString)}],["RemoveTab",()=>{let n=this.rows[this.frontCursor.y],r=Math.min(this.frontCursor.x,this.tabWidth);for(let i=0;i<this.frontCursor.x;++i)if(n.text[i]!==" ")return;this.backCursor.copy(this.frontCursor),this.backCursor.incX(this.rows,-r),this.setSelectedText("")}]])),this.keyPressCommands=Object.freeze(new Map([["AppendNewline",()=>{if(this.multiLine){let n="",r=this.rows[this.frontCursor.y].tokens;r.length>0&&r[0].type==="whitespace"&&(n=r[0].value),this.setSelectedText(`
`+n)}else this.dispatchEvent(this.changeEvt)}],["PrependNewline",()=>{if(this.multiLine){let n="",r=this.rows[this.frontCursor.y].tokens;r.length>0&&r[0].type==="whitespace"&&(n=r[0].value),this.frontCursor.home(),this.backCursor.copy(this.frontCursor),this.setSelectedText(n+`
`)}else this.dispatchEvent(this.changeEvt)}],["Undo",()=>{this.moveInHistory(-1)}]])),this._mouse=Object.freeze({readOverEventUV:()=>this.pointerOver(),readOutEventUV:()=>this.pointerOut(),readUpEventUV:()=>this.mouseLikePointerUp(),readDownEventUV:this.mouseLikePointerDown(this.setUVPointer),readMoveEventUV:this.mouseLikePointerMove(this.setUVPointer)}),this._touch=Object.freeze({readOverEventUV:()=>this.pointerOver(),readOutEventUV:()=>this.pointerOut(),readUpEventUV:()=>this.touchLikePointerUp(),readDownEventUV:this.touchLikePointerDown(this.setUVPointer),readMoveEventUV:this.touchLikePointerMove(this.setUVPointer)}),X(t.element)){let n=t.element,r=n.width,i=n.height;this.currentTabIndex=n.tabIndex;let c=(n.dataset.options||"").trim().split(","),p={};for(let a of c)if(a=a.trim(),a.length>0){let x=a.split("=");if(x.length>1){let h=x[0].trim(),_=x[1].trim(),m=_.toLocaleLowerCase();m==="true"||m==="false"?p[h]=m==="true":p[h]=_}}this.currentValue=n.textContent,t=Object.assign(t,{width:r,height:i},p)}if(A(t.element)||Mt(t.element)?(this.canv=Mt(t.element)?t.element:W(t.width,t.height),X(this.canv)?this._element=this.canv:"window"in globalThis&&(this._element=de())):(this._element=t.element,se(this.element),this.canv=rt(ne(Vt(100)),te(Vt(100))),this.element.appendChild(this.canv),this.element.removeAttribute("tabindex"),S(this.element,kt("block"),oe(0),Kt("2px inset #c0c0c0"),ee("unset"))),this.canv instanceof HTMLCanvasElement&&this.isInDocument){if(this.currentTabIndex===-1){let n=document.querySelectorAll("[tabindex]");for(let r of n)this.currentTabIndex=Math.max(this.currentTabIndex,r.tabIndex);++this.currentTabIndex}this.canv.tabIndex=this.currentTabIndex,this.canv.style.touchAction="none",this.canv.addEventListener("focus",()=>this.focus()),this.canv.addEventListener("blur",()=>this.blur()),this.set2DMouseEvents(this.canv),this.set2DTouchEvents(this.canv),new ResizeObserver(()=>this.resize()).observe(this.canv)}this.context=this.canv.getContext("2d"),this.fg=W(this.canv.width,this.canv.height),this.fgfx=this.fg.getContext("2d"),this.bg=W(this.canv.width,this.canv.height),this.bgfx=this.bg.getContext("2d"),this.tg=W(this.canv.width,this.canv.height),this.tgfx=this.tg.getContext("2d"),this.context.imageSmoothingEnabled=this.fgfx.imageSmoothingEnabled=this.bgfx.imageSmoothingEnabled=this.tgfx.imageSmoothingEnabled=!0,this.context.textBaseline=this.fgfx.textBaseline=this.bgfx.textBaseline=this.tgfx.textBaseline="top",this.tgfx.textAlign="right",this.fgfx.textAlign="left",this.longPress.addEventListener("tick",()=>{this.startSelecting(),this.backCursor.copy(this.frontCursor),this.frontCursor.skipLeft(this.rows),this.backCursor.skipRight(this.rows),this.render(),navigator.vibrate(20)}),this.addEventListener("blur",()=>{this.tabPressed&&(this.tabPressed=!1,this.focus())});let e=null;t.language instanceof w?e=t.language:V(t.language)&&(t.language=t.language.toLocaleLowerCase(),Rt.has(t.language)&&(e=Rt.get(t.language))),Object.freeze(t),Object.seal(this),this.readOnly=t.readOnly,this.multiLine=t.multiLine,this.wordWrap=t.wordWrap,this.showScrollBars=t.scrollBars,this.showLineNumbers=t.lineNumbers,this.padding=t.padding,this.fontSize=t.fontSize,this.language=e,this.scaleFactor=t.scaleFactor,this.value=this.currentValue,this._unlocked=!0,o.add(this.element,this)}_renderTimer=null;render(){g(this._renderTimer)&&(clearTimeout(this._renderTimer),this._renderTimer=null),setTimeout(()=>{this._renderTimer=null,this._unlocked&&this.doRender()},0)}get element(){return this._element}get isInDocument(){return X(this.canv)&&document.body.contains(this.canv)}get canvas(){return this.canv}get hovered(){return this._hovered}get focused(){return this._focused}set focused(t){t!==this.focused&&(t?this.focus():this.blur())}get readOnly(){return this._readOnly}set readOnly(t){t=!!t,t!==this.readOnly&&(this._readOnly=t,this.refreshControlType())}get multiLine(){return this._multiLine}set multiLine(t){t=!!t,t!==this.multiLine&&(!t&&this.wordWrap&&(this.wordWrap=!1),this._multiLine=t,this.refreshControlType(),this.refreshGutter())}get wordWrap(){return this._wordWrap}set wordWrap(t){t=!!t,t!==this.wordWrap&&(this.multiLine||!t)&&(this._wordWrap=t,this.refreshGutter(),this.render())}get value(){return this._value}set value(t){this.setValue(t,!0)}get text(){return this.value}set text(t){this.setValue(t,!0)}get selectedText(){let t=l.min(this.frontCursor,this.backCursor),e=l.max(this.frontCursor,this.backCursor);return this.value.substring(t.i,e.i)}set selectedText(t){this.setSelectedText(t)}get selectionStart(){return this.frontCursor.i}set selectionStart(t){t=t|0,t!==this.frontCursor.i&&(this.frontCursor.setI(this.rows,t),this.render())}get selectionEnd(){return this.backCursor.i}set selectionEnd(t){t=t|0,t!==this.backCursor.i&&(this.backCursor.setI(this.rows,t),this.render())}get selectionDirection(){return this.frontCursor.i<=this.backCursor.i?"forward":"backward"}get tabWidth(){return this._tabWidth}set tabWidth(t){this._tabWidth=t||2,this.tabString="";for(let e=0;e<this.tabWidth;++e)this.tabString+=" "}get theme(){return this._theme}set theme(t){t!==this.theme&&(this._theme=t,this.render())}get language(){return this._language}set language(t){t!==this.language&&(this._language=t,this.refreshAllTokens())}get padding(){return this._padding}set padding(t){t=t|0,t!==this.padding&&(this._padding=t,this.render())}get showLineNumbers(){return this._showLineNumbers}set showLineNumbers(t){t=t||!1,t!==this.showLineNumbers&&(this._showLineNumbers=t,this.refreshGutter())}get showScrollBars(){return this._showScrollBars}set showScrollBars(t){t=t||!1,t!==this.showScrollBars&&(this._showScrollBars=t,this.refreshGutter())}get fontSize(){return this._fontSize}set fontSize(t){t=Math.max(1,t||0),t!==this.fontSize&&(this._fontSize=t,this.context.font=`${this.fontSize}px ${yt()}`,this.character.height=this.fontSize,this.character.width=this.context.measureText("MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM").width/100,this.refreshAllTokens())}get scaleFactor(){return this._scaleFactor}set scaleFactor(t){if(t=Math.max(.25,Math.min(4,t||0)),t!==this.scaleFactor){let e=this.width,n=this.height;this._scaleFactor=t,this.setSize(e,n)}}get width(){return this.canv.width/this.scaleFactor}set width(t){this.setSize(t,this.height)}get height(){return this.canv.height/this.scaleFactor}set height(t){this.setSize(this.width,t)}get mouse(){return this._mouse}get touch(){return this._touch}fillRect(t,e,n,r,i,s){t.fillStyle=e,t.fillRect(n*this.character.width,r*this.character.height,i*this.character.width+1,s*this.character.height+1)}strokeRect(t,e,n,r,i,s){t.strokeStyle=e,t.strokeRect(n*this.character.width,r*this.character.height,i*this.character.width+1,s*this.character.height+1)}renderCanvasBackground(){let t=l.min(this.frontCursor,this.backCursor),e=l.max(this.frontCursor,this.backCursor);this.bgfx.clearRect(0,0,this.canv.width,this.canv.height),this.theme.regular.backColor&&(this.bgfx.fillStyle=this.theme.regular.backColor,this.bgfx.fillRect(0,0,this.canv.width,this.canv.height)),this.bgfx.save(),this.bgfx.scale(this.scaleFactor,this.scaleFactor),this.bgfx.translate((this.gridBounds.x-this.scroll.x)*this.character.width+this.padding,-this.scroll.y*this.character.height+this.padding),this.focused&&this.fillRect(this.bgfx,this.theme.currentRowBackColor||b.currentRowBackColor,0,t.y,this.gridBounds.width,e.y-t.y+1);let n=this.scroll.y|0,r=n+this.gridBounds.height,i=this.scroll.x|0,s=i+this.gridBounds.width;this.tokenFront.setXY(this.rows,0,n),this.tokenBack.copy(this.tokenFront);for(let c=n;c<=r&&c<this.rows.length;++c){let p=this.rows[c].tokens;for(let a=0;a<p.length;++a){let x=p[a];if(this.tokenBack.x+=x.length,this.tokenBack.i+=x.length,i<=this.tokenBack.x&&this.tokenFront.x<=s&&t.i<=this.tokenBack.i&&this.tokenFront.i<e.i){let _=l.max(t,this.tokenFront),R=l.min(e,this.tokenBack).i-_.i;this.fillRect(this.bgfx,this.theme.selectedBackColor||b.selectedBackColor,_.x,_.y,R,1)}this.tokenFront.copy(this.tokenBack)}this.tokenFront.x=0,++this.tokenFront.y,this.tokenBack.copy(this.tokenFront)}if(this.focused){let c=this.theme.cursorColor||b.cursorColor,p=1/this.character.width;this.fillRect(this.bgfx,c,t.x,t.y,p,1),this.fillRect(this.bgfx,c,e.x,e.y,p,1)}this.bgfx.restore()}renderCanvasForeground(){this.fgfx.clearRect(0,0,this.canv.width,this.canv.height),this.fgfx.save(),this.fgfx.scale(this.scaleFactor,this.scaleFactor),this.fgfx.translate((this.gridBounds.x-this.scroll.x)*this.character.width+this.padding,this.padding);let t=this.scroll.y|0,e=t+this.gridBounds.height,n=this.scroll.x|0,r=n+this.gridBounds.width;this.tokenFront.setXY(this.rows,0,t),this.tokenBack.copy(this.tokenFront);for(let i=t;i<=e&&i<this.rows.length;++i){let s=this.rows[i].tokens,c=(i-this.scroll.y)*this.character.height;for(let p=0;p<s.length;++p){let a=s[p];if(this.tokenBack.x+=a.length,this.tokenBack.i+=a.length,n<=this.tokenBack.x&&this.tokenFront.x<=r){let x=this.theme[a.type]||{},h=x.fontWeight||this.theme.regular.fontWeight||b.regular.fontWeight||"",_=x.fontStyle||this.theme.regular.fontStyle||b.regular.fontStyle||"",m=`${h} ${_} ${this.context.font}`;this.fgfx.font=m.trim(),this.fgfx.fillStyle=x.foreColor||this.theme.regular.foreColor,this.fgfx.fillText(a.value,this.tokenFront.x*this.character.width,c)}this.tokenFront.copy(this.tokenBack)}this.tokenFront.x=0,++this.tokenFront.y,this.tokenBack.copy(this.tokenFront)}this.fgfx.restore()}renderCanvasTrim(){this.tgfx.clearRect(0,0,this.canv.width,this.canv.height),this.tgfx.save(),this.tgfx.scale(this.scaleFactor,this.scaleFactor),this.tgfx.translate(this.padding,this.padding),this.showLineNumbers&&(this.fillRect(this.tgfx,this.theme.selectedBackColor||b.selectedBackColor,0,0,this.gridBounds.x,this.width-this.padding*2),this.strokeRect(this.tgfx,this.theme.regular.foreColor||b.regular.foreColor,0,0,this.gridBounds.x,this.height-this.padding*2));let t=2;this.tgfx.save();{this.tgfx.translate((this.lineCountWidth-.5)*this.character.width,-this.scroll.y*this.character.height);let e=-1,n=this.scroll.y|0,r=n+this.gridBounds.height;this.tokenFront.setXY(this.rows,0,n),this.tokenBack.copy(this.tokenFront);for(let i=n;i<=r&&i<this.rows.length;++i){let s=this.rows[i];t=Math.max(t,s.stringLength),this.showLineNumbers&&s.lineNumber>e&&(e=s.lineNumber,this.tgfx.font="bold "+this.context.font,this.tgfx.fillStyle=this.theme.regular.foreColor,this.tgfx.fillText(s.lineNumber.toFixed(0),0,i*this.character.height))}}if(this.tgfx.restore(),this.showScrollBars){if(this.tgfx.fillStyle=this.theme.selectedBackColor||b.selectedBackColor,!this.wordWrap&&t>this.gridBounds.width){let e=this.gridBounds.width*this.character.width-this.padding,n=this.scroll.x*e/t+this.gridBounds.x*this.character.width,r=e*(this.gridBounds.width/t),i=this.height-this.character.height-this.padding,s=Math.max(this.character.width,r);this.tgfx.fillRect(n,i,s,this.character.height),this.tgfx.strokeRect(n,i,s,this.character.height)}if(this.rows.length>this.gridBounds.height){let e=this.gridBounds.height*this.character.height,n=this.scroll.y*e/this.rows.length,r=e*(this.gridBounds.height/this.rows.length),i=this.width-xt*this.character.width-2*this.padding,s=xt*this.character.width,c=Math.max(this.character.height,r);this.tgfx.fillRect(i,n,s,c),this.tgfx.strokeRect(i,n,s,c)}}this.tgfx.restore(),this.focused||(this.tgfx.fillStyle=this.theme.unfocused||b.unfocused,this.tgfx.fillRect(0,0,this.canv.width,this.canv.height))}doRender(){if(this.theme){let t=this.lastText!==this.value,e=this.focused!==this.lastFocused,n=this.context.font!==this.lastFont,r=this.padding!==this.lastPadding,i=this.theme.name!==this.lastThemeName,s=this.gridBounds.toString()!==this.lastGridBounds,c=this.character.width!==this.lastCharacterWidth,p=this.character.height!==this.lastCharacterHeight,a=this.frontCursor.i!==this.lastFrontCursor||this.backCursor.i!==this.lastBackCursor,x=this.scroll.x!==this.lastScrollX||this.scroll.y!==this.lastScrollY,h=this.resized||s||t||c||p||r||x||i,_=h||a,m=h||n,R=h||e;_&&this.renderCanvasBackground(),m&&this.renderCanvasForeground(),R&&this.renderCanvasTrim(),this.context.clearRect(0,0,this.canv.width,this.canv.height),this.context.save(),this.context.translate(this.vibX,this.vibY),this.context.drawImage(this.bg,0,0),this.context.drawImage(this.fg,0,0),this.context.drawImage(this.tg,0,0),this.context.restore(),this.lastGridBounds=this.gridBounds.toString(),this.lastText=this.value,this.lastCharacterWidth=this.character.width,this.lastCharacterHeight=this.character.height,this.lastPadding=this.padding,this.lastFrontCursor=this.frontCursor.i,this.lastBackCursor=this.backCursor.i,this.lastFocused=this.focused,this.lastFont=this.context.font,this.lastThemeName=this.theme.name,this.lastScrollX=this.scroll.x,this.lastScrollY=this.scroll.y,this.resized=!1,this.dispatchEvent(this.updateEvt)}}refreshControlType(){let t=this.controlType;this.readOnly&&this.multiLine?this.controlType=Ot:this.readOnly&&!this.multiLine?this.controlType=H:!this.readOnly&&this.multiLine?this.controlType=Te:this.controlType=Me,this.controlType!==t&&this.refreshAllTokens()}refreshGutter(){this.showScrollBars?this.wordWrap?this.bottomRightGutter.set(xt,0):this.bottomRightGutter.set(xt,1):this.bottomRightGutter.set(0,0)}setValue(t,e){t=t||"",t=t.replace(/\r\n/g,`
`),t!==this.value&&(this._value=t,e&&this.pushUndo(),this.refreshAllTokens(),this.dispatchEvent(this.changeEvt))}setSelectedText(t){if(t=t||"",t=t.replace(/\r\n/g,`
`),this.frontCursor.i!==this.backCursor.i||t.length>0){let e=l.min(this.frontCursor,this.backCursor),n=l.max(this.frontCursor,this.backCursor),r=this.rows[e.y],i=this.rows[n.y],s=this.value.substring(0,r.startStringIndex),c=this.value.substring(i.endStringIndex),p=e.i-r.startStringIndex,a=r.substring(0,p),x=n.i-i.startStringIndex,h=i.substring(x),_=a+t+h;this._value=s+_+c,this.pushUndo(),this.refreshTokens(e.y,n.y,_),this.frontCursor.setI(this.rows,e.i+t.length),this.backCursor.copy(this.frontCursor),this.scrollIntoView(this.frontCursor),this.dispatchEvent(this.changeEvt)}}refreshAllTokens(){this.refreshTokens(0,this.rows.length-1,this.value)}refreshTokens(t,e,n){if(this._unlocked){for(;t>0&&this.rows[t].lineNumber===this.rows[t-1].lineNumber;)--t,n=this.rows[t].text+n;for(;e<this.rows.length-1&&this.rows[e].lineNumber===this.rows[e+1].lineNumber&&this.rows[e+1].tokens.length>0;)++e,n+=this.rows[e].text;let r=this.language.tokenize(n),i=this.rows[t],s=i.startTokenIndex,c=i.lineNumber,p=i.startStringIndex,h=this.rows[e].endTokenIndex-s,_=this.tokens.splice(s,h,...r);if(this.lineCountWidth=0,this.showLineNumbers){for(let u of _)u.type==="newlines"&&--this.lineCount;for(let u of r)u.type==="newlines"&&++this.lineCount;this.lineCountWidth=Math.max(1,Math.ceil(Math.log(this.lineCount)/Math.LN10))+1}let m=Math.floor(this.lineCountWidth+this.padding/this.character.width),R=Math.floor(this.padding/this.character.height),Oe=Math.floor((this.width-2*this.padding)/this.character.width)-m-this.bottomRightGutter.width,Le=Math.floor((this.height-2*this.padding)/this.character.height)-R-this.bottomRightGutter.height;this.gridBounds.set(m,R,Oe,Le);let J=r.map(u=>u.clone()),je=e-t+1,ft=[],B="",q=[],K=p,Y=s,Z=c;for(let u=0;u<J.length;++u){let f=J[u],Bt=this.gridBounds.width-B.length,Ft=this.wordWrap&&f.type!=="newlines"&&f.length>Bt,Be=f.type==="newlines"||Ft;if(Ft){let Fe=f.length>this.gridBounds.width?Bt:0;J.splice(u+1,0,f.splitAt(Fe))}q.push(f),B+=f.value,(Be||u===J.length-1)&&(ft.push(new D(B,q,K,Y,Z)),K+=B.length,Y+=q.length,q=[],B="",f.type==="newlines"&&++Z)}this.rows.splice(t,je,...ft);for(let u=t+ft.length;u<this.rows.length;++u){let f=this.rows[u];f.lineNumber=Z,f.startStringIndex=K,f.startTokenIndex+=Y,K+=f.stringLength,Y+=f.numTokens,f.tokens.length>0&&f.tokens[f.tokens.length-1].type==="newlines"&&++Z}if(this.rows.length===0)this.rows.push(D.emptyRow(0,0,0));else{let u=this.rows[this.rows.length-1];u.text.endsWith(`
`)&&this.rows.push(D.emptyRow(u.endStringIndex,u.endTokenIndex,u.lineNumber+1))}this.maxVerticalScroll=Math.max(0,this.rows.length-this.gridBounds.height),this.render()}}refreshBuffers(){this.resized=!0,j(this.fgfx,this.canv.width,this.canv.height),j(this.bgfx,this.canv.width,this.canv.height),j(this.tgfx,this.canv.width,this.canv.height),this.refreshAllTokens()}clampScroll(){let t=this.scroll.y<0||this.maxVerticalScroll===0,e=this.scroll.y>this.maxVerticalScroll;return t?this.scroll.y=0:e&&(this.scroll.y=this.maxVerticalScroll),this.render(),t||e}scrollIntoView(t){let e=Pe(t.x,this.scroll.x,this.scroll.x+this.gridBounds.width),n=Pe(t.y,this.scroll.y,this.scroll.y+this.gridBounds.height);this.scrollBy(e,n)}pushUndo(){this.historyIndex<this.history.length-1&&this.history.splice(this.historyIndex+1),this.history.push({value:this.value,frontCursor:this.frontCursor.i,backCursor:this.backCursor.i}),this.historyIndex=this.history.length-1}moveInHistory(t){let e=this.historyIndex+t;if(0<=e&&e<this.history.length){let n=this.history[this.historyIndex];this.historyIndex=e;let r=this.history[this.historyIndex];this.setValue(r.value,!1),this.frontCursor.setI(this.rows,n.frontCursor),this.backCursor.setI(this.rows,n.backCursor)}}blur(){this.focused&&(this._focused=!1,this.surrogate.blur(),this.dispatchEvent(this.blurEvt),this.render())}focus(){this.focused||(this._focused=!0,this.surrogate.focus(),this.dispatchEvent(this.focusEvt),this.render())}resize(){X(this.canv)?_e(this.context,this.scaleFactor)&&this.refreshBuffers():console.warn("Can't automatically resize a canvas that is not in the DOM tree")}setSize(t,e){j(this.context,t,e,this.scaleFactor)&&this.refreshBuffers()}scrollTo(t,e){return this.wordWrap||(this.scroll.x=t),this.scroll.y=e,this.clampScroll()}scrollBy(t,e){return this.scrollTo(this.scroll.x+t,this.scroll.y+e)}readKeyDownEvent(t){let e=this.os.makeCommand(t);this.keyDownCommands.has(e.command)?(t.preventDefault(),this.keyDownCommands.get(e.command)(t)):t.key==="Tab"&&t.preventDefault()}readKeyPressEvent(t){let e=this.os.makeCommand(t);this.readOnly||(t.preventDefault(),this.keyPressCommands.has(e.command)?this.keyPressCommands.get(e.command)():(e.type==="printable"||e.type==="whitespace")&&this.setSelectedText(e.text),this.clampScroll(),this.render())}copySelectedText(t){return this.focused&&this.frontCursor.i!==this.backCursor.i?(t.clipboardData.setData("text/plain",this.selectedText),!0):!1}readCopyEvent(t){this.copySelectedText(t)}readCutEvent(t){this.copySelectedText(t)&&!this.readOnly&&this.setSelectedText("")}readPasteEvent(t){if(this.focused&&!this.readOnly){let n=t.clipboardData.getData("text/plain");n&&this.setSelectedText(n)}}readWheelEvent(t){if(this.hovered||this.focused){if(!t.ctrlKey&&!t.altKey&&!t.shiftKey&&!t.metaKey){let e=Math.floor(t.deltaY*so/Re);(!this.scrollBy(0,e)||this.focused)&&t.preventDefault()}else!t.ctrlKey&&!t.altKey&&!t.metaKey&&(t.preventDefault(),this.fontSize+=-t.deltaY/Re);this.render()}}vibrate(t){this.longPress.cancel(),t>0?(this.vibX=(Math.random()-.5)*10,this.vibY=(Math.random()-.5)*10,setTimeout(()=>this.vibrate(t-10),10)):(this.vibX=0,this.vibY=0),this.render()}setUVPointer(t){this.pointer.set(t.uv.x*this.width,(1-t.uv.y)*this.height)}startSelecting(){this.dragging=!0,this.moveCursor(this.frontCursor)}moveCursor(t){this.pointer.toCell(this.character,this.scroll,this.gridBounds);let e=this.pointer.x-this.scroll.x,n=this.pointer.y-this.scroll.y,r=n>=this.gridBounds.height,i=e<0,s=this.pointer.x>=this.gridBounds.width;if(!this.scrolling&&!r&&!i&&!s)t.setXY(this.rows,this.pointer.x,this.pointer.y),this.backCursor.copy(t);else if(this.scrolling||s&&!r){this.scrolling=!0;let c=this.rows.length-this.gridBounds.height;if(n>=0&&c>=0){let p=n*c/this.gridBounds.height;this.scrollTo(this.scroll.x,p)}}else if(r&&!i){let c=0;for(let a=0;a<this.rows.length;++a)c=Math.max(c,this.rows[a].stringLength);let p=c-this.gridBounds.width;if(e>=0&&p>=0){let a=e*p/this.gridBounds.width;this.scrollTo(a,this.scroll.y)}}this.render()}dragScroll(){if(this.lastScrollDX!==null&&this.lastScrollDY!==null){let t=(this.lastScrollDX-this.pointer.x)/this.character.width,e=(this.lastScrollDY-this.pointer.y)/this.character.height;this.scrollBy(t,e)}this.lastScrollDX=this.pointer.x,this.lastScrollDY=this.pointer.y}pointerOver(){this._hovered=!0,this.dispatchEvent(this.overEvt)}pointerOut(){this._hovered=!1,this.dispatchEvent(this.outEvt)}pointerDown(){this.focus(),this.pressed=!0}pointerMove=()=>{this.dragging?this.moveCursor(this.backCursor):this.pressed&&this.dragScroll()};mouseLikePointerDown(t){return e=>{t.call(this,e),this.pointerDown(),this.startSelecting()}}mouseLikePointerUp(){this.pressed=!1,this.dragging=!1,this.scrolling=!1}mouseLikePointerMove(t){return e=>{t.call(this,e),this.pointerMove()}}touchLikePointerDown(t){return e=>{t.call(this,e),this.tx=this.pointer.x,this.ty=this.pointer.y,this.pointerDown(),this.longPress.start()}}touchLikePointerUp(){this.longPress.cancel()&&!this.dragging&&this.startSelecting(),this.mouseLikePointerUp(),this.lastScrollDX=null,this.lastScrollDY=null}touchLikePointerMove(t){return e=>{if(t.call(this,e),this.longPress.isRunning){let n=this.pointer.x-this.tx,r=this.pointer.y-this.ty;n*n+r*r>25&&this.longPress.cancel()}this.longPress.isRunning||this.pointerMove()}}setMousePointer(t){this.pointer.set(t.offsetX,t.offsetY)}readMouseOverEvent(){this.pointerOver()}readMouseOutEvent(){this.pointerOut()}readMouseDownEvent(t){this.mouseLikePointerDown(this.setMousePointer)(t)}readMouseUpEvent(){this.mouseLikePointerUp()}readMouseMoveEvent(t){this.mouseLikePointerMove(this.setMousePointer)(t)}set2DMouseEvents(t){S(t,ve(()=>this.readMouseOverEvent()),ge(()=>this.readMouseOutEvent()),fe(e=>this.readMouseDownEvent(e)),he(e=>this.readMouseMoveEvent(e)),Ae(()=>this.readMouseUpEvent()))}findTouch(t){for(let e of t)if(this.currentTouchID===null||e.identifier===this.currentTouchID)return e;return null}withPrimaryTouch(t){return e=>{e.preventDefault(),t(this.findTouch(e.touches)||this.findTouch(e.changedTouches))}}setTouchPointer(t){if(X(this.canv)){let e=this.canv.getBoundingClientRect();this.pointer.set(t.clientX-e.left,t.clientY-e.top)}}readTouchStartEvent(t){this.withPrimaryTouch(this.touchLikePointerDown(this.setTouchPointer))(t)}readTouchMoveEvent(t){this.withPrimaryTouch(this.touchLikePointerMove(this.setTouchPointer))(t)}readTouchEndEvent(t){this.withPrimaryTouch(this.touchLikePointerUp)(t)}set2DTouchEvents(t){S(t,Ve(e=>this.readTouchStartEvent(e)),we(e=>this.readTouchMoveEvent(e)),be(e=>this.readTouchEndEvent(e)))}};Object.freeze(_t);var $=o=>{let t=o.toLocaleLowerCase(),e=`read${o}Event`;window.addEventListener(t,n=>{M!==null&&M[e](n)},{passive:!1})};$("KeyDown");$("KeyPress");$("Copy");$("Cut");$("Paste");window.addEventListener("wheel",o=>{let t=M||ut;t!==null&&t.readWheelEvent(o)},{passive:!1});export{Pt as Basic,b as Dark,w as Grammar,Ce as HTML,U as JavaScript,It as Light,Dt as PlainText,_t as Primrose,ct as Rule,at as Token,Rt as grammars,Vr as themes};
